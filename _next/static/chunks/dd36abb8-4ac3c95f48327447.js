(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[382],{41478:function(a){!function(b,c){a.exports=c()}(this,function(){return function(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=a,c.c=b,c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,b){if(1&b&&(a=c(a)),8&b||4&b&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(c.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&b&&"string"!=typeof a)for(var e in a)c.d(d,e,(function(b){return a[b]}).bind(null,e));return d},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="",c(c.s=22)}([function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e={debug:function(){},info:function(){},warn:function(){},error:function(){}},f=void 0,g=void 0;(b.Log=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a.reset=function(){g=3,f=e},a.debug=function(){if(g>=4){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];f.debug.apply(f,Array.from(b))}},a.info=function(){if(g>=3){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];f.info.apply(f,Array.from(b))}},a.warn=function(){if(g>=2){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];f.warn.apply(f,Array.from(b))}},a.error=function(){if(g>=1){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];f.error.apply(f,Array.from(b))}},d(a,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return g},set:function(a){if(!(0<=a&&a<=4))throw Error("Invalid log level");g=a}},{key:"logger",get:function(){return f},set:function(a){if(!a.debug&&a.info&&(a.debug=a.info),!(a.debug&&a.info&&a.warn&&a.error))throw Error("Invalid logger");f=a}}]),a}()).reset()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e={setInterval:function(a){function b(b,c){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a,b){return setInterval(a,b)}),clearInterval:function(a){function b(b){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){return clearInterval(a)})},f=!1,g=null;b.Global=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a._testing=function(){f=!0},a.setXMLHttpRequest=function(a){g=a},d(a,null,[{key:"location",get:function(){if(!f)return location}},{key:"localStorage",get:function(){if(!f&&"undefined"!=typeof window)return localStorage}},{key:"sessionStorage",get:function(){if(!f&&"undefined"!=typeof window)return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!f&&"undefined"!=typeof window)return g||XMLHttpRequest}},{key:"timer",get:function(){if(!f)return e}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.MetadataService=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0),f=c(7),g=".well-known/openid-configuration";b.MetadataService=function(){function a(b){var c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:f.JsonService;if(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),!b)throw e.Log.error("MetadataService: No settings passed to MetadataService"),Error("settings");this._settings=b,this._jsonService=new c(["application/jwk-set+json"])}return a.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},a.prototype.getMetadata=function(){var a=this;return this._settings.metadata?(e.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(e.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(b){e.Log.debug("MetadataService.getMetadata: json received");var c=a._settings.metadataSeed||{};return a._settings.metadata=Object.assign({},c,b),a._settings.metadata})):(e.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(Error("No authority or metadataUrl configured on settings")))},a.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},a.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},a.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},a.prototype.getTokenEndpoint=function(){var a=!(arguments.length>0&& void 0!==arguments[0])||arguments[0];return this._getMetadataProperty("token_endpoint",a)},a.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},a.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},a.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},a.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},a.prototype._getMetadataProperty=function(a){var b=arguments.length>1&& void 0!==arguments[1]&&arguments[1];return e.Log.debug("MetadataService.getMetadataProperty for: "+a),this.getMetadata().then(function(c){if(e.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),void 0===c[a]){if(!0===b)return void e.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+a);throw e.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+a),Error("Metadata does not contain property "+a)}return c[a]})},a.prototype.getSigningKeys=function(){var a=this;return this._settings.signingKeys?(e.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(b){return e.Log.debug("MetadataService.getSigningKeys: jwks_uri received",b),a._jsonService.getJson(b).then(function(b){if(e.Log.debug("MetadataService.getSigningKeys: key set received",b),!b.keys)throw e.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),Error("Missing keys on keyset");return a._settings.signingKeys=b.keys,a._settings.signingKeys})})},d(a,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&0>this._metadataUrl.indexOf(g)&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=g))),this._metadataUrl}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.UrlUtility=void 0;var d=c(0),e=c(1);b.UrlUtility=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a.addQueryParam=function(a,b,c){return 0>a.indexOf("?")&&(a+="?"),"?"!==a[a.length-1]&&(a+="&"),a+=encodeURIComponent(b),a+="=",a+=encodeURIComponent(c)},a.parseUrlFragment=function(a){var b=arguments.length>1&& void 0!==arguments[1]?arguments[1]:"#",c=arguments.length>2&& void 0!==arguments[2]?arguments[2]:e.Global;"string"!=typeof a&&(a=c.location.href);var f=a.lastIndexOf(b);f>=0&&(a=a.substr(f+1)),"?"===b&&(f=a.indexOf("#"))>=0&&(a=a.substr(0,f));for(var g,h={},i=/([^&=]+)=([^&]*)/g,j=0;g=i.exec(a);)if(h[decodeURIComponent(g[1])]=decodeURIComponent(g[2].replace(/\+/g," ")),j++ >50)return d.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",a),{error:"Response exceeded expected number of parameters"};for(var k in h)return h;return{}},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.JoseUtil=void 0;var d,e=c(26),f=(d=c(33))&&d.__esModule?d:{default:d};b.JoseUtil=(0,f.default)({jws:e.jws,KeyUtil:e.KeyUtil,X509:e.X509,crypto:e.crypto,hextob64u:e.hextob64u,b64tohex:e.b64tohex,AllowedSigningAlgs:e.AllowedSigningAlgs})},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.OidcClientSettings=void 0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c(0),g=c(23),h=c(6),i=c(24),j=c(2),k=".well-known/openid-configuration";b.OidcClientSettings=function(){function a(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},c=b.authority,e=b.metadataUrl,f=b.metadata,k=b.signingKeys,l=b.metadataSeed,m=b.client_id,n=b.client_secret,o=b.response_type,p=b.scope,q=b.redirect_uri,r=b.post_logout_redirect_uri,s=b.client_authentication,t=b.prompt,u=b.display,v=b.max_age,w=b.ui_locales,x=b.acr_values,y=b.resource,z=b.response_mode,A=b.filterProtocolClaims,B=b.loadUserInfo,C=b.staleStateAge,D=b.clockSkew,E=b.clockService,F=void 0===E?new g.ClockService:E,G=b.userInfoJwtIssuer,H=b.mergeClaims,I=b.stateStore,J=void 0===I?new h.WebStorageStateStore:I,K=b.ResponseValidatorCtor,L=void 0===K?i.ResponseValidator:K,M=b.MetadataServiceCtor,N=void 0===M?j.MetadataService:M,O=b.extraQueryParams,P=void 0===O?{}:O,Q=b.extraTokenParams,R=void 0===Q?{}:Q;(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")})(this,a),this._authority=c,this._metadataUrl=e,this._metadata=f,this._metadataSeed=l,this._signingKeys=k,this._client_id=m,this._client_secret=n,this._response_type=void 0===o?"id_token":o,this._scope=void 0===p?"openid":p,this._redirect_uri=q,this._post_logout_redirect_uri=r,this._client_authentication=void 0===s?"client_secret_post":s,this._prompt=t,this._display=u,this._max_age=v,this._ui_locales=w,this._acr_values=x,this._resource=y,this._response_mode=z,this._filterProtocolClaims=!!(void 0===A||A),this._loadUserInfo=!!(void 0===B||B),this._staleStateAge=void 0===C?900:C,this._clockSkew=void 0===D?300:D,this._clockService=F,this._userInfoJwtIssuer=void 0===G?"OP":G,this._mergeClaims=!!(void 0!==H&&H),this._stateStore=J,this._validator=new L(this),this._metadataService=new N(this),this._extraQueryParams="object"===(void 0===P?"undefined":d(P))?P:{},this._extraTokenParams="object"===(void 0===R?"undefined":d(R))?R:{}}return a.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},e(a,[{key:"client_id",get:function(){return this._client_id},set:function(a){if(this._client_id)throw f.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),Error("client_id has already been assigned.");this._client_id=a}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(a){if(this._authority)throw f.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),Error("authority has already been assigned.");this._authority=a}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&0>this._metadataUrl.indexOf(k)&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=k)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(a){this._metadata=a}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(a){this._metadataSeed=a}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(a){this._signingKeys=a}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(a){"object"===(void 0===a?"undefined":d(a))?this._extraQueryParams=a:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(a){"object"===(void 0===a?"undefined":d(a))?this._extraTokenParams=a:this._extraTokenParams={}}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.WebStorageStateStore=void 0;var d=c(0),e=c(1);b.WebStorageStateStore=function(){function a(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},c=b.prefix,d=b.store,f=void 0===d?e.Global.localStorage:d;(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")})(this,a),this._store=f,this._prefix=void 0===c?"oidc.":c}return a.prototype.set=function(a,b){return d.Log.debug("WebStorageStateStore.set",a),a=this._prefix+a,this._store.setItem(a,b),Promise.resolve()},a.prototype.get=function(a){return d.Log.debug("WebStorageStateStore.get",a),a=this._prefix+a,Promise.resolve(this._store.getItem(a))},a.prototype.remove=function(a){d.Log.debug("WebStorageStateStore.remove",a),a=this._prefix+a;var b=this._store.getItem(a);return this._store.removeItem(a),Promise.resolve(b)},a.prototype.getAllKeys=function(){d.Log.debug("WebStorageStateStore.getAllKeys");for(var a=[],b=0;b<this._store.length;b++){var c=this._store.key(b);0===c.indexOf(this._prefix)&&a.push(c.substr(this._prefix.length))}return Promise.resolve(a)},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.JsonService=void 0;var d=c(0),e=c(1);b.JsonService=function(){function a(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:e.Global.XMLHttpRequest,d=arguments.length>2&& void 0!==arguments[2]?arguments[2]:null;(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")})(this,a),b&&Array.isArray(b)?this._contentTypes=b.slice():this._contentTypes=[],this._contentTypes.push("application/json"),d&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=c,this._jwtHandler=d}return a.prototype.getJson=function(a,b){var c=this;if(!a)throw d.Log.error("JsonService.getJson: No url passed"),Error("url");return d.Log.debug("JsonService.getJson, url: ",a),new Promise(function(e,f){var g=new c._XMLHttpRequest;g.open("GET",a);var h=c._contentTypes,i=c._jwtHandler;g.onload=function(){if(d.Log.debug("JsonService.getJson: HTTP response received, status",g.status),200===g.status){var b=g.getResponseHeader("Content-Type");if(b){var c=h.find(function(a){if(b.startsWith(a))return!0});if("application/jwt"==c)return void i(g).then(e,f);if(c)try{return void e(JSON.parse(g.responseText))}catch(j){return d.Log.error("JsonService.getJson: Error parsing JSON response",j.message),void f(j)}}f(Error("Invalid response Content-Type: "+b+", from URL: "+a))}else f(Error(g.statusText+" ("+g.status+")"))},g.onerror=function(){d.Log.error("JsonService.getJson: network error"),f(Error("Network Error"))},b&&(d.Log.debug("JsonService.getJson: token passed, setting Authorization header"),g.setRequestHeader("Authorization","Bearer "+b)),g.send()})},a.prototype.postForm=function(a,b,c){var e=this;if(!a)throw d.Log.error("JsonService.postForm: No url passed"),Error("url");return d.Log.debug("JsonService.postForm, url: ",a),new Promise(function(f,g){var h=new e._XMLHttpRequest;h.open("POST",a);var i=e._contentTypes;h.onload=function(){if(d.Log.debug("JsonService.postForm: HTTP response received, status",h.status),200!==h.status){if(400===h.status&&(b=h.getResponseHeader("Content-Type"))&&i.find(function(a){if(b.startsWith(a))return!0}))try{var b,c=JSON.parse(h.responseText);if(c&&c.error)return d.Log.error("JsonService.postForm: Error from server: ",c.error),void g(Error(c.error))}catch(e){return d.Log.error("JsonService.postForm: Error parsing JSON response",e.message),void g(e)}g(Error(h.statusText+" ("+h.status+")"))}else{if((b=h.getResponseHeader("Content-Type"))&&i.find(function(a){if(b.startsWith(a))return!0}))try{return void f(JSON.parse(h.responseText))}catch(j){return d.Log.error("JsonService.postForm: Error parsing JSON response",j.message),void g(j)}g(Error("Invalid response Content-Type: "+b+", from URL: "+a))}},h.onerror=function(){d.Log.error("JsonService.postForm: network error"),g(Error("Network Error"))};var j="";for(var k in b){var l=b[k];l&&(j.length>0&&(j+="&"),j+=encodeURIComponent(k),j+="=",j+=encodeURIComponent(l))}h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),void 0!==c&&h.setRequestHeader("Authorization","Basic "+btoa(c)),h.send(j)})},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SigninRequest=void 0;var d=c(0),e=c(3),f=c(13);b.SigninRequest=function(){function a(b){var c=b.url,g=b.client_id,h=b.redirect_uri,i=b.response_type,j=b.scope,k=b.authority,l=b.data,m=b.prompt,n=b.display,o=b.max_age,p=b.ui_locales,q=b.id_token_hint,r=b.login_hint,s=b.acr_values,t=b.resource,u=b.response_mode,v=b.request,w=b.request_uri,x=b.extraQueryParams,y=b.request_type,z=b.client_secret,A=b.extraTokenParams,B=b.skipUserInfo;if(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),!c)throw d.Log.error("SigninRequest.ctor: No url passed"),Error("url");if(!g)throw d.Log.error("SigninRequest.ctor: No client_id passed"),Error("client_id");if(!h)throw d.Log.error("SigninRequest.ctor: No redirect_uri passed"),Error("redirect_uri");if(!i)throw d.Log.error("SigninRequest.ctor: No response_type passed"),Error("response_type");if(!j)throw d.Log.error("SigninRequest.ctor: No scope passed"),Error("scope");if(!k)throw d.Log.error("SigninRequest.ctor: No authority passed"),Error("authority");var C=a.isOidc(i),D=a.isCode(i);u||(u=a.isCode(i)?"query":null),this.state=new f.SigninState({nonce:C,data:l,client_id:g,authority:k,redirect_uri:h,code_verifier:D,request_type:y,response_mode:u,client_secret:z,scope:j,extraTokenParams:A,skipUserInfo:B}),c=e.UrlUtility.addQueryParam(c,"client_id",g),c=e.UrlUtility.addQueryParam(c,"redirect_uri",h),c=e.UrlUtility.addQueryParam(c,"response_type",i),c=e.UrlUtility.addQueryParam(c,"scope",j),c=e.UrlUtility.addQueryParam(c,"state",this.state.id),C&&(c=e.UrlUtility.addQueryParam(c,"nonce",this.state.nonce)),D&&(c=e.UrlUtility.addQueryParam(c,"code_challenge",this.state.code_challenge),c=e.UrlUtility.addQueryParam(c,"code_challenge_method","S256"));var E={prompt:m,display:n,max_age:o,ui_locales:p,id_token_hint:q,login_hint:r,acr_values:s,resource:t,request:v,request_uri:w,response_mode:u};for(var F in E)E[F]&&(c=e.UrlUtility.addQueryParam(c,F,E[F]));for(var G in x)c=e.UrlUtility.addQueryParam(c,G,x[G]);this.url=c}return a.isOidc=function(a){return!!a.split(/\s+/g).filter(function(a){return"id_token"===a})[0]},a.isOAuth=function(a){return!!a.split(/\s+/g).filter(function(a){return"token"===a})[0]},a.isCode=function(a){return!!a.split(/\s+/g).filter(function(a){return"code"===a})[0]},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.State=void 0;var d,e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c(0),g=(d=c(14))&&d.__esModule?d:{default:d};b.State=function(){function a(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},c=b.id,d=b.data,e=b.created,f=b.request_type;(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")})(this,a),this._id=c||(0,g.default)(),this._data=d,this._created="number"==typeof e&&e>0?e:parseInt(Date.now()/1e3),this._request_type=f}return a.prototype.toStorageString=function(){return f.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},a.fromStorageString=function(b){return f.Log.debug("State.fromStorageString"),new a(JSON.parse(b))},a.clearStaleState=function(b,c){var d=Date.now()/1e3-c;return b.getAllKeys().then(function(c){f.Log.debug("State.clearStaleState: got keys",c);for(var e,g=[],h=0;h<c.length;h++)(function(h){var i=c[h];e=b.get(i).then(function(c){var e=!1;if(c)try{var g=a.fromStorageString(c);f.Log.debug("State.clearStaleState: got item from key: ",i,g.created),g.created<=d&&(e=!0)}catch(h){f.Log.error("State.clearStaleState: Error parsing state for key",i,h.message),e=!0}else f.Log.debug("State.clearStaleState: no item in storage for key: ",i),e=!0;if(e)return f.Log.debug("State.clearStaleState: removed item for key: ",i),b.remove(i)}),g.push(e)})(h);return f.Log.debug("State.clearStaleState: waiting on promise count:",g.length),Promise.all(g)})},e(a,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.OidcClient=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0),f=c(5),g=c(12),h=c(8),i=c(34),j=c(35),k=c(36),l=c(13),m=c(9);b.OidcClient=function(){function a(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")})(this,a),b instanceof f.OidcClientSettings?this._settings=b:this._settings=new f.OidcClientSettings(b)}return a.prototype.createSigninRequest=function(){var a=this,b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},c=b.response_type,d=b.scope,f=b.redirect_uri,g=b.data,i=b.state,j=b.prompt,k=b.display,l=b.max_age,m=b.ui_locales,n=b.id_token_hint,o=b.login_hint,p=b.acr_values,q=b.resource,r=b.request,s=b.request_uri,t=b.response_mode,u=b.extraQueryParams,v=b.extraTokenParams,w=b.request_type,x=b.skipUserInfo,y=arguments[1];e.Log.debug("OidcClient.createSigninRequest");var z=this._settings.client_id;c=c||this._settings.response_type,d=d||this._settings.scope,f=f||this._settings.redirect_uri,j=j||this._settings.prompt,k=k||this._settings.display,l=l||this._settings.max_age,m=m||this._settings.ui_locales,p=p||this._settings.acr_values,q=q||this._settings.resource,t=t||this._settings.response_mode,u=u||this._settings.extraQueryParams,v=v||this._settings.extraTokenParams;var A=this._settings.authority;return h.SigninRequest.isCode(c)&&"code"!==c?Promise.reject(Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(b){e.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",b);var B=new h.SigninRequest({url:b,client_id:z,redirect_uri:f,response_type:c,scope:d,data:g||i,authority:A,prompt:j,display:k,max_age:l,ui_locales:m,id_token_hint:n,login_hint:o,acr_values:p,resource:q,request:r,request_uri:s,extraQueryParams:u,extraTokenParams:v,request_type:w,response_mode:t,client_secret:a._settings.client_secret,skipUserInfo:x}),C=B.state;return(y=y||a._stateStore).set(C.id,C.toStorageString()).then(function(){return B})})},a.prototype.readSigninResponseState=function(a,b){var c=arguments.length>2&& void 0!==arguments[2]&&arguments[2];e.Log.debug("OidcClient.readSigninResponseState");var d="query"===this._settings.response_mode|| !this._settings.response_mode&&h.SigninRequest.isCode(this._settings.response_type),f=new i.SigninResponse(a,d?"?":"#");return f.state?(b=b||this._stateStore,(c?b.remove.bind(b):b.get.bind(b))(f.state).then(function(a){if(!a)throw e.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),Error("No matching state found in storage");return{state:l.SigninState.fromStorageString(a),response:f}})):(e.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(Error("No state in response")))},a.prototype.processSigninResponse=function(a,b){var c=this;return e.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(a,b,!0).then(function(a){var b=a.state,d=a.response;return e.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),c._validator.validateSigninResponse(b,d)})},a.prototype.createSignoutRequest=function(){var a=this,b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},c=b.id_token_hint,d=b.data,f=b.state,g=b.post_logout_redirect_uri,h=b.extraQueryParams,i=b.request_type,k=arguments[1];return e.Log.debug("OidcClient.createSignoutRequest"),g=g||this._settings.post_logout_redirect_uri,h=h||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(b){if(!b)throw e.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),Error("no end session endpoint");e.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",b);var l=new j.SignoutRequest({url:b,id_token_hint:c,post_logout_redirect_uri:g,data:d||f,extraQueryParams:h,request_type:i}),m=l.state;return m&&(e.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(k=k||a._stateStore).set(m.id,m.toStorageString())),l})},a.prototype.readSignoutResponseState=function(a,b){var c=arguments.length>2&& void 0!==arguments[2]&&arguments[2];e.Log.debug("OidcClient.readSignoutResponseState");var d=new k.SignoutResponse(a);if(!d.state)return e.Log.debug("OidcClient.readSignoutResponseState: No state in response"),d.error?(e.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",d.error),Promise.reject(new g.ErrorResponse(d))):Promise.resolve({state:void 0,response:d});var f=d.state;return b=b||this._stateStore,(c?b.remove.bind(b):b.get.bind(b))(f).then(function(a){if(!a)throw e.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),Error("No matching state found in storage");return{state:m.State.fromStorageString(a),response:d}})},a.prototype.processSignoutResponse=function(a,b){var c=this;return e.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(a,b,!0).then(function(a){var b=a.state,d=a.response;return b?(e.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),c._validator.validateSignoutResponse(b,d)):(e.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),d)})},a.prototype.clearStaleState=function(a){return e.Log.debug("OidcClient.clearStaleState"),a=a||this._stateStore,m.State.clearStaleState(a,this.settings.staleStateAge)},d(a,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.TokenClient=void 0;var d=c(7),e=c(2),f=c(0);b.TokenClient=function(){function a(b){var c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:d.JsonService,g=arguments.length>2&& void 0!==arguments[2]?arguments[2]:e.MetadataService;if(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),!b)throw f.Log.error("TokenClient.ctor: No settings passed"),Error("settings");this._settings=b,this._jsonService=new c,this._metadataService=new g(this._settings)}return a.prototype.exchangeCode=function(){var a=this,b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};(b=Object.assign({},b)).grant_type=b.grant_type||"authorization_code",b.client_id=b.client_id||this._settings.client_id,b.client_secret=b.client_secret||this._settings.client_secret,b.redirect_uri=b.redirect_uri||this._settings.redirect_uri;var c=void 0,d=b._client_authentication||this._settings._client_authentication;return delete b._client_authentication,b.code?b.redirect_uri?b.code_verifier?b.client_id?b.client_secret||"client_secret_basic"!=d?("client_secret_basic"==d&&(c=b.client_id+":"+b.client_secret,delete b.client_id,delete b.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(d){return f.Log.debug("TokenClient.exchangeCode: Received token endpoint"),a._jsonService.postForm(d,b,c).then(function(a){return f.Log.debug("TokenClient.exchangeCode: response received"),a})})):(f.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(Error("A client_secret is required"))):(f.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(Error("A client_id is required"))):(f.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(Error("A code_verifier is required"))):(f.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(Error("A redirect_uri is required"))):(f.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(Error("A code is required")))},a.prototype.exchangeRefreshToken=function(){var a=this,b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};(b=Object.assign({},b)).grant_type=b.grant_type||"refresh_token",b.client_id=b.client_id||this._settings.client_id,b.client_secret=b.client_secret||this._settings.client_secret;var c=void 0,d=b._client_authentication||this._settings._client_authentication;return delete b._client_authentication,b.refresh_token?b.client_id?("client_secret_basic"==d&&(c=b.client_id+":"+b.client_secret,delete b.client_id,delete b.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(d){return f.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),a._jsonService.postForm(d,b,c).then(function(a){return f.Log.debug("TokenClient.exchangeRefreshToken: response received"),a})})):(f.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(Error("A client_id is required"))):(f.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(Error("A refresh_token is required")))},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ErrorResponse=void 0;var d=c(0);b.ErrorResponse=function(a){function b(){var c=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},e=c.error,f=c.error_description,g=c.error_uri,h=c.state,i=c.session_state;if(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,b),!e)throw d.Log.error("No error passed to ErrorResponse"),Error("error");var j=function(a,b){if(!a)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}(this,a.call(this,f||e));return j.name="ErrorResponse",j.error=e,j.error_description=f,j.error_uri=g,j.state=h,j.session_state=i,j}return function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(b,a),b}(Error)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SigninState=void 0;var d,e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c(0),g=c(9),h=c(4),i=(d=c(14))&&d.__esModule?d:{default:d};b.SigninState=function(a){function b(){var c=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},d=c.nonce,e=c.authority,f=c.client_id,g=c.redirect_uri,j=c.code_verifier,k=c.response_mode,l=c.client_secret,m=c.scope,n=c.extraTokenParams,o=c.skipUserInfo;!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,b);var p=function(a,b){if(!a)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}(this,a.call(this,arguments[0]));if(!0===d?p._nonce=(0,i.default)():d&&(p._nonce=d),!0===j?p._code_verifier=(0,i.default)()+(0,i.default)()+(0,i.default)():j&&(p._code_verifier=j),p.code_verifier){var q=h.JoseUtil.hashString(p.code_verifier,"SHA256");p._code_challenge=h.JoseUtil.hexToBase64Url(q)}return p._redirect_uri=g,p._authority=e,p._client_id=f,p._response_mode=k,p._client_secret=l,p._scope=m,p._extraTokenParams=n,p._skipUserInfo=o,p}return function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(b,a),b.prototype.toStorageString=function(){return f.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},b.fromStorageString=function(a){return f.Log.debug("SigninState.fromStorageString"),new b(JSON.parse(a))},e(b,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),b}(g.State)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(){return("undefined"!=d&&null!==d&& void 0!==d.getRandomValues?e:f)().replace(/-/g,"")};var d="undefined"!=typeof window?window.crypto||window.msCrypto:null;function e(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(a){return(a^d.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})}function f(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(a){return(a^16*Math.random()>>a/4).toString(16)})}a.exports=b.default},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.User=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0);b.User=function(){function a(b){var c=b.id_token,d=b.session_state,e=b.access_token,f=b.refresh_token,g=b.token_type,h=b.scope,i=b.profile,j=b.expires_at,k=b.state;!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),this.id_token=c,this.session_state=d,this.access_token=e,this.refresh_token=f,this.token_type=g,this.scope=h,this.profile=i,this.expires_at=j,this.state=k}return a.prototype.toStorageString=function(){return e.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},a.fromStorageString=function(b){return e.Log.debug("User.fromStorageString"),new a(JSON.parse(b))},d(a,[{key:"expires_in",get:function(){if(this.expires_at){var a=parseInt(Date.now()/1e3);return this.expires_at-a}},set:function(a){var b=parseInt(a);if("number"==typeof b&&b>0){var c=parseInt(Date.now()/1e3);this.expires_at=c+b}}},{key:"expired",get:function(){var a=this.expires_in;if(void 0!==a)return a<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.AccessTokenEvents=void 0;var d=c(0),e=c(46);b.AccessTokenEvents=function(){function a(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},c=b.accessTokenExpiringNotificationTime,d=b.accessTokenExpiringTimer,f=void 0===d?new e.Timer("Access token expiring"):d,g=b.accessTokenExpiredTimer,h=void 0===g?new e.Timer("Access token expired"):g;(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")})(this,a),this._accessTokenExpiringNotificationTime=void 0===c?60:c,this._accessTokenExpiring=f,this._accessTokenExpired=h}return a.prototype.load=function(a){if(a.access_token&& void 0!==a.expires_in){var b=a.expires_in;if(d.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",b),b>0){var c=b-this._accessTokenExpiringNotificationTime;c<=0&&(c=1),d.Log.debug("AccessTokenEvents.load: registering expiring timer in:",c),this._accessTokenExpiring.init(c)}else d.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var e=b+1;d.Log.debug("AccessTokenEvents.load: registering expired timer in:",e),this._accessTokenExpired.init(e)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},a.prototype.unload=function(){d.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},a.prototype.addAccessTokenExpiring=function(a){this._accessTokenExpiring.addHandler(a)},a.prototype.removeAccessTokenExpiring=function(a){this._accessTokenExpiring.removeHandler(a)},a.prototype.addAccessTokenExpired=function(a){this._accessTokenExpired.addHandler(a)},a.prototype.removeAccessTokenExpired=function(a){this._accessTokenExpired.removeHandler(a)},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Event=void 0;var d=c(0);b.Event=function(){function a(b){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),this._name=b,this._callbacks=[]}return a.prototype.addHandler=function(a){this._callbacks.push(a)},a.prototype.removeHandler=function(a){var b=this._callbacks.findIndex(function(b){return b===a});b>=0&&this._callbacks.splice(b,1)},a.prototype.raise=function(){d.Log.debug("Event: Raising event: "+this._name);for(var a,b=0;b<this._callbacks.length;b++)(a=this._callbacks)[b].apply(a,arguments)},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SessionMonitor=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0),f=c(19),g=c(1);b.SessionMonitor=function(){function a(b){var c=this,d=arguments.length>1&& void 0!==arguments[1]?arguments[1]:f.CheckSessionIFrame,h=arguments.length>2&& void 0!==arguments[2]?arguments[2]:g.Global.timer;if(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),!b)throw e.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),Error("userManager");this._userManager=b,this._CheckSessionIFrameCtor=d,this._timer=h,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(a){a?c._start(a):c._settings.monitorAnonymousSession&&c._userManager.querySessionStatus().then(function(a){var b={session_state:a.session_state};a.sub&&a.sid&&(b.profile={sub:a.sub,sid:a.sid}),c._start(b)}).catch(function(a){e.Log.error("SessionMonitor ctor: error from querySessionStatus:",a.message)})}).catch(function(a){e.Log.error("SessionMonitor ctor: error from getUser:",a.message)}))}return a.prototype._start=function(a){var b=this,c=a.session_state;c&&(a.profile?(this._sub=a.profile.sub,this._sid=a.profile.sid,e.Log.debug("SessionMonitor._start: session_state:",c,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,e.Log.debug("SessionMonitor._start: session_state:",c,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(c):this._metadataService.getCheckSessionIframe().then(function(a){if(a){e.Log.debug("SessionMonitor._start: Initializing check session iframe");var d=b._client_id,f=b._checkSessionInterval,g=b._stopCheckSessionOnError;b._checkSessionIFrame=new b._CheckSessionIFrameCtor(b._callback.bind(b),d,a,f,g),b._checkSessionIFrame.load().then(function(){b._checkSessionIFrame.start(c)})}else e.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(a){e.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",a.message)}))},a.prototype._stop=function(){var a=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(e.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var b=this._timer.setInterval(function(){a._timer.clearInterval(b),a._userManager.querySessionStatus().then(function(b){var c={session_state:b.session_state};b.sub&&b.sid&&(c.profile={sub:b.sub,sid:b.sid}),a._start(c)}).catch(function(a){e.Log.error("SessionMonitor: error from querySessionStatus:",a.message)})},1e3)},a.prototype._callback=function(){var a=this;this._userManager.querySessionStatus().then(function(b){var c=!0;b?b.sub===a._sub?(c=!1,a._checkSessionIFrame.start(b.session_state),b.sid===a._sid?e.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",b.session_state):(e.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",b.session_state),a._userManager.events._raiseUserSessionChanged())):e.Log.debug("SessionMonitor._callback: Different subject signed into OP:",b.sub):e.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),c&&(a._sub?(e.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),a._userManager.events._raiseUserSignedOut()):(e.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),a._userManager.events._raiseUserSignedIn()))}).catch(function(b){a._sub&&(e.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",b.message),a._userManager.events._raiseUserSignedOut())})},d(a,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.CheckSessionIFrame=void 0;var d=c(0);b.CheckSessionIFrame=function(){function a(b,c,d,e){var f=!(arguments.length>4&& void 0!==arguments[4])||arguments[4];(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")})(this,a),this._callback=b,this._client_id=c,this._url=d,this._interval=e||2e3,this._stopOnError=f;var g=d.indexOf("/",d.indexOf("//")+2);this._frame_origin=d.substr(0,g),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=d}return a.prototype.load=function(){var a=this;return new Promise(function(b){a._frame.onload=function(){b()},window.document.body.appendChild(a._frame),a._boundMessageEvent=a._message.bind(a),window.addEventListener("message",a._boundMessageEvent,!1)})},a.prototype._message=function(a){a.origin===this._frame_origin&&a.source===this._frame.contentWindow&&("error"===a.data?(d.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):"changed"===a.data?(d.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):d.Log.debug("CheckSessionIFrame: "+a.data+" message from check session op iframe"))},a.prototype.start=function(a){var b=this;if(this._session_state!==a){d.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=a;var c=function(){b._frame.contentWindow.postMessage(b._client_id+" "+b._session_state,b._frame_origin)};c(),this._timer=window.setInterval(c,this._interval)}},a.prototype.stop=function(){this._session_state=null,this._timer&&(d.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.TokenRevocationClient=void 0;var d=c(0),e=c(2),f=c(1);b.TokenRevocationClient=function(){function a(b){var c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:f.Global.XMLHttpRequest,g=arguments.length>2&& void 0!==arguments[2]?arguments[2]:e.MetadataService;if(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),!b)throw d.Log.error("TokenRevocationClient.ctor: No settings provided"),Error("No settings provided.");this._settings=b,this._XMLHttpRequestCtor=c,this._metadataService=new g(this._settings)}return a.prototype.revoke=function(a,b){var c=this,e=arguments.length>2&& void 0!==arguments[2]?arguments[2]:"access_token";if(!a)throw d.Log.error("TokenRevocationClient.revoke: No token provided"),Error("No token provided.");if("access_token"!==e&&"refresh_token"!=e)throw d.Log.error("TokenRevocationClient.revoke: Invalid token type"),Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(f){if(f){d.Log.debug("TokenRevocationClient.revoke: Revoking "+e);var g=c._settings.client_id,h=c._settings.client_secret;return c._revoke(f,g,h,a,e)}if(b)throw d.Log.error("TokenRevocationClient.revoke: Revocation not supported"),Error("Revocation not supported")})},a.prototype._revoke=function(a,b,c,e,f){var g=this;return new Promise(function(h,i){var j=new g._XMLHttpRequestCtor;j.open("POST",a),j.onload=function(){d.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",j.status),200===j.status?h():i(Error(j.statusText+" ("+j.status+")"))},j.onerror=function(){d.Log.debug("TokenRevocationClient.revoke: Network Error."),i("Network Error")};var k="client_id="+encodeURIComponent(b);c&&(k+="&client_secret="+encodeURIComponent(c)),k+="&token_type_hint="+encodeURIComponent(f),k+="&token="+encodeURIComponent(e),j.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),j.send(k)})},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.CordovaPopupWindow=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0);b.CordovaPopupWindow=function(){function a(b){var c=this;!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),this._promise=new Promise(function(a,b){c._resolve=a,c._reject=b}),this.features=b.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=b.popupWindowTarget||"_blank",this.redirect_uri=b.startUrl,e.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return a.prototype._isInAppBrowserInstalled=function(a){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(b){return a.hasOwnProperty(b)})},a.prototype.navigate=function(a){if(a&&a.url){if(!window.cordova)return this._error("cordova is undefined");var b=window.cordova.require("cordova/plugin_list").metadata;if(!1===this._isInAppBrowserInstalled(b))return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(a.url,this.target,this.features),this._popup?(e.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},a.prototype._loadStartCallback=function(a){0===a.url.indexOf(this.redirect_uri)&&this._success({url:a.url})},a.prototype._exitCallback=function(a){this._error(a)},a.prototype._success=function(a){this._cleanup(),e.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(a)},a.prototype._error=function(a){this._cleanup(),e.Log.error(a),this._reject(Error(a))},a.prototype.close=function(){this._cleanup()},a.prototype._cleanup=function(){this._popup&&(e.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},d(a,[{key:"promise",get:function(){return this._promise}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(0),e=c(10),f=c(5),g=c(6),h=c(37),i=c(38),j=c(16),k=c(2),l=c(48),m=c(49),n=c(19),o=c(20),p=c(18),q=c(1),r=c(15),s=c(50);b.default={Version:s.Version,Log:d.Log,OidcClient:e.OidcClient,OidcClientSettings:f.OidcClientSettings,WebStorageStateStore:g.WebStorageStateStore,InMemoryWebStorage:h.InMemoryWebStorage,UserManager:i.UserManager,AccessTokenEvents:j.AccessTokenEvents,MetadataService:k.MetadataService,CordovaPopupNavigator:l.CordovaPopupNavigator,CordovaIFrameNavigator:m.CordovaIFrameNavigator,CheckSessionIFrame:n.CheckSessionIFrame,TokenRevocationClient:o.TokenRevocationClient,SessionMonitor:p.SessionMonitor,Global:q.Global,User:r.User},a.exports=b.default},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ClockService=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ResponseValidator=void 0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=c(0),f=c(2),g=c(25),h=c(11),i=c(12),j=c(4),k=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];b.ResponseValidator=function(){function a(b){var c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:f.MetadataService,d=arguments.length>2&& void 0!==arguments[2]?arguments[2]:g.UserInfoService,i=arguments.length>3&& void 0!==arguments[3]?arguments[3]:j.JoseUtil,k=arguments.length>4&& void 0!==arguments[4]?arguments[4]:h.TokenClient;if(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),!b)throw e.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),Error("settings");this._settings=b,this._metadataService=new c(this._settings),this._userInfoService=new d(this._settings),this._joseUtil=i,this._tokenClient=new k(this._settings)}return a.prototype.validateSigninResponse=function(a,b){var c=this;return e.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(a,b).then(function(b){return e.Log.debug("ResponseValidator.validateSigninResponse: state processed"),c._validateTokens(a,b).then(function(b){return e.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),c._processClaims(a,b).then(function(a){return e.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),a})})})},a.prototype.validateSignoutResponse=function(a,b){return a.id!==b.state?(e.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(Error("State does not match"))):(e.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),b.state=a.data,b.error?(e.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",b.error),Promise.reject(new i.ErrorResponse(b))):Promise.resolve(b))},a.prototype._processSigninParams=function(a,b){if(a.id!==b.state)return e.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(Error("State does not match"));if(!a.client_id)return e.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(Error("No client_id on state"));if(!a.authority)return e.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==a.authority)return e.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=a.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==a.client_id)return e.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=a.client_id;return e.Log.debug("ResponseValidator._processSigninParams: state validated"),b.state=a.data,b.error?(e.Log.warn("ResponseValidator._processSigninParams: Response was error",b.error),Promise.reject(new i.ErrorResponse(b))):a.nonce&&!b.id_token?(e.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(Error("No id_token in response"))):!a.nonce&&b.id_token?(e.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(Error("Unexpected id_token in response"))):a.code_verifier&&!b.code?(e.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(Error("No code in response"))):!a.code_verifier&&b.code?(e.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(Error("Unexpected code in response"))):(b.scope||(b.scope=a.scope),Promise.resolve(b))},a.prototype._processClaims=function(a,b){var c=this;if(b.isOpenIdConnect){if(e.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),b.profile=this._filterProtocolClaims(b.profile),!0!==a.skipUserInfo&&this._settings.loadUserInfo&&b.access_token)return e.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(b.access_token).then(function(a){return e.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),a.sub!==b.profile.sub?(e.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(Error("sub from user info endpoint does not match sub in id_token"))):(b.profile=c._mergeClaims(b.profile,a),e.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",b.profile),b)});e.Log.debug("ResponseValidator._processClaims: not loading user info")}else e.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(b)},a.prototype._mergeClaims=function(a,b){var c=Object.assign({},a);for(var e in b){var f=b[e];Array.isArray(f)||(f=[f]);for(var g=0;g<f.length;g++){var h=f[g];c[e]?Array.isArray(c[e])?0>c[e].indexOf(h)&&c[e].push(h):c[e]!==h&&("object"===(void 0===h?"undefined":d(h))&&this._settings.mergeClaims?c[e]=this._mergeClaims(c[e],h):c[e]=[c[e],h]):c[e]=h}}return c},a.prototype._filterProtocolClaims=function(a){e.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",a);var b=Object.assign({},a);return this._settings._filterProtocolClaims?(k.forEach(function(a){delete b[a]}),e.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",b)):e.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),b},a.prototype._validateTokens=function(a,b){return b.code?(e.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(a,b)):b.id_token?b.access_token?(e.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(a,b)):(e.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(a,b)):(e.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(b))},a.prototype._processCode=function(a,b){var c=this,f={client_id:a.client_id,client_secret:a.client_secret,code:b.code,redirect_uri:a.redirect_uri,code_verifier:a.code_verifier};return a.extraTokenParams&&"object"===d(a.extraTokenParams)&&Object.assign(f,a.extraTokenParams),this._tokenClient.exchangeCode(f).then(function(d){for(var f in d)b[f]=d[f];return b.id_token?(e.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),c._validateIdTokenAttributes(a,b)):(e.Log.debug("ResponseValidator._processCode: token response successful, returning response"),b)})},a.prototype._validateIdTokenAttributes=function(a,b){var c=this;return this._metadataService.getIssuer().then(function(d){var f=a.client_id,g=c._settings.clockSkew;return e.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",g),c._settings.getEpochTime().then(function(h){return c._joseUtil.validateJwtAttributes(b.id_token,d,f,g,h).then(function(c){return a.nonce&&a.nonce!==c.nonce?(e.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(Error("Invalid nonce in id_token"))):c.sub?(b.profile=c,b):(e.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(Error("No sub present in id_token")))})})})},a.prototype._validateIdTokenAndAccessToken=function(a,b){var c=this;return this._validateIdToken(a,b).then(function(a){return c._validateAccessToken(a)})},a.prototype._getSigningKeyForJwt=function(a){var b=this;return this._metadataService.getSigningKeys().then(function(c){var d=a.header.kid;if(!c)return e.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(Error("No signing keys from metadata"));e.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var f=void 0;if(d)f=c.filter(function(a){return a.kid===d})[0];else{if((c=b._filterByAlg(c,a.header.alg)).length>1)return e.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(Error("No kid found in id_token and more than one key found in metadata"));f=c[0]}return Promise.resolve(f)})},a.prototype._getSigningKeyForJwtWithSingleRetry=function(a){var b=this;return this._getSigningKeyForJwt(a).then(function(c){return c?Promise.resolve(c):(b._metadataService.resetSigningKeys(),b._getSigningKeyForJwt(a))})},a.prototype._validateIdToken=function(a,b){var c=this;if(!a.nonce)return e.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(Error("No nonce on state"));var d=this._joseUtil.parseJwt(b.id_token);return d&&d.header&&d.payload?a.nonce!==d.payload.nonce?(e.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(f){return e.Log.debug("ResponseValidator._validateIdToken: Received issuer"),c._getSigningKeyForJwtWithSingleRetry(d).then(function(g){if(!g)return e.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(Error("No key matching kid or alg found in signing keys"));var h=a.client_id,i=c._settings.clockSkew;return e.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",i),c._joseUtil.validateJwt(b.id_token,g,f,h,i).then(function(){return e.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),d.payload.sub?(b.profile=d.payload,b):(e.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(Error("No sub present in id_token")))})})}):(e.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",d),Promise.reject(Error("Failed to parse id_token")))},a.prototype._filterByAlg=function(a,b){var c=null;if(b.startsWith("RS"))c="RSA";else if(b.startsWith("PS"))c="PS";else{if(!b.startsWith("ES"))return e.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",b),[];c="EC"}return e.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",c),a=a.filter(function(a){return a.kty===c}),e.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",c,a.length),a},a.prototype._validateAccessToken=function(a){if(!a.profile)return e.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(Error("No profile loaded from id_token"));if(!a.profile.at_hash)return e.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(Error("No at_hash in id_token"));if(!a.id_token)return e.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(Error("No id_token"));var b=this._joseUtil.parseJwt(a.id_token);if(!b||!b.header)return e.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",b),Promise.reject(Error("Failed to parse id_token"));var c=b.header.alg;if(!c||5!==c.length)return e.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",c),Promise.reject(Error("Unsupported alg: "+c));var d=c.substr(2,3);if(!d||256!==(d=parseInt(d))&&384!==d&&512!==d)return e.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",c,d),Promise.reject(Error("Unsupported alg: "+c));var f="sha"+d,g=this._joseUtil.hashString(a.access_token,f);if(!g)return e.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",f),Promise.reject(Error("Failed to validate at_hash"));var h=g.substr(0,g.length/2),i=this._joseUtil.hexToBase64Url(h);return i!==a.profile.at_hash?(e.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",i,a.profile.at_hash),Promise.reject(Error("Failed to validate at_hash"))):(e.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(a))},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.UserInfoService=void 0;var d=c(7),e=c(2),f=c(0),g=c(4);b.UserInfoService=function(){function a(b){var c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:d.JsonService,h=arguments.length>2&& void 0!==arguments[2]?arguments[2]:e.MetadataService,i=arguments.length>3&& void 0!==arguments[3]?arguments[3]:g.JoseUtil;if(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),!b)throw f.Log.error("UserInfoService.ctor: No settings passed"),Error("settings");this._settings=b,this._jsonService=new c(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new h(this._settings),this._joseUtil=i}return a.prototype.getClaims=function(a){var b=this;return a?this._metadataService.getUserInfoEndpoint().then(function(c){return f.Log.debug("UserInfoService.getClaims: received userinfo url",c),b._jsonService.getJson(c,a).then(function(a){return f.Log.debug("UserInfoService.getClaims: claims received",a),a})}):(f.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(Error("A token is required")))},a.prototype._getClaimsFromJwt=function(a){var b=this;try{var c=this._joseUtil.parseJwt(a.responseText);if(!c||!c.header||!c.payload)return f.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",c),Promise.reject(Error("Failed to parse id_token"));var d=c.header.kid,e=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":e=this._metadataService.getIssuer();break;case"ANY":e=Promise.resolve(c.payload.iss);break;default:e=Promise.resolve(this._settings.userInfoJwtIssuer)}return e.then(function(e){return f.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+e),b._metadataService.getSigningKeys().then(function(g){if(!g)return f.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(Error("No signing keys from metadata"));f.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var h=void 0;if(d)h=g.filter(function(a){return a.kid===d})[0];else{if((g=b._filterByAlg(g,c.header.alg)).length>1)return f.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(Error("No kid found in id_token and more than one key found in metadata"));h=g[0]}if(!h)return f.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(Error("No key matching kid or alg found in signing keys"));var i=b._settings.client_id,j=b._settings.clockSkew;return f.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",j),b._joseUtil.validateJwt(a.responseText,h,e,i,j,void 0,!0).then(function(){return f.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),c.payload})})})}catch(g){return f.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",g.message),void reject(g)}},a.prototype._filterByAlg=function(a,b){var c=null;if(b.startsWith("RS"))c="RSA";else if(b.startsWith("PS"))c="PS";else{if(!b.startsWith("ES"))return f.Log.debug("UserInfoService._filterByAlg: alg not supported: ",b),[];c="EC"}return f.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",c),a=a.filter(function(a){return a.kty===c}),f.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",c,a.length),a},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.AllowedSigningAlgs=b.b64tohex=b.hextob64u=b.crypto=b.X509=b.KeyUtil=b.jws=void 0;var d=c(27);b.jws=d.jws,b.KeyUtil=d.KEYUTIL,b.X509=d.X509,b.crypto=d.crypto,b.hextob64u=d.hextob64u,b.b64tohex=d.b64tohex,b.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},H={userAgent:!1},I={},J=J||(k=Math,n=(m=(l={}).lib={}).Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),o=m.WordArray=n.extend({init:function(a,b){a=this.words=a||[],this.sigBytes=null!=b?b:4*a.length},toString:function(a){return(a||q).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;f<e;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else for(f=0;f<e;f+=4)b[d+f>>>2]=c[f>>>2];return this.sigBytes+=e,this},clamp:function(){var a=this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-b%4*8,a.length=k.ceil(b/4)},clone:function(){var a=n.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var b=[],c=0;c<a;c+=4)b.push(4294967296*k.random()|0);return new o.init(b,a)}}),p=l.enc={},q=p.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;e<c;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new o.init(c,b/2)}},r=p.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;e<c;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new o.init(c,b)}},s=p.Utf8={stringify:function(a){try{return decodeURIComponent(escape(r.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return r.parse(unescape(encodeURIComponent(a)))}},t=m.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=s.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var b=this._data,c=b.words,d=b.sigBytes,e=this.blockSize,f=d/(4*e),g=(f=a?k.ceil(f):k.max((0|f)-this._minBufferSize,0))*e,h=k.min(4*g,d);if(g){for(var i=0;i<g;i+=e)this._doProcessBlock(c,i);var j=c.splice(0,g);b.sigBytes-=h}return new o.init(j,h)},clone:function(){var a=n.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),m.Hasher=t.extend({cfg:n.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){t.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new u.HMAC.init(a,c).finalize(b)}}}),u=l.algo={},l);x=(w=(v=J).lib).Base,y=w.WordArray,(v=v.x64={}).Word=x.extend({init:function(a,b){this.high=a,this.low=b}}),v.WordArray=x.extend({init:function(a,b){a=this.words=a||[],this.sigBytes=null!=b?b:8*a.length},toX32:function(){for(var a=this.words,b=a.length,c=[],d=0;d<b;d++){var e=a[d];c.push(e.high),c.push(e.low)}return y.create(c,this.sigBytes)},clone:function(){for(var a=x.clone.call(this),b=a.words=this.words.slice(0),c=b.length,d=0;d<c;d++)b[d]=b[d].clone();return a}}),z=J,A=z.lib.WordArray,z.enc.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp(),a=[];for(var e=0;e<c;e+=3)for(var f=(b[e>>>2]>>>24-e%4*8&255)<<16|(b[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|b[e+2>>>2]>>>24-(e+2)%4*8&255,g=0;4>g&&e+.75*g<c;g++)a.push(d.charAt(f>>>6*(3-g)&63));if(b=d.charAt(64))for(;a.length%4;)a.push(b);return a.join("")},parse:function(a){var b=a.length,c=this._map;(d=c.charAt(64))&& -1!=(d=a.indexOf(d))&&(b=d);for(var d=[],e=0,f=0;f<b;f++)if(f%4){var g=c.indexOf(a.charAt(f-1))<<f%4*2,h=c.indexOf(a.charAt(f))>>>6-f%4*2;d[e>>>2]|=(g|h)<<24-e%4*8,e++}return A.create(d,e)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(a){for(var b,c=J,d=(f=c.lib).WordArray,e=f.Hasher,f=c.algo,g=[],h=[],i=function(a){return 4294967296*(a-(0|a))|0},j=2,k=0;64>k;){t:{b=j;for(var l=a.sqrt(b),m=2;m<=l;m++)if(!(b%m)){b=!1;break t}b=!0}b&&(8>k&&(g[k]=i(a.pow(j,.5))),h[k]=i(a.pow(j,1/3)),k++),j++}var n=[];f=f.SHA256=e.extend({_doReset:function(){this._hash=new d.init(g.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],i=c[4],j=c[5],k=c[6],l=c[7],m=0;64>m;m++){if(16>m)n[m]=0|a[b+m];else{var o=n[m-15],p=n[m-2];n[m]=((o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3)+n[m-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+n[m-16]}o=l+((i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25))+(i&j^ ~i&k)+h[m]+n[m],p=((d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22))+(d&e^d&f^e&f),l=k,k=j,j=i,i=g+o|0,g=f,f=e,e=d,d=o+p|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+i|0,c[5]=c[5]+j|0,c[6]=c[6]+k|0,c[7]=c[7]+l|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[14+(e+64>>>9<<4)]=a.floor(d/4294967296),c[15+(e+64>>>9<<4)]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}}),c.SHA256=e._createHelper(f),c.HmacSHA256=e._createHmacHelper(f)}(Math),function(){function a(){return d.create.apply(d,arguments)}for(var b=J,c=b.lib.Hasher,d=(f=b.x64).Word,e=f.WordArray,f=b.algo,g=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],h=[],i=0;80>i;i++)h[i]=a();f=f.SHA512=c.extend({_doReset:function(){this._hash=new e.init([new d.init(1779033703,4089235720),new d.init(3144134277,2227873595),new d.init(1013904242,4271175723),new d.init(2773480762,1595750129),new d.init(1359893119,2917565137),new d.init(2600822924,725511199),new d.init(528734635,4215389547),new d.init(1541459225,327033209)])},_doProcessBlock:function(a,b){for(var c=(l=this._hash.words)[0],d=l[1],e=l[2],f=l[3],i=l[4],j=l[5],k=l[6],l=l[7],m=c.high,n=c.low,o=d.high,p=d.low,q=e.high,r=e.low,s=f.high,t=f.low,u=i.high,v=i.low,w=j.high,x=j.low,y=k.high,z=k.low,A=l.high,B=l.low,C=m,D=n,E=o,F=p,G=q,H=r,I=s,J=t,K=u,L=v,M=w,N=x,O=y,P=z,Q=A,R=B,S=0;80>S;S++){var T=h[S];if(16>S)var U=T.high=0|a[b+2*S],V=T.low=0|a[b+2*S+1];else{U=((V=(U=h[S-15]).high)>>>1|(W=U.low)<<31)^(V>>>8|W<<24)^V>>>7;var W=(W>>>1|V<<31)^(W>>>8|V<<24)^(W>>>7|V<<25),X=((V=(X=h[S-2]).high)>>>19|(Y=X.low)<<13)^(V<<3|Y>>>29)^V>>>6,Y=(Y>>>19|V<<13)^(Y<<3|V>>>29)^(Y>>>6|V<<26),Z=(V=h[S-7]).high,$=(_=h[S-16]).high,_=_.low;U=(U=(U=U+Z+((V=W+V.low)>>>0<W>>>0?1:0))+X+((V+=Y)>>>0<Y>>>0?1:0))+$+((V+=_)>>>0<_>>>0?1:0),T.high=U,T.low=V}Z=K&M^ ~K&O,_=L&N^ ~L&P,T=C&E^C&G^E&G;var aa=D&F^D&H^F&H,ab=(W=(C>>>28|D<<4)^(C<<30|D>>>2)^(C<<25|D>>>7),X=(D>>>28|C<<4)^(D<<30|C>>>2)^(D<<25|C>>>7),(Y=g[S]).high),ac=Y.low;$=Q+((K>>>14|L<<18)^(K>>>18|L<<14)^(K<<23|L>>>9))+((Y=R+((L>>>14|K<<18)^(L>>>18|K<<14)^(L<<23|K>>>9)))>>>0<R>>>0?1:0),Q=O,R=P,O=M,P=N,M=K,N=L,K=I+($=($=($=$+Z+((Y+=_)>>>0<_>>>0?1:0))+ab+((Y+=ac)>>>0<ac>>>0?1:0))+U+((Y+=V)>>>0<V>>>0?1:0))+((L=J+Y|0)>>>0<J>>>0?1:0)|0,I=G,J=H,G=E,H=F,E=C,F=D,C=$+(T=W+T+((V=X+aa)>>>0<X>>>0?1:0))+((D=Y+V|0)>>>0<Y>>>0?1:0)|0}n=c.low=n+D,c.high=m+C+(n>>>0<D>>>0?1:0),p=d.low=p+F,d.high=o+E+(p>>>0<F>>>0?1:0),r=e.low=r+H,e.high=q+G+(r>>>0<H>>>0?1:0),t=f.low=t+J,f.high=s+I+(t>>>0<J>>>0?1:0),v=i.low=v+L,i.high=u+K+(v>>>0<L>>>0?1:0),x=j.low=x+N,j.high=w+M+(x>>>0<N>>>0?1:0),z=k.low=z+P,k.high=y+O+(z>>>0<P>>>0?1:0),B=l.low=B+R,l.high=A+Q+(B>>>0<R>>>0?1:0)},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[30+(d+128>>>10<<5)]=Math.floor(c/4294967296),b[31+(d+128>>>10<<5)]=c,a.sigBytes=4*b.length,this._process(),this._hash.toX32()},clone:function(){var a=c.clone.call(this);return a._hash=this._hash.clone(),a},blockSize:32}),b.SHA512=c._createHelper(f),b.HmacSHA512=c._createHmacHelper(f)}(),B=J,C=(F=B.x64).Word,D=F.WordArray,E=(F=B.algo).SHA512,F=F.SHA384=E.extend({_doReset:function(){this._hash=new D.init([new C.init(3418070365,3238371032),new C.init(1654270250,914150663),new C.init(2438529370,812702999),new C.init(355462360,4144912697),new C.init(1731405415,4290775857),new C.init(2394180231,1750603025),new C.init(3675008525,1694076839),new C.init(1203062813,3204075428)])},_doFinalize:function(){var a=E._doFinalize.call(this);return a.sigBytes-=16,a}}),B.SHA384=E._createHelper(F),B.HmacSHA384=E._createHmacHelper(F);/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */ var K,L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function M(a){var b,c,d="";for(b=0;b+3<=a.length;b+=3)c=parseInt(a.substring(b,b+3),16),d+=L.charAt(c>>6)+L.charAt(63&c);for(b+1==a.length?(c=parseInt(a.substring(b,b+1),16),d+=L.charAt(c<<2)):b+2==a.length&&(c=parseInt(a.substring(b,b+2),16),d+=L.charAt(c>>2)+L.charAt((3&c)<<4));(3&d.length)>0;)d+="=";return d}function N(a){var b,c,d,e="",f=0;for(b=0;b<a.length&&"="!=a.charAt(b);++b)(d=L.indexOf(a.charAt(b)))<0||(0==f?(e+=U(d>>2),c=3&d,f=1):1==f?(e+=U(c<<2|d>>4),c=15&d,f=2):2==f?(e+=U(c),e+=U(d>>2),c=3&d,f=3):(e+=U(c<<2|d>>4),e+=U(15&d),f=0));return 1==f&&(e+=U(c<<2)),e}function O(a){var b,c=N(a),d=[];for(b=0;2*b<c.length;++b)d[b]=parseInt(c.substring(2*b,2*b+2),16);return d}function P(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function Q(){return new P(null)}"Microsoft Internet Explorer"==H.appName?(P.prototype.am=function(a,b,c,d,e,f){for(var g=32767&b,h=b>>15;--f>=0;){var i=32767&this[a],j=this[a++]>>15,k=h*i+j*g;e=((i=g*i+((32767&k)<<15)+c[d]+(1073741823&e))>>>30)+(k>>>15)+h*j+(e>>>30),c[d++]=1073741823&i}return e},K=30):"Netscape"!=H.appName?(P.prototype.am=function(a,b,c,d,e,f){for(;--f>=0;){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=67108863&g}return e},K=26):(P.prototype.am=function(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this[a],j=this[a++]>>14,k=h*i+j*g;e=((i=g*i+((16383&k)<<14)+c[d]+e)>>28)+(k>>14)+h*j,c[d++]=268435455&i}return e},K=28),P.prototype.DB=K,P.prototype.DM=(1<<K)-1,P.prototype.DV=1<<K,P.prototype.FV=4503599627370496,P.prototype.F1=52-K,P.prototype.F2=2*K-52;var R,S,T=[];for(R=48,S=0;S<=9;++S)T[R++]=S;for(R=97,S=10;S<36;++S)T[R++]=S;for(R=65,S=10;S<36;++S)T[R++]=S;function U(a){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(a)}function V(a,b){var c=T[a.charCodeAt(b)];return null==c?-1:c}function W(a){var b=Q();return b.fromInt(a),b}function X(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function Y(a){this.m=a}function Z(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function $(a,b){return a&b}function _(a,b){return a|b}function aa(a,b){return a^b}function ab(a,b){return a& ~b}function ac(a){if(0==a)return -1;var b=0;return 0==(65535&a)&&(a>>=16,b+=16),0==(255&a)&&(a>>=8,b+=8),0==(15&a)&&(a>>=4,b+=4),0==(3&a)&&(a>>=2,b+=2),0==(1&a)&& ++b,b}function ad(a){for(var b=0;0!=a;)a&=a-1,++b;return b}function ae(){}function af(a){return a}function ag(a){this.r2=Q(),this.q3=Q(),P.ONE.dlShiftTo(2*a.t,this.r2),this.mu=this.r2.divide(a),this.m=a}Y.prototype.convert=function(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a},Y.prototype.revert=function(a){return a},Y.prototype.reduce=function(a){a.divRemTo(this.m,null,a)},Y.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c),this.reduce(c)},Y.prototype.sqrTo=function(a,b){a.squareTo(b),this.reduce(b)},Z.prototype.convert=function(a){var b=Q();return a.abs().dlShiftTo(this.m.t,b),b.divRemTo(this.m,null,b),a.s<0&&b.compareTo(P.ZERO)>0&&this.m.subTo(b,b),b},Z.prototype.revert=function(a){var b=Q();return a.copyTo(b),this.reduce(b),b},Z.prototype.reduce=function(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(a[c=b+this.m.t]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)},Z.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c),this.reduce(c)},Z.prototype.sqrTo=function(a,b){a.squareTo(b),this.reduce(b)},P.prototype.copyTo=function(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s},P.prototype.fromInt=function(a){this.t=1,this.s=a<0?-1:0,a>0?this[0]=a:a< -1?this[0]=a+this.DV:this.t=0},P.prototype.fromString=function(a,b){var c;if(16==b)c=4;else if(8==b)c=3;else if(256==b)c=8;else if(2==b)c=1;else if(32==b)c=5;else{if(4!=b)return void this.fromRadix(a,b);c=2}this.t=0,this.s=0;for(var d=a.length,e=!1,f=0;--d>=0;){var g=8==c?255&a[d]:V(a,d);g<0?"-"==a.charAt(d)&&(e=!0):(e=!1,0==f?this[this.t++]=g:f+c>this.DB?(this[this.t-1]|=(g&(1<<this.DB-f)-1)<<f,this[this.t++]=g>>this.DB-f):this[this.t-1]|=g<<f,(f+=c)>=this.DB&&(f-=this.DB))}8==c&&0!=(128&a[0])&&(this.s=-1,f>0&&(this[this.t-1]|=(1<<this.DB-f)-1<<f)),this.clamp(),e&&P.ZERO.subTo(this,this)},P.prototype.clamp=function(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t},P.prototype.dlShiftTo=function(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s},P.prototype.drShiftTo=function(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s},P.prototype.lShiftTo=function(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()},P.prototype.rShiftTo=function(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)b.t=0;else{var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}},P.prototype.subTo=function(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);c<e;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=d<0?-1:0,d< -1?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()},P.prototype.multiplyTo=function(a,b){var c=this.abs(),d=a.abs(),e=c.t;for(b.t=e+d.t;--e>=0;)b[e]=0;for(e=0;e<d.t;++e)b[e+c.t]=c.am(0,d[e],b,e,0,c.t);b.s=0,b.clamp(),this.s!=a.s&&P.ZERO.subTo(b,b)},P.prototype.squareTo=function(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()},P.prototype.divRemTo=function(a,b,c){var d=a.abs();if(!(d.t<=0)){var e=this.abs();if(e.t<d.t)return null!=b&&b.fromInt(0),void(null!=c&&this.copyTo(c));null==c&&(c=Q());var f=Q(),g=this.s,h=a.s,i=this.DB-X(d[d.t-1]);i>0?(d.lShiftTo(i,f),e.lShiftTo(i,c)):(d.copyTo(f),e.copyTo(c));var j=f.t,k=f[j-1];if(0!=k){var l=k*(1<<this.F1)+(j>1?f[j-2]>>this.F2:0),m=this.FV/l,n=(1<<this.F1)/l,o=1<<this.F2,p=c.t,q=p-j,r=null==b?Q():b;for(f.dlShiftTo(q,r),c.compareTo(r)>=0&&(c[c.t++]=1,c.subTo(r,c)),P.ONE.dlShiftTo(j,r),r.subTo(f,f);f.t<j;)f[f.t++]=0;for(;--q>=0;){var s=c[--p]==k?this.DM:Math.floor(c[p]*m+(c[p-1]+o)*n);if((c[p]+=f.am(0,s,c,q,0,j))<s)for(f.dlShiftTo(q,r),c.subTo(r,c);c[p]< --s;)c.subTo(r,c)}null!=b&&(c.drShiftTo(j,b),g!=h&&P.ZERO.subTo(b,b)),c.t=j,c.clamp(),i>0&&c.rShiftTo(i,c),g<0&&P.ZERO.subTo(c,c)}}},P.prototype.invDigit=function(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return(b=(b=(b=(b=b*(2-(15&a)*b)&15)*(2-(255&a)*b)&255)*(2-((65535&a)*b&65535))&65535)*(2-a*b%this.DV)%this.DV)>0?this.DV-b:-b},P.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},P.prototype.exp=function(a,b){if(a>4294967295||a<1)return P.ONE;var c=Q(),d=Q(),e=b.convert(this),f=X(a)-1;for(e.copyTo(c);--f>=0;)if(b.sqrTo(c,d),(a&1<<f)>0)b.mulTo(d,e,c);else{var g=c;c=d,d=g}return b.revert(c)},P.prototype.toString=function(a){if(this.s<0)return"-"+this.negate().toString(a);if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var b,c,d=(1<<b)-1,e=!1,f="",g=this.t,h=this.DB-g*this.DB%b;if(g-- >0)for(h<this.DB&&(c=this[g]>>h)>0&&(e=!0,f=U(c));g>=0;)h<b?(c=(this[g]&(1<<h)-1)<<b-h,c|=this[--g]>>(h+=this.DB-b)):(c=this[g]>>(h-=b)&d,h<=0&&(h+=this.DB,--g)),c>0&&(e=!0),e&&(f+=U(c));return e?f:"0"},P.prototype.negate=function(){var a=Q();return P.ZERO.subTo(this,a),a},P.prototype.abs=function(){return this.s<0?this.negate():this},P.prototype.compareTo=function(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(0!=(b=c-a.t))return this.s<0?-b:b;for(;--c>=0;)if(0!=(b=this[c]-a[c]))return b;return 0},P.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+X(this[this.t-1]^this.s&this.DM)},P.prototype.mod=function(a){var b=Q();return this.abs().divRemTo(a,null,b),this.s<0&&b.compareTo(P.ZERO)>0&&a.subTo(b,b),b},P.prototype.modPowInt=function(a,b){var c;return c=a<256||b.isEven()?new Y(b):new Z(b),this.exp(a,c)},P.ZERO=W(0),P.ONE=W(1),ae.prototype.convert=af,ae.prototype.revert=af,ae.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c)},ae.prototype.sqrTo=function(a,b){a.squareTo(b)},ag.prototype.convert=function(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(0>a.compareTo(this.m))return a;var b=Q();return a.copyTo(b),this.reduce(b),b},ag.prototype.revert=function(a){return a},ag.prototype.reduce=function(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>a.compareTo(this.r2);)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);a.compareTo(this.m)>=0;)a.subTo(this.m,a)},ag.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c),this.reduce(c)},ag.prototype.sqrTo=function(a,b){a.squareTo(b),this.reduce(b)};var ah=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ai=67108864/ah[ah.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */ function aj(){this.i=0,this.j=0,this.S=[]}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */ function ak(){var a;a=(new Date).getTime(),ay[az++]^=255&a,ay[az++]^=a>>8&255,ay[az++]^=a>>16&255,ay[az++]^=a>>24&255,az>=256&&(az-=256)}if(P.prototype.chunkSize=function(a){return Math.floor(Math.LN2*this.DB/Math.log(a))},P.prototype.toRadix=function(a){if(null==a&&(a=10),0==this.signum()||a<2||a>36)return"0";var b=this.chunkSize(a),c=Math.pow(a,b),d=W(c),e=Q(),f=Q(),g="";for(this.divRemTo(d,e,f);e.signum()>0;)g=(c+f.intValue()).toString(a).substr(1)+g,e.divRemTo(d,e,f);return f.intValue().toString(a)+g},P.prototype.fromRadix=function(a,b){this.fromInt(0),null==b&&(b=10);for(var c=this.chunkSize(b),d=Math.pow(b,c),e=!1,f=0,g=0,h=0;h<a.length;++h){var i=V(a,h);i<0?"-"==a.charAt(h)&&0==this.signum()&&(e=!0):(g=b*g+i,++f>=c&&(this.dMultiply(d),this.dAddOffset(g,0),f=0,g=0))}f>0&&(this.dMultiply(Math.pow(b,f)),this.dAddOffset(g,0)),e&&P.ZERO.subTo(this,this)},P.prototype.fromNumber=function(a,b,c){if("number"==typeof b){if(a<2)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(P.ONE.shiftLeft(a-1),_,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(P.ONE.shiftLeft(a-1),this)}else{var d=[],e=7&a;d.length=1+(a>>3),b.nextBytes(d),e>0?d[0]&=(1<<e)-1:d[0]=0,this.fromString(d,256)}},P.prototype.bitwiseTo=function(a,b,c){var d,e,f=Math.min(a.t,this.t);for(d=0;d<f;++d)c[d]=b(this[d],a[d]);if(a.t<this.t){for(e=a.s&this.DM,d=f;d<this.t;++d)c[d]=b(this[d],e);c.t=this.t}else{for(e=this.s&this.DM,d=f;d<a.t;++d)c[d]=b(e,a[d]);c.t=a.t}c.s=b(this.s,a.s),c.clamp()},P.prototype.changeBit=function(a,b){var c=P.ONE.shiftLeft(a);return this.bitwiseTo(c,b,c),c},P.prototype.addTo=function(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);c<e;)d+=this[c]+a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a[c],b[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=d<0?-1:0,d>0?b[c++]=d:d< -1&&(b[c++]=this.DV+d),b.t=c,b.clamp()},P.prototype.dMultiply=function(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()},P.prototype.dAddOffset=function(a,b){if(0!=a){for(;this.t<=b;)this[this.t++]=0;for(this[b]+=a;this[b]>=this.DV;)this[b]-=this.DV,++b>=this.t&&(this[this.t++]=0),++this[b]}},P.prototype.multiplyLowerTo=function(a,b,c){var d,e=Math.min(this.t+a.t,b);for(c.s=0,c.t=e;e>0;)c[--e]=0;for(d=c.t-this.t;e<d;++e)c[e+this.t]=this.am(0,a[e],c,e,0,this.t);for(d=Math.min(a.t,b);e<d;++e)this.am(0,a[e],c,e,0,b-e);c.clamp()},P.prototype.multiplyUpperTo=function(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;--d>=0;)c[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c[this.t+d-b]=this.am(b-d,a[d],c,0,0,this.t+d-b);c.clamp(),c.drShiftTo(1,c)},P.prototype.modInt=function(a){if(a<=0)return 0;var b=this.DV%a,c=this.s<0?a-1:0;if(this.t>0){if(0==b)c=this[0]%a;else for(var d=this.t-1;d>=0;--d)c=(b*c+this[d])%a}return c},P.prototype.millerRabin=function(a){var b=this.subtract(P.ONE),c=b.getLowestSetBit();if(c<=0)return!1;var d=b.shiftRight(c);(a=a+1>>1)>ah.length&&(a=ah.length);for(var e=Q(),f=0;f<a;++f){e.fromInt(ah[Math.floor(Math.random()*ah.length)]);var g=e.modPow(d,this);if(0!=g.compareTo(P.ONE)&&0!=g.compareTo(b)){for(var h=1;(h++)<c&&0!=g.compareTo(b);)if(0==(g=g.modPowInt(2,this)).compareTo(P.ONE))return!1;if(0!=g.compareTo(b))return!1}}return!0},P.prototype.clone=/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */ function(){var a=Q();return this.copyTo(a),a},P.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return -1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},P.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},P.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},P.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},P.prototype.toByteArray=function(){var a=this.t,b=[];b[0]=this.s;var c,d=this.DB-a*this.DB%8,e=0;if(a-- >0)for(d<this.DB&&(c=this[a]>>d)!=(this.s&this.DM)>>d&&(b[e++]=c|this.s<<this.DB-d);a>=0;)d<8?(c=(this[a]&(1<<d)-1)<<8-d,c|=this[--a]>>(d+=this.DB-8)):(c=this[a]>>(d-=8)&255,d<=0&&(d+=this.DB,--a)),0!=(128&c)&&(c|=-256),0==e&&(128&this.s)!=(128&c)&& ++e,(e>0||c!=this.s)&&(b[e++]=c);return b},P.prototype.equals=function(a){return 0==this.compareTo(a)},P.prototype.min=function(a){return 0>this.compareTo(a)?this:a},P.prototype.max=function(a){return this.compareTo(a)>0?this:a},P.prototype.and=function(a){var b=Q();return this.bitwiseTo(a,$,b),b},P.prototype.or=function(a){var b=Q();return this.bitwiseTo(a,_,b),b},P.prototype.xor=function(a){var b=Q();return this.bitwiseTo(a,aa,b),b},P.prototype.andNot=function(a){var b=Q();return this.bitwiseTo(a,ab,b),b},P.prototype.not=function(){for(var a=Q(),b=0;b<this.t;++b)a[b]=this.DM& ~this[b];return a.t=this.t,a.s=~this.s,a},P.prototype.shiftLeft=function(a){var b=Q();return a<0?this.rShiftTo(-a,b):this.lShiftTo(a,b),b},P.prototype.shiftRight=function(a){var b=Q();return a<0?this.lShiftTo(-a,b):this.rShiftTo(a,b),b},P.prototype.getLowestSetBit=function(){for(var a=0;a<this.t;++a)if(0!=this[a])return a*this.DB+ac(this[a]);return this.s<0?this.t*this.DB:-1},P.prototype.bitCount=function(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c)a+=ad(this[c]^b);return a},P.prototype.testBit=function(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this[b]&1<<a%this.DB)},P.prototype.setBit=function(a){return this.changeBit(a,_)},P.prototype.clearBit=function(a){return this.changeBit(a,ab)},P.prototype.flipBit=function(a){return this.changeBit(a,aa)},P.prototype.add=function(a){var b=Q();return this.addTo(a,b),b},P.prototype.subtract=function(a){var b=Q();return this.subTo(a,b),b},P.prototype.multiply=function(a){var b=Q();return this.multiplyTo(a,b),b},P.prototype.divide=function(a){var b=Q();return this.divRemTo(a,b,null),b},P.prototype.remainder=function(a){var b=Q();return this.divRemTo(a,null,b),b},P.prototype.divideAndRemainder=function(a){var b=Q(),c=Q();return this.divRemTo(a,b,c),[b,c]},P.prototype.modPow=function(a,b){var c,d,e=a.bitLength(),f=W(1);if(e<=0)return f;c=e<18?1:e<48?3:e<144?4:e<768?5:6,d=e<8?new Y(b):b.isEven()?new ag(b):new Z(b);var g=[],h=3,i=c-1,j=(1<<c)-1;if(g[1]=d.convert(this),c>1){var k=Q();for(d.sqrTo(g[1],k);h<=j;)g[h]=Q(),d.mulTo(k,g[h-2],g[h]),h+=2}var l,m,n=a.t-1,o=!0,p=Q();for(e=X(a[n])-1;n>=0;){for(e>=i?l=a[n]>>e-i&j:(l=(a[n]&(1<<e+1)-1)<<i-e,n>0&&(l|=a[n-1]>>this.DB+e-i)),h=c;0==(1&l);)l>>=1,--h;if((e-=h)<0&&(e+=this.DB,--n),o)g[l].copyTo(f),o=!1;else{for(;h>1;)d.sqrTo(f,p),d.sqrTo(p,f),h-=2;h>0?d.sqrTo(f,p):(m=f,f=p,p=m),d.mulTo(p,g[l],f)}for(;n>=0&&0==(a[n]&1<<e);)d.sqrTo(f,p),m=f,f=p,p=m,--e<0&&(e=this.DB-1,--n)}return d.revert(f)},P.prototype.modInverse=function(a){var b=a.isEven();if(this.isEven()&&b||0==a.signum())return P.ZERO;for(var c=a.clone(),d=this.clone(),e=W(1),f=W(0),g=W(0),h=W(1);0!=c.signum();){for(;c.isEven();)c.rShiftTo(1,c),b?(e.isEven()&&f.isEven()||(e.addTo(this,e),f.subTo(a,f)),e.rShiftTo(1,e)):f.isEven()||f.subTo(a,f),f.rShiftTo(1,f);for(;d.isEven();)d.rShiftTo(1,d),b?(g.isEven()&&h.isEven()||(g.addTo(this,g),h.subTo(a,h)),g.rShiftTo(1,g)):h.isEven()||h.subTo(a,h),h.rShiftTo(1,h);c.compareTo(d)>=0?(c.subTo(d,c),b&&e.subTo(g,e),f.subTo(h,f)):(d.subTo(c,d),b&&g.subTo(e,g),h.subTo(f,h))}return 0!=d.compareTo(P.ONE)?P.ZERO:h.compareTo(a)>=0?h.subtract(a):0>h.signum()?(h.addTo(a,h),0>h.signum()?h.add(a):h):h},P.prototype.pow=function(a){return this.exp(a,new ae)},P.prototype.gcd=function(a){var b=this.s<0?this.negate():this.clone(),c=a.s<0?a.negate():a.clone();if(0>b.compareTo(c)){var d=b;b=c,c=d}var e=b.getLowestSetBit(),f=c.getLowestSetBit();if(f<0)return b;for(e<f&&(f=e),f>0&&(b.rShiftTo(f,b),c.rShiftTo(f,c));b.signum()>0;)(e=b.getLowestSetBit())>0&&b.rShiftTo(e,b),(e=c.getLowestSetBit())>0&&c.rShiftTo(e,c),b.compareTo(c)>=0?(b.subTo(c,b),b.rShiftTo(1,b)):(c.subTo(b,c),c.rShiftTo(1,c));return f>0&&c.lShiftTo(f,c),c},P.prototype.isProbablePrime=function(a){var b,c=this.abs();if(1==c.t&&c[0]<=ah[ah.length-1]){for(b=0;b<ah.length;++b)if(c[0]==ah[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<ah.length;){for(var d=ah[b],e=b+1;e<ah.length&&d<ai;)d*=ah[e++];for(d=c.modInt(d);b<e;)if(d%ah[b++]==0)return!1}return c.millerRabin(a)},P.prototype.square=function(){var a=Q();return this.squareTo(a),a},aj.prototype.init=function(a){var b,c,d;for(b=0;b<256;++b)this.S[b]=b;for(c=0,b=0;b<256;++b)c=c+this.S[b]+a[b%a.length]&255,d=this.S[b],this.S[b]=this.S[c],this.S[c]=d;this.i=0,this.j=0},aj.prototype.next=function(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]},null==ay){if(ay=[],az=0,void 0!==I&&(void 0!==I.crypto|| void 0!==I.msCrypto)){var al=I.crypto||I.msCrypto;if(al.getRandomValues){var am=new Uint8Array(32);for(al.getRandomValues(am),aA=0;aA<32;++aA)ay[az++]=am[aA]}else if("Netscape"==H.appName&&H.appVersion<"5"){var an=I.crypto.random(32);for(aA=0;aA<an.length;++aA)ay[az++]=255&an.charCodeAt(aA)}}for(;az<256;)aA=Math.floor(65536*Math.random()),ay[az++]=aA>>>8,ay[az++]=255&aA;az=0,ak()}function ao(){if(null==ax){for(ak(),(ax=new aj).init(ay),az=0;az<ay.length;++az)ay[az]=0;az=0}return ax.next()}function ap(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */ function aq(a,b){return new P(a,b)}function ar(a,b,c){for(var d="",e=0;d.length<b;)d+=c(String.fromCharCode.apply(String,a.concat([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))),e+=1;return d}function as(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */ function at(a,b){this.x=b,this.q=a}function au(a,b,c,d){this.curve=a,this.x=b,this.y=c,this.z=null==d?P.ONE:d,this.zinv=null}function av(a,b,c){this.q=a,this.a=this.fromBigInteger(b),this.b=this.fromBigInteger(c),this.infinity=new au(this,null,null)}ap.prototype.nextBytes=function(a){var b;for(b=0;b<a.length;++b)a[b]=ao()},as.prototype.doPublic=function(a){return a.modPowInt(this.e,this.n)},as.prototype.setPublic=function(a,b){if(this.isPublic=!0,this.isPrivate=!1,"string"!=typeof a)this.n=a,this.e=b;else{if(!(null!=a&&null!=b&&a.length>0&&b.length>0))throw"Invalid RSA public key";this.n=aq(a,16),this.e=parseInt(b,16)}},as.prototype.encrypt=function(a){var b=function(a,b){if(b<a.length+11)throw"Message too long for RSA";for(var c=[],d=a.length-1;d>=0&&b>0;){var e=a.charCodeAt(d--);e<128?c[--b]=e:e>127&&e<2048?(c[--b]=63&e|128,c[--b]=e>>6|192):(c[--b]=63&e|128,c[--b]=e>>6&63|128,c[--b]=e>>12|224)}c[--b]=0;for(var f=new ap,g=[];b>2;){for(g[0]=0;0==g[0];)f.nextBytes(g);c[--b]=g[0]}return c[--b]=2,c[--b]=0,new P(c)}(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPublic(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d},as.prototype.encryptOAEP=function(a,b,c){var d=function(a,b,c,d){var e=aB.crypto.MessageDigest,f=aB.crypto.Util,g=null;if(c||(c="sha1"),"string"==typeof c&&(g=e.getCanonicalAlgName(c),d=e.getHashLength(g),c=function(a){return aP(f.hashHex(aQ(a),g))}),a.length+2*d+2>b)throw"Message too long for RSA";var h,i="";for(h=0;h<b-a.length-2*d-2;h+=1)i+="\0";var j=c("")+i+"\x01"+a,k=Array(d);(new ap).nextBytes(k);var l=ar(k,j.length,c),m=[];for(h=0;h<j.length;h+=1)m[h]=j.charCodeAt(h)^l.charCodeAt(h);var n=ar(m,k.length,c),o=[0];for(h=0;h<k.length;h+=1)o[h+1]=k[h]^n.charCodeAt(h);return new P(o.concat(m))}(a,this.n.bitLength()+7>>3,b,c);if(null==d)return null;var e=this.doPublic(d);if(null==e)return null;var f=e.toString(16);return 0==(1&f.length)?f:"0"+f},as.prototype.type="RSA",at.prototype.equals=function(a){return a==this||this.q.equals(a.q)&&this.x.equals(a.x)},at.prototype.toBigInteger=function(){return this.x},at.prototype.negate=function(){return new at(this.q,this.x.negate().mod(this.q))},at.prototype.add=function(a){return new at(this.q,this.x.add(a.toBigInteger()).mod(this.q))},at.prototype.subtract=function(a){return new at(this.q,this.x.subtract(a.toBigInteger()).mod(this.q))},at.prototype.multiply=function(a){return new at(this.q,this.x.multiply(a.toBigInteger()).mod(this.q))},at.prototype.square=function(){return new at(this.q,this.x.square().mod(this.q))},at.prototype.divide=function(a){return new at(this.q,this.x.multiply(a.toBigInteger().modInverse(this.q)).mod(this.q))},au.prototype.getX=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},au.prototype.getY=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},au.prototype.equals=function(a){return a==this||(this.isInfinity()?a.isInfinity():a.isInfinity()?this.isInfinity():!!a.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(a.z)).mod(this.curve.q).equals(P.ZERO)&&a.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(a.z)).mod(this.curve.q).equals(P.ZERO))},au.prototype.isInfinity=function(){return null==this.x&&null==this.y||this.z.equals(P.ZERO)&&!this.y.toBigInteger().equals(P.ZERO)},au.prototype.negate=function(){return new au(this.curve,this.x,this.y.negate(),this.z)},au.prototype.add=function(a){if(this.isInfinity())return a;if(a.isInfinity())return this;var b=a.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(a.z)).mod(this.curve.q),c=a.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(a.z)).mod(this.curve.q);if(P.ZERO.equals(c))return P.ZERO.equals(b)?this.twice():this.curve.getInfinity();var d=new P("3"),e=this.x.toBigInteger(),f=this.y.toBigInteger(),g=(a.x.toBigInteger(),a.y.toBigInteger(),c.square()),h=g.multiply(c),i=e.multiply(g),j=b.square().multiply(this.z),k=j.subtract(i.shiftLeft(1)).multiply(a.z).subtract(h).multiply(c).mod(this.curve.q),l=i.multiply(d).multiply(b).subtract(f.multiply(h)).subtract(j.multiply(b)).multiply(a.z).add(b.multiply(h)).mod(this.curve.q),m=h.multiply(this.z).multiply(a.z).mod(this.curve.q);return new au(this.curve,this.curve.fromBigInteger(k),this.curve.fromBigInteger(l),m)},au.prototype.twice=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var a=new P("3"),b=this.x.toBigInteger(),c=this.y.toBigInteger(),d=c.multiply(this.z),e=d.multiply(c).mod(this.curve.q),f=this.curve.a.toBigInteger(),g=b.square().multiply(a);P.ZERO.equals(f)||(g=g.add(this.z.square().multiply(f)));var h=(g=g.mod(this.curve.q)).square().subtract(b.shiftLeft(3).multiply(e)).shiftLeft(1).multiply(d).mod(this.curve.q),i=g.multiply(a).multiply(b).subtract(e.shiftLeft(1)).shiftLeft(2).multiply(e).subtract(g.square().multiply(g)).mod(this.curve.q),j=d.square().multiply(d).shiftLeft(3).mod(this.curve.q);return new au(this.curve,this.curve.fromBigInteger(h),this.curve.fromBigInteger(i),j)},au.prototype.multiply=function(a){if(this.isInfinity())return this;if(0==a.signum())return this.curve.getInfinity();var b,c=a,d=c.multiply(new P("3")),e=this.negate(),f=this,g=this.curve.q.subtract(a),h=g.multiply(new P("3")),i=new au(this.curve,this.x,this.y),j=i.negate();for(b=d.bitLength()-2;b>0;--b){f=f.twice();var k=d.testBit(b);k!=c.testBit(b)&&(f=f.add(k?this:e))}for(b=h.bitLength()-2;b>0;--b){i=i.twice();var l=h.testBit(b);l!=g.testBit(b)&&(i=i.add(l?i:j))}return f},au.prototype.multiplyTwo=function(a,b,c){var d;d=a.bitLength()>c.bitLength()?a.bitLength()-1:c.bitLength()-1;for(var e=this.curve.getInfinity(),f=this.add(b);d>=0;)e=e.twice(),a.testBit(d)?e=c.testBit(d)?e.add(f):e.add(this):c.testBit(d)&&(e=e.add(b)),--d;return e},av.prototype.getQ=function(){return this.q},av.prototype.getA=function(){return this.a},av.prototype.getB=function(){return this.b},av.prototype.equals=function(a){return a==this||this.q.equals(a.q)&&this.a.equals(a.a)&&this.b.equals(a.b)},av.prototype.getInfinity=function(){return this.infinity},av.prototype.fromBigInteger=function(a){return new at(this.q,a)},av.prototype.decodePointHex=function(a){switch(parseInt(a.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:default:return null;case 4:case 6:case 7:var b=(a.length-2)/2,c=a.substr(2,b),d=a.substr(b+2,b);return new au(this,this.fromBigInteger(new P(c,16)),this.fromBigInteger(new P(d,16)))}},/*! (c) Stefan Thomas | https://github.com/bitcoinjs/bitcoinjs-lib
 */ at.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},au.prototype.getEncoded=function(a){var b=function(a,b){var c=a.toByteArrayUnsigned();if(b<c.length)c=c.slice(c.length-b);else for(;b>c.length;)c.unshift(0);return c},c=this.getX().toBigInteger(),d=this.getY().toBigInteger(),e=b(c,32);return a?d.isEven()?e.unshift(2):e.unshift(3):(e.unshift(4),e=e.concat(b(d,32))),e},au.decodeFrom=function(a,b){b[0];var c=b.length-1,d=b.slice(1,1+c/2),e=b.slice(1+c/2,1+c);d.unshift(0),e.unshift(0);var f=new P(d),g=new P(e);return new au(a,a.fromBigInteger(f),a.fromBigInteger(g))},au.decodeFromHex=function(a,b){b.substr(0,2);var c=b.length-2,d=b.substr(2,c/2),e=b.substr(2+c/2,c/2),f=new P(d,16),g=new P(e,16);return new au(a,a.fromBigInteger(f),a.fromBigInteger(g))},au.prototype.add2D=function(a){if(this.isInfinity())return a;if(a.isInfinity())return this;if(this.x.equals(a.x))return this.y.equals(a.y)?this.twice():this.curve.getInfinity();var b=a.x.subtract(this.x),c=a.y.subtract(this.y).divide(b),d=c.square().subtract(this.x).subtract(a.x),e=c.multiply(this.x.subtract(d)).subtract(this.y);return new au(this.curve,d,e)},au.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var a=this.curve.fromBigInteger(P.valueOf(2)),b=this.curve.fromBigInteger(P.valueOf(3)),c=this.x.square().multiply(b).add(this.curve.a).divide(this.y.multiply(a)),d=c.square().subtract(this.x.multiply(a)),e=c.multiply(this.x.subtract(d)).subtract(this.y);return new au(this.curve,d,e)},au.prototype.multiply2D=function(a){if(this.isInfinity())return this;if(0==a.signum())return this.curve.getInfinity();var b,c=a,d=c.multiply(new P("3")),e=this.negate(),f=this;for(b=d.bitLength()-2;b>0;--b){f=f.twice();var g=d.testBit(b);g!=c.testBit(b)&&(f=f.add2D(g?this:e))}return f},au.prototype.isOnCurve=function(){var a=this.getX().toBigInteger(),b=this.getY().toBigInteger(),c=this.curve.getA().toBigInteger(),d=this.curve.getB().toBigInteger(),e=this.curve.getQ(),f=b.multiply(b).mod(e),g=a.multiply(a).multiply(a).add(c.multiply(a)).add(d).mod(e);return f.equals(g)},au.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},au.prototype.validate=function(){var a=this.curve.getQ();if(this.isInfinity())throw Error("Point is at infinity.");var b=this.getX().toBigInteger(),c=this.getY().toBigInteger();if(0>b.compareTo(P.ONE)||b.compareTo(a.subtract(P.ONE))>0)throw Error("x coordinate out of bounds");if(0>c.compareTo(P.ONE)||c.compareTo(a.subtract(P.ONE))>0)throw Error("y coordinate out of bounds");if(!this.isOnCurve())throw Error("Point is not on the curve.");if(this.multiply(a).isInfinity())throw Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */ var aw=function(){var a=RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),b=RegExp("\\\\(?:([^u])|u(.{4}))","g"),c={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"};function d(a,b,d){return b?c[b]:String.fromCharCode(parseInt(d,16))}var e=new String(""),f=Object.hasOwnProperty;return function(c,g){var h,i,j,k=c.match(a),l=k[0],m=!1;"{"===l?i={}:"["===l?i=[]:(i=[],m=!0);for(var n=[i],o=1-m,p=k.length;o<p;++o)switch((l=k[o]).charCodeAt(0)){default:(h=n[0])[j||h.length]=+l,j=void 0;break;case 34:if(-1!==(l=l.substring(1,l.length-1)).indexOf("\\")&&(l=l.replace(b,d)),h=n[0],!j){if(!(h instanceof Array)){j=l||e;break}j=h.length}h[j]=l,j=void 0;break;case 91:h=n[0],n.unshift(h[j||h.length]=[]),j=void 0;break;case 93:case 125:n.shift();break;case 102:(h=n[0])[j||h.length]=!1,j=void 0;break;case 110:(h=n[0])[j||h.length]=null,j=void 0;break;case 116:(h=n[0])[j||h.length]=!0,j=void 0;break;case 123:h=n[0],n.unshift(h[j||h.length]={}),j=void 0}if(m){if(1!==n.length)throw Error();i=i[0]}else if(n.length)throw Error();return g&&(i=function a(b,c){var d=b[c];if(d&&"object"===(void 0===d?"undefined":G(d))){var e=null;for(var h in d)if(f.call(d,h)&&d!==b){var i=a(d,h);void 0!==i?d[h]=i:(e||(e=[]),e.push(h))}if(e)for(var j=e.length;--j>=0;)delete d[e[j]]}return g.call(b,c,d)}({"":i},"")),i}}();void 0!==aB&&aB||(b.KJUR=aB={}),void 0!==aB.asn1&&aB.asn1||(aB.asn1={}),aB.asn1.ASN1Util=new function(){this.integerToByteHex=function(a){var b=a.toString(16);return b.length%2==1&&(b="0"+b),b},this.bigIntToMinTwosComplementsHex=function(a){var b=a.toString(16);if("-"!=b.substr(0,1))b.length%2==1?b="0"+b:b.match(/^[0-7]/)||(b="00"+b);else{var c=b.substr(1).length;c%2==1?c+=1:b.match(/^[0-7]/)||(c+=2);for(var d="",e=0;e<c;e++)d+="f";b=new P(d,16).xor(a).add(P.ONE).toString(16).replace(/^-/,"")}return b},this.getPEMStringFromHex=function(a,b){return aU(a,b)},this.newObject=function(a){var b=aB.asn1,c=b.ASN1Object,d=b.DERBoolean,e=b.DERInteger,f=b.DERBitString,g=b.DEROctetString,h=b.DERNull,i=b.DERObjectIdentifier,j=b.DEREnumerated,k=b.DERUTF8String,l=b.DERNumericString,m=b.DERPrintableString,n=b.DERTeletexString,o=b.DERIA5String,p=b.DERUTCTime,q=b.DERGeneralizedTime,r=b.DERVisibleString,s=b.DERBMPString,t=b.DERSequence,u=b.DERSet,v=b.DERTaggedObject,w=b.ASN1Util.newObject;if(a instanceof b.ASN1Object)return a;var x=Object.keys(a);if(1!=x.length)throw Error("key of param shall be only one.");var y=x[0];if(-1==":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+y+":"))throw Error("undefined key: "+y);if("bool"==y)return new d(a[y]);if("int"==y)return new e(a[y]);if("bitstr"==y)return new f(a[y]);if("octstr"==y)return new g(a[y]);if("null"==y)return new h(a[y]);if("oid"==y)return new i(a[y]);if("enum"==y)return new j(a[y]);if("utf8str"==y)return new k(a[y]);if("numstr"==y)return new l(a[y]);if("prnstr"==y)return new m(a[y]);if("telstr"==y)return new n(a[y]);if("ia5str"==y)return new o(a[y]);if("utctime"==y)return new p(a[y]);if("gentime"==y)return new q(a[y]);if("visstr"==y)return new r(a[y]);if("bmpstr"==y)return new s(a[y]);if("asn1"==y)return new c(a[y]);if("seq"==y){for(var z=a[y],A=[],B=0;B<z.length;B++){var C=w(z[B]);A.push(C)}return new t({array:A})}if("set"==y){for(z=a[y],A=[],B=0;B<z.length;B++)C=w(z[B]),A.push(C);return new u({array:A})}if("tag"==y){var D=a[y];if("[object Array]"===Object.prototype.toString.call(D)&&3==D.length){var E=w(D[2]);return new v({tag:D[0],explicit:D[1],obj:E})}return new v(D)}},this.jsonToASN1HEX=function(a){return this.newObject(a).getEncodedHex()}},aB.asn1.ASN1Util.oidHexToInt=function(a){for(var b="",c=parseInt(a.substr(0,2),16),d=(b=Math.floor(c/40)+"."+c%40,""),e=2;e<a.length;e+=2){var f=("00000000"+parseInt(a.substr(e,2),16).toString(2)).slice(-8);d+=f.substr(1,7),"0"==f.substr(0,1)&&(b=b+"."+new P(d,2).toString(10),d="")}return b},aB.asn1.ASN1Util.oidIntToHex=function(a){var b=function(a){var b=a.toString(16);return 1==b.length&&(b="0"+b),b},c=function(a){var c="",d=new P(a,10).toString(2),e=7-d.length%7;7==e&&(e=0);for(var f="",g=0;g<e;g++)f+="0";for(g=0,d=f+d;g<d.length-1;g+=7){var h=d.substr(g,7);g!=d.length-7&&(h="1"+h),c+=b(parseInt(h,2))}return c};if(!a.match(/^[0-9.]+$/))throw"malformed oid string: "+a;var d="",e=a.split("."),f=40*parseInt(e[0])+parseInt(e[1]);d+=b(f),e.splice(0,2);for(var g=0;g<e.length;g++)d+=c(e[g]);return d},aB.asn1.ASN1Object=function(a){this.params=null,this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw Error("this.hV is null or undefined");if(this.hV.length%2==1)throw Error("value hex must be even length: n=0,v="+this.hV);var a=this.hV.length/2,b=a.toString(16);if(b.length%2==1&&(b="0"+b),a<128)return b;var c=b.length/2;if(c>15)throw"ASN.1 length too long to represent by 8x: n = "+a.toString(16);return(128+c).toString(16)+b},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(a){this.params=a},null!=a&&null!=a.tlv&&(this.hTLV=a.tlv,this.isModified=!1)},aB.asn1.DERAbstractString=function(a){aB.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(a){this.hTLV=null,this.isModified=!0,this.s=a,this.hV=aN(this.s).toLowerCase()},this.setStringHex=function(a){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=a},this.getFreshValueHex=function(){return this.hV},void 0!==a&&("string"==typeof a?this.setString(a):void 0!==a.str?this.setString(a.str):void 0!==a.hex&&this.setStringHex(a.hex))},a6(aB.asn1.DERAbstractString,aB.asn1.ASN1Object),aB.asn1.DERAbstractTime=function(a){aB.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(a){var b=a.getTime()+6e4*a.getTimezoneOffset();return new Date(b)},this.formatDate=function(a,b,c){var d=this.zeroPadding,e=this.localDateToUTC(a),f=String(e.getFullYear());"utc"==b&&(f=f.substr(2,2));var g=f+d(String(e.getMonth()+1),2)+d(String(e.getDate()),2)+d(String(e.getHours()),2)+d(String(e.getMinutes()),2)+d(String(e.getSeconds()),2);if(!0===c){var h=e.getMilliseconds();if(0!=h){var i=d(String(h),3);g=g+"."+(i=i.replace(/[0]+$/,""))}}return g+"Z"},this.zeroPadding=function(a,b){return a.length>=b?a:Array(b-a.length+1).join("0")+a},this.getString=function(){return this.s},this.setString=function(a){this.hTLV=null,this.isModified=!0,this.s=a,this.hV=aI(a)},this.setByDateValue=function(a,b,c,d,e,f){var g=new Date(Date.UTC(a,b-1,c,d,e,f,0));this.setByDate(g)},this.getFreshValueHex=function(){return this.hV}},a6(aB.asn1.DERAbstractTime,aB.asn1.ASN1Object),aB.asn1.DERAbstractStructured=function(a){aB.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(a){this.hTLV=null,this.isModified=!0,this.asn1Array=a},this.appendASN1Object=function(a){this.hTLV=null,this.isModified=!0,this.asn1Array.push(a)},this.asn1Array=[],void 0!==a&& void 0!==a.array&&(this.asn1Array=a.array)},a6(aB.asn1.DERAbstractStructured,aB.asn1.ASN1Object),aB.asn1.DERBoolean=function(a){aB.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=0==a?"010100":"0101ff"},a6(aB.asn1.DERBoolean,aB.asn1.ASN1Object),aB.asn1.DERInteger=function(a){aB.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(a){this.hTLV=null,this.isModified=!0,this.hV=aB.asn1.ASN1Util.bigIntToMinTwosComplementsHex(a)},this.setByInteger=function(a){var b=new P(String(a),10);this.setByBigInteger(b)},this.setValueHex=function(a){this.hV=a},this.getFreshValueHex=function(){return this.hV},void 0!==a&&(void 0!==a.bigint?this.setByBigInteger(a.bigint):void 0!==a.int?this.setByInteger(a.int):"number"==typeof a?this.setByInteger(a):void 0!==a.hex&&this.setValueHex(a.hex))},a6(aB.asn1.DERInteger,aB.asn1.ASN1Object),aB.asn1.DERBitString=function(a){if(void 0!==a&& void 0!==a.obj){var b=aB.asn1.ASN1Util.newObject(a.obj);a.hex="00"+b.getEncodedHex()}aB.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(a){this.hTLV=null,this.isModified=!0,this.hV=a},this.setUnusedBitsAndHexValue=function(a,b){if(a<0||7<a)throw"unused bits shall be from 0 to 7: u = "+a;this.hTLV=null,this.isModified=!0,this.hV="0"+a+b},this.setByBinaryString=function(a){var b=8-(a=a.replace(/0+$/,"")).length%8;8==b&&(b=0);for(var c=0;c<=b;c++)a+="0";var d="";for(c=0;c<a.length-1;c+=8){var e=a.substr(c,8),f=parseInt(e,2).toString(16);1==f.length&&(f="0"+f),d+=f}this.hTLV=null,this.isModified=!0,this.hV="0"+b+d},this.setByBooleanArray=function(a){for(var b="",c=0;c<a.length;c++)1==a[c]?b+="1":b+="0";this.setByBinaryString(b)},this.newFalseArray=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=!1;return b},this.getFreshValueHex=function(){return this.hV},void 0!==a&&("string"==typeof a&&a.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(a):void 0!==a.hex?this.setHexValueIncludingUnusedBits(a.hex):void 0!==a.bin?this.setByBinaryString(a.bin):void 0!==a.array&&this.setByBooleanArray(a.array))},a6(aB.asn1.DERBitString,aB.asn1.ASN1Object),aB.asn1.DEROctetString=function(a){if(void 0!==a&& void 0!==a.obj){var b=aB.asn1.ASN1Util.newObject(a.obj);a.hex=b.getEncodedHex()}aB.asn1.DEROctetString.superclass.constructor.call(this,a),this.hT="04"},a6(aB.asn1.DEROctetString,aB.asn1.DERAbstractString),aB.asn1.DERNull=function(){aB.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},a6(aB.asn1.DERNull,aB.asn1.ASN1Object),aB.asn1.DERObjectIdentifier=function(a){aB.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(a){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=a},this.setValueOidString=function(a){var b=function(a){var b=function(a){var b=a.toString(16);return 1==b.length&&(b="0"+b),b},c=function(a){var c="",d=parseInt(a,10).toString(2),e=7-d.length%7;7==e&&(e=0);for(var f="",g=0;g<e;g++)f+="0";for(g=0,d=f+d;g<d.length-1;g+=7){var h=d.substr(g,7);g!=d.length-7&&(h="1"+h),c+=b(parseInt(h,2))}return c};try{if(!a.match(/^[0-9.]+$/))return null;var d="",e=a.split("."),f=40*parseInt(e[0],10)+parseInt(e[1],10);d+=b(f),e.splice(0,2);for(var g=0;g<e.length;g++)d+=c(e[g]);return d}catch(h){return null}}(a);if(null==b)throw Error("malformed oid string: "+a);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=b},this.setValueName=function(a){var b=aB.asn1.x509.OID.name2oid(a);if(""===b)throw Error("DERObjectIdentifier oidName undefined: "+a);this.setValueOidString(b)},this.setValueNameOrOid=function(a){a.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(a):this.setValueName(a)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(a){"string"==typeof a?this.setValueNameOrOid(a):void 0!==a.oid?this.setValueNameOrOid(a.oid):void 0!==a.name?this.setValueNameOrOid(a.name):void 0!==a.hex&&this.setValueHex(a.hex)},void 0!==a&&this.setByParam(a)},a6(aB.asn1.DERObjectIdentifier,aB.asn1.ASN1Object),aB.asn1.DEREnumerated=function(a){aB.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(a){this.hTLV=null,this.isModified=!0,this.hV=aB.asn1.ASN1Util.bigIntToMinTwosComplementsHex(a)},this.setByInteger=function(a){var b=new P(String(a),10);this.setByBigInteger(b)},this.setValueHex=function(a){this.hV=a},this.getFreshValueHex=function(){return this.hV},void 0!==a&&(void 0!==a.int?this.setByInteger(a.int):"number"==typeof a?this.setByInteger(a):void 0!==a.hex&&this.setValueHex(a.hex))},a6(aB.asn1.DEREnumerated,aB.asn1.ASN1Object),aB.asn1.DERUTF8String=function(a){aB.asn1.DERUTF8String.superclass.constructor.call(this,a),this.hT="0c"},a6(aB.asn1.DERUTF8String,aB.asn1.DERAbstractString),aB.asn1.DERNumericString=function(a){aB.asn1.DERNumericString.superclass.constructor.call(this,a),this.hT="12"},a6(aB.asn1.DERNumericString,aB.asn1.DERAbstractString),aB.asn1.DERPrintableString=function(a){aB.asn1.DERPrintableString.superclass.constructor.call(this,a),this.hT="13"},a6(aB.asn1.DERPrintableString,aB.asn1.DERAbstractString),aB.asn1.DERTeletexString=function(a){aB.asn1.DERTeletexString.superclass.constructor.call(this,a),this.hT="14"},a6(aB.asn1.DERTeletexString,aB.asn1.DERAbstractString),aB.asn1.DERIA5String=function(a){aB.asn1.DERIA5String.superclass.constructor.call(this,a),this.hT="16"},a6(aB.asn1.DERIA5String,aB.asn1.DERAbstractString),aB.asn1.DERVisibleString=function(a){aB.asn1.DERIA5String.superclass.constructor.call(this,a),this.hT="1a"},a6(aB.asn1.DERVisibleString,aB.asn1.DERAbstractString),aB.asn1.DERBMPString=function(a){aB.asn1.DERBMPString.superclass.constructor.call(this,a),this.hT="1e"},a6(aB.asn1.DERBMPString,aB.asn1.DERAbstractString),aB.asn1.DERUTCTime=function(a){aB.asn1.DERUTCTime.superclass.constructor.call(this,a),this.hT="17",this.setByDate=function(a){this.hTLV=null,this.isModified=!0,this.date=a,this.s=this.formatDate(this.date,"utc"),this.hV=aI(this.s)},this.getFreshValueHex=function(){return void 0===this.date&& void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=aI(this.s)),this.hV},void 0!==a&&(void 0!==a.str?this.setString(a.str):"string"==typeof a&&a.match(/^[0-9]{12}Z$/)?this.setString(a):void 0!==a.hex?this.setStringHex(a.hex):void 0!==a.date&&this.setByDate(a.date))},a6(aB.asn1.DERUTCTime,aB.asn1.DERAbstractTime),aB.asn1.DERGeneralizedTime=function(a){aB.asn1.DERGeneralizedTime.superclass.constructor.call(this,a),this.hT="18",this.withMillis=!1,this.setByDate=function(a){this.hTLV=null,this.isModified=!0,this.date=a,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=aI(this.s)},this.getFreshValueHex=function(){return void 0===this.date&& void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=aI(this.s)),this.hV},void 0!==a&&(void 0!==a.str?this.setString(a.str):"string"==typeof a&&a.match(/^[0-9]{14}Z$/)?this.setString(a):void 0!==a.hex?this.setStringHex(a.hex):void 0!==a.date&&this.setByDate(a.date),!0===a.millis&&(this.withMillis=!0))},a6(aB.asn1.DERGeneralizedTime,aB.asn1.DERAbstractTime),aB.asn1.DERSequence=function(a){aB.asn1.DERSequence.superclass.constructor.call(this,a),this.hT="30",this.getFreshValueHex=function(){for(var a="",b=0;b<this.asn1Array.length;b++)a+=this.asn1Array[b].getEncodedHex();return this.hV=a,this.hV}},a6(aB.asn1.DERSequence,aB.asn1.DERAbstractStructured),aB.asn1.DERSet=function(a){aB.asn1.DERSet.superclass.constructor.call(this,a),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var a=[],b=0;b<this.asn1Array.length;b++){var c=this.asn1Array[b];a.push(c.getEncodedHex())}return 1==this.sortFlag&&a.sort(),this.hV=a.join(""),this.hV},void 0!==a&& void 0!==a.sortflag&&0==a.sortflag&&(this.sortFlag=!1)},a6(aB.asn1.DERSet,aB.asn1.DERAbstractStructured),aB.asn1.DERTaggedObject=function(a){aB.asn1.DERTaggedObject.superclass.constructor.call(this);var b=aB.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(a,b,c){this.hT=b,this.isExplicit=a,this.asn1Object=c,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=c.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,b),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(a){null!=a.tag&&(this.hT=a.tag),null!=a.explicit&&(this.isExplicit=a.explicit),null!=a.tage&&(this.hT=a.tage,this.isExplicit=!0),null!=a.tagi&&(this.hT=a.tagi,this.isExplicit=!1),null!=a.obj&&(a.obj instanceof b.ASN1Object?(this.asn1Object=a.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):"object"==G(a.obj)&&(this.asn1Object=b.ASN1Util.newObject(a.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},null!=a&&this.setByParam(a)},a6(aB.asn1.DERTaggedObject,aB.asn1.ASN1Object);var ax,ay,az,aA,aB,aC,aD,aE=new function(){};function aF(a){for(var b=[],c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}function aG(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b}function aH(a){for(var b="",c=0;c<a.length;c++){var d=a[c].toString(16);1==d.length&&(d="0"+d),b+=d}return b}function aI(a){return aH(aF(a))}function aJ(a){return a=(a=(a=a.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function aK(a){return a.length%4==2?a+="==":a.length%4==3&&(a+="="),a=(a=a.replace(/-/g,"+")).replace(/_/g,"/")}function aL(a){return a.length%2==1&&(a="0"+a),aJ(M(a))}function aM(a){return N(aK(a))}function aN(a){return aY(a2(a))}function aO(a){return decodeURIComponent(aZ(a))}function aP(a){for(var b="",c=0;c<a.length-1;c+=2)b+=String.fromCharCode(parseInt(a.substr(c,2),16));return b}function aQ(a){for(var b="",c=0;c<a.length;c++)b+=("0"+a.charCodeAt(c).toString(16)).slice(-2);return b}function aR(a){return M(a)}function aS(a){var b,c;return M(b=a).replace(/(.{64})/g,"$1\r\n").replace(/\r\n$/,"")}function aT(a){return N(a.replace(/[^0-9A-Za-z\/+=]*/g,""))}function aU(a,b){return"-----BEGIN "+b+"-----\r\n"+aS(a)+"\r\n-----END "+b+"-----\r\n"}function aV(a,b){if(-1==a.indexOf("-----BEGIN "))throw"can't find PEM header: "+b;return aT(a=void 0!==b?(a=a.replace(RegExp("^[^]*-----BEGIN "+b+"-----"),"")).replace(RegExp("-----END "+b+"-----[^]*$"),""):(a=a.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function aW(a){var b,c,d,e,f,g,h,i,j,k,l;if(l=a.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return b=parseInt(i=l[1]),2===i.length&&(50<=b&&b<100?b=1900+b:0<=b&&b<50&&(b=2e3+b)),c=parseInt(l[2])-1,d=parseInt(l[3]),e=parseInt(l[4]),f=parseInt(l[5]),g=parseInt(l[6]),h=0,""!==(j=l[7])&&(h=parseInt((j.substr(1)+"00").substr(0,3))),Date.UTC(b,c,d,e,f,g,h);throw"unsupported zulu format: "+a}function aX(a){return~~(aW(a)/1e3)}function aY(a){return a.replace(/%/g,"")}function aZ(a){return a.replace(/(..)/g,"%$1")}function a$(a){var b="malformed IPv6 address";if(!a.match(/^[0-9A-Fa-f:]+$/))throw b;var c=(a=a.toLowerCase()).split(":").length-1;if(c<2)throw b;var d=":".repeat(7-c+2),e=(a=a.replace("::",d)).split(":");if(8!=e.length)throw b;for(var f=0;f<8;f++)e[f]=("0000"+e[f]).slice(-4);return e.join("")}function a_(a){if(!a.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var b=(a=a.toLowerCase()).match(/.{1,4}/g),c=0;c<8;c++)b[c]=b[c].replace(/^0+/,""),""==b[c]&&(b[c]="0");var d=(a=":"+b.join(":")+":").match(/:(0:){2,}/g);if(null===d)return a.slice(1,-1);var e="";for(c=0;c<d.length;c++)d[c].length>e.length&&(e=d[c]);return(a=a.replace(e,"::")).slice(1,-1)}function a0(a){var b="malformed hex value";if(!a.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw b;if(8!=a.length)return 32==a.length?a_(a):a;try{return parseInt(a.substr(0,2),16)+"."+parseInt(a.substr(2,2),16)+"."+parseInt(a.substr(4,2),16)+"."+parseInt(a.substr(6,2),16)}catch(c){throw b}}function a1(a){return a.match(/.{4}/g).map(function(a){var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2),16);if(0==b&c<128)return String.fromCharCode(c);if(b<8){var d=128|63&c;return aO((192|(7&b)<<3|(192&c)>>6).toString(16)+d.toString(16))}d=128|(15&b)<<2|(192&c)>>6;var e=128|63&c;return aO((224|(240&b)>>4).toString(16)+d.toString(16)+e.toString(16))}).join("")}function a2(a){for(var b=encodeURIComponent(a),c="",d=0;d<b.length;d++)"%"==b[d]?(c+=b.substr(d,3),d+=2):c=c+"%"+aI(b[d]);return c}function a3(a){return!(a.length%2!=0|| !a.match(/^[0-9a-f]+$/)&&!a.match(/^[0-9A-F]+$/))}function a4(a){return a.length%2==1?"0"+a:a.substr(0,1)>"7"?"00"+a:a}aE.getLblen=function(a,b){if("8"!=a.substr(b+2,1))return 1;var c=parseInt(a.substr(b+3,1));return 0==c?-1:0<c&&c<10?c+1:-2},aE.getL=function(a,b){var c=aE.getLblen(a,b);return c<1?"":a.substr(b+2,2*c)},aE.getVblen=function(a,b){var c;return""==(c=aE.getL(a,b))?-1:("8"===c.substr(0,1)?new P(c.substr(2),16):new P(c,16)).intValue()},aE.getVidx=function(a,b){var c=aE.getLblen(a,b);return c<0?c:b+2*(c+1)},aE.getV=function(a,b){var c=aE.getVidx(a,b),d=aE.getVblen(a,b);return a.substr(c,2*d)},aE.getTLV=function(a,b){return a.substr(b,2)+aE.getL(a,b)+aE.getV(a,b)},aE.getTLVblen=function(a,b){return 2+2*aE.getLblen(a,b)+2*aE.getVblen(a,b)},aE.getNextSiblingIdx=function(a,b){return aE.getVidx(a,b)+2*aE.getVblen(a,b)},aE.getChildIdx=function(a,b){var c,d,e,f=aE,g=[];c=f.getVidx(a,b),d=2*f.getVblen(a,b),"03"==a.substr(b,2)&&(c+=2,d-=2),e=0;for(var h=c;e<=d;){var i=f.getTLVblen(a,h);if((e+=i)<=d&&g.push(h),h+=i,e>=d)break}return g},aE.getNthChildIdx=function(a,b,c){return aE.getChildIdx(a,b)[c]},aE.getIdxbyList=function(a,b,c,d){var e,f,g=aE;return 0==c.length?void 0!==d&&a.substr(b,2)!==d?-1:b:(e=c.shift())>=(f=g.getChildIdx(a,b)).length?-1:g.getIdxbyList(a,f[e],c,d)},aE.getIdxbyListEx=function(a,b,c,d){var e,f,g=aE;if(0==c.length)return void 0!==d&&a.substr(b,2)!==d?-1:b;e=c.shift(),f=g.getChildIdx(a,b);for(var h=0,i=0;i<f.length;i++){var j=a.substr(f[i],2);if("number"==typeof e&&!g.isContextTag(j)&&h==e||"string"==typeof e&&g.isContextTag(j,e))return g.getIdxbyListEx(a,f[i],c,d);g.isContextTag(j)||h++}return -1},aE.getTLVbyList=function(a,b,c,d){var e=aE,f=e.getIdxbyList(a,b,c,d);return -1==f||f>=a.length?null:e.getTLV(a,f)},aE.getTLVbyListEx=function(a,b,c,d){var e=aE,f=e.getIdxbyListEx(a,b,c,d);return -1==f?null:e.getTLV(a,f)},aE.getVbyList=function(a,b,c,d,e){var f,g,h=aE;return -1==(f=h.getIdxbyList(a,b,c,d))||f>=a.length?null:(g=h.getV(a,f),!0===e&&(g=g.substr(2)),g)},aE.getVbyListEx=function(a,b,c,d,e){var f,g,h=aE;return -1==(f=h.getIdxbyListEx(a,b,c,d))?null:(g=h.getV(a,f),"03"==a.substr(f,2)&& !1!==e&&(g=g.substr(2)),g)},aE.getInt=function(a,b,c){null==c&&(c=-1);try{var d=a.substr(b,2);if("02"!=d&&"03"!=d)return c;var e=aE.getV(a,b);return"02"==d?parseInt(e,16):function(a){try{var b=a.substr(0,2);if("00"==b)return parseInt(a.substr(2),16);var c=parseInt(b,16),d=a.substr(2),e=parseInt(d,16).toString(2);return"0"==e&&(e="00000000"),e=e.slice(0,0-c),parseInt(e,2)}catch(f){return -1}}(e)}catch(f){return c}},aE.getOID=function(a,b,c){null==c&&(c=null);try{return"06"!=a.substr(b,2)?c:function(a){if(!a3(a))return null;try{var b=[],c=a.substr(0,2),d=parseInt(c,16);b[0]=new String(Math.floor(d/40)),b[1]=new String(d%40);for(var e=a.substr(2),f=[],g=0;g<e.length/2;g++)f.push(parseInt(e.substr(2*g,2),16));var h=[],i="";for(g=0;g<f.length;g++)128&f[g]?i+=a5((127&f[g]).toString(2),7):(i+=a5((127&f[g]).toString(2),7),h.push(new String(parseInt(i,2))),i="");var j=b.join(".");return h.length>0&&(j=j+"."+h.join(".")),j}catch(k){return null}}(aE.getV(a,b))}catch(d){return c}},aE.getOIDName=function(a,b,c){null==c&&(c=null);try{var d=aE.getOID(a,b,c);if(d==c)return c;var e=aB.asn1.x509.OID.oid2name(d);return""==e?d:e}catch(f){return c}},aE.getString=function(a,b,c){null==c&&(c=null);try{return aP(aE.getV(a,b))}catch(d){return c}},aE.hextooidstr=function(a){var b=function(a,b){return a.length>=b?a:Array(b-a.length+1).join("0")+a},c=[],d=parseInt(a.substr(0,2),16);c[0]=new String(Math.floor(d/40)),c[1]=new String(d%40);for(var e=a.substr(2),f=[],g=0;g<e.length/2;g++)f.push(parseInt(e.substr(2*g,2),16));var h=[],i="";for(g=0;g<f.length;g++)128&f[g]?i+=b((127&f[g]).toString(2),7):(i+=b((127&f[g]).toString(2),7),h.push(new String(parseInt(i,2))),i="");var j=c.join(".");return h.length>0&&(j=j+"."+h.join(".")),j},aE.dump=function(a,b,c,d){var e=aE,f=e.getV,g=e.dump,h=e.getChildIdx,i=a;a instanceof aB.asn1.ASN1Object&&(i=a.getEncodedHex());var j=function(a,b){return a.length<=2*b?a:a.substr(0,b)+"..(total "+a.length/2+"bytes).."+a.substr(a.length-b,b)};void 0===b&&(b={ommit_long_octet:32}),void 0===c&&(c=0),void 0===d&&(d="");var k,l=b.ommit_long_octet;if("01"==(k=i.substr(c,2)))return"00"==(m=f(i,c))?d+"BOOLEAN FALSE\n":d+"BOOLEAN TRUE\n";if("02"==k)return d+"INTEGER "+j(m=f(i,c),l)+"\n";if("03"==k){var m=f(i,c);if(e.isASN1HEX(m.substr(2))){var n=d+"BITSTRING, encapsulates\n";return n+g(m.substr(2),b,0,d+"  ")}return d+"BITSTRING "+j(m,l)+"\n"}if("04"==k)return(m=f(i,c),e.isASN1HEX(m))?(n=d+"OCTETSTRING, encapsulates\n")+g(m,b,0,d+"  "):d+"OCTETSTRING "+j(m,l)+"\n";if("05"==k)return d+"NULL\n";if("06"==k){var o=f(i,c),p=aB.asn1.ASN1Util.oidHexToInt(o),q=aB.asn1.x509.OID.oid2name(p),r=p.replace(/\./g," ");return""!=q?d+"ObjectIdentifier "+q+" ("+r+")\n":d+"ObjectIdentifier ("+r+")\n"}if("0a"==k)return d+"ENUMERATED "+parseInt(f(i,c))+"\n";if("0c"==k)return d+"UTF8String '"+aO(f(i,c))+"'\n";if("13"==k)return d+"PrintableString '"+aO(f(i,c))+"'\n";if("14"==k)return d+"TeletexString '"+aO(f(i,c))+"'\n";if("16"==k)return d+"IA5String '"+aO(f(i,c))+"'\n";if("17"==k)return d+"UTCTime "+aO(f(i,c))+"\n";if("18"==k)return d+"GeneralizedTime "+aO(f(i,c))+"\n";if("1a"==k)return d+"VisualString '"+aO(f(i,c))+"'\n";if("1e"==k)return d+"BMPString '"+a1(f(i,c))+"'\n";if("30"==k){if("3000"==i.substr(c,4))return d+"SEQUENCE {}\n";n=d+"SEQUENCE\n";var s=b;if((2==(v=h(i,c)).length||3==v.length)&&"06"==i.substr(v[0],2)&&"04"==i.substr(v[v.length-1],2)){q=e.oidname(f(i,v[0]));var t=JSON.parse(JSON.stringify(b));t.x509ExtName=q,s=t}for(var u=0;u<v.length;u++)n+=g(i,s,v[u],d+"  ");return n}if("31"==k){n=d+"SET\n";var v=h(i,c);for(u=0;u<v.length;u++)n+=g(i,b,v[u],d+"  ");return n}if(0!=(128&(k=parseInt(k,16)))){var w=31&k;if(0!=(32&k)){for(n=d+"["+w+"]\n",v=h(i,c),u=0;u<v.length;u++)n+=g(i,b,v[u],d+"  ");return n}if(m=f(i,c),aE.isASN1HEX(m)){var n=d+"["+w+"]\n";return n+g(m,b,0,d+"  ")}return("68747470"==m.substr(0,8)||"subjectAltName"===b.x509ExtName&&2==w)&&(m=aO(m)),n=d+"["+w+"] "+m+"\n"}return d+"UNKNOWN("+k+") "+f(i,c)+"\n"},aE.isContextTag=function(a,b){var c,d;a=a.toLowerCase();try{c=parseInt(a,16)}catch(e){return -1}if(void 0===b)return 128==(192&c);try{return null!=b.match(/^\[[0-9]+\]$/)&&!((d=parseInt(b.substr(1,b.length-1),10))>31)&&128==(192&c)&&(31&c)==d}catch(f){return!1}},aE.isASN1HEX=function(a){var b=aE;if(a.length%2==1)return!1;var c=b.getVblen(a,0),d=a.substr(0,2),e=b.getL(a,0);return a.length-d.length-e.length==2*c},aE.checkStrictDER=function(a,b,c,d,e){var f=aE;if(void 0===c){if("string"!=typeof a||(a=a.toLowerCase(),!aB.lang.String.isHex(a)))throw Error("not hex string");c=a.length,e=(d=a.length/2)<128?1:Math.ceil(d.toString(16))+1}if(f.getL(a,b).length>2*e)throw Error("L of TLV too long: idx="+b);var g=f.getVblen(a,b);if(g>d)throw Error("value of L too long than hex: idx="+b);var h=f.getTLV(a,b),i=h.length-2-f.getL(a,b).length;if(i!==2*g)throw Error("V string length and L's value not the same:"+i+"/"+2*g);if(0===b&&a.length!=h.length)throw Error("total length and TLV length unmatch:"+a.length+"!="+h.length);var j=a.substr(b,2);if("02"===j){var k=f.getVidx(a,b);if("00"==a.substr(k,2)&&56>a.charCodeAt(k+2))throw Error("not least zeros for DER INTEGER")}if(32&parseInt(j,16)){for(var l=f.getVblen(a,b),m=0,n=f.getChildIdx(a,b),o=0;o<n.length;o++)m+=f.getTLV(a,n[o]).length,f.checkStrictDER(a,n[o],c,d,e);if(2*l!=m)throw Error("sum of children's TLV length and L unmatch: "+2*l+"!="+m)}},aE.oidname=function(a){var b=aB.asn1;aB.lang.String.isHex(a)&&(a=b.ASN1Util.oidHexToInt(a));var c=b.x509.OID.oid2name(a);return""===c&&(c=a),c},void 0!==aB&&aB||(b.KJUR=aB={}),void 0!==aB.lang&&aB.lang||(aB.lang={}),aB.lang.String=function(){},"function"==typeof a?(b.utf8tob64u=aC=function(b){return aJ(a.from(b,"utf8").toString("base64"))},b.b64utoutf8=aD=function(b){return a.from(aK(b),"base64").toString("utf8")}):(b.utf8tob64u=aC=function(a){return aL(aY(a2(a)))},b.b64utoutf8=aD=function(a){return decodeURIComponent(aZ(aM(a)))}),aB.lang.String.isInteger=function(a){return!!a.match(/^[0-9]+$/)||!!a.match(/^-[0-9]+$/)},aB.lang.String.isHex=function(a){return a3(a)},aB.lang.String.isBase64=function(a){return!(!(a=a.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||a.length%4!=0)},aB.lang.String.isBase64URL=function(a){return!a.match(/[+/=]/)&&(a=aK(a),aB.lang.String.isBase64(a))},aB.lang.String.isIntegerArray=function(a){return!!(a=a.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},aB.lang.String.isPrintable=function(a){return null!==a.match(/^[0-9A-Za-z '()+,-./:=?]*$/)},aB.lang.String.isIA5=function(a){return null!==a.match(/^[\x20-\x21\x23-\x7f]*$/)},aB.lang.String.isMail=function(a){return null!==a.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)};var a5=function(a,b,c){return null==c&&(c="0"),a.length>=b?a:Array(b-a.length+1).join(c)+a};function a6(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}void 0!==aB&&aB||(b.KJUR=aB={}),void 0!==aB.crypto&&aB.crypto||(aB.crypto={}),aB.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:J.algo.MD5,sha1:J.algo.SHA1,sha224:J.algo.SHA224,sha256:J.algo.SHA256,sha384:J.algo.SHA384,sha512:J.algo.SHA512,ripemd160:J.algo.RIPEMD160},this.getDigestInfoHex=function(a,b){if(void 0===this.DIGESTINFOHEAD[b])throw"alg not supported in Util.DIGESTINFOHEAD: "+b;return this.DIGESTINFOHEAD[b]+a},this.getPaddedDigestInfoHex=function(a,b,c){var d=this.getDigestInfoHex(a,b),e=c/4;if(d.length+22>e)throw"key is too short for SigAlg: keylen="+c+","+b;for(var f="0001",g="00"+d,h="",i=e-f.length-g.length,j=0;j<i;j+=2)h+="ff";return f+h+g},this.hashString=function(a,b){return new aB.crypto.MessageDigest({alg:b}).digestString(a)},this.hashHex=function(a,b){return new aB.crypto.MessageDigest({alg:b}).digestHex(a)},this.sha1=function(a){return this.hashString(a,"sha1")},this.sha256=function(a){return this.hashString(a,"sha256")},this.sha256Hex=function(a){return this.hashHex(a,"sha256")},this.sha512=function(a){return this.hashString(a,"sha512")},this.sha512Hex=function(a){return this.hashHex(a,"sha512")},this.isKey=function(a){return a instanceof as||a instanceof aB.crypto.DSA||a instanceof aB.crypto.ECDSA}},aB.crypto.Util.md5=function(a){return new aB.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(a)},aB.crypto.Util.ripemd160=function(a){return new aB.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(a)},aB.crypto.Util.SECURERANDOMGEN=new ap,aB.crypto.Util.getRandomHexOfNbytes=function(a){var b=Array(a);return aB.crypto.Util.SECURERANDOMGEN.nextBytes(b),aH(b)},aB.crypto.Util.getRandomBigIntegerOfNbytes=function(a){return new P(aB.crypto.Util.getRandomHexOfNbytes(a),16)},aB.crypto.Util.getRandomHexOfNbits=function(a){var b=a%8,c=Array((a-b)/8+1);return aB.crypto.Util.SECURERANDOMGEN.nextBytes(c),c[0]=(255<<b&255^255)&c[0],aH(c)},aB.crypto.Util.getRandomBigIntegerOfNbits=function(a){return new P(aB.crypto.Util.getRandomHexOfNbits(a),16)},aB.crypto.Util.getRandomBigIntegerZeroToMax=function(a){for(var b=a.bitLength();;){var c=aB.crypto.Util.getRandomBigIntegerOfNbits(b);if(-1!=a.compareTo(c))return c}},aB.crypto.Util.getRandomBigIntegerMinToMax=function(a,b){var c=a.compareTo(b);if(1==c)throw"biMin is greater than biMax";if(0==c)return a;var d=b.subtract(a);return aB.crypto.Util.getRandomBigIntegerZeroToMax(d).add(a)},aB.crypto.MessageDigest=function(a){this.setAlgAndProvider=function(a,b){if(null!==(a=aB.crypto.MessageDigest.getCanonicalAlgName(a))&& void 0===b&&(b=aB.crypto.Util.DEFAULTPROVIDER[a]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(a)&&"cryptojs"==b){try{this.md=aB.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[a].create()}catch(c){throw"setAlgAndProvider hash alg set fail alg="+a+"/"+c}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var b=J.enc.Hex.parse(a);this.md.update(b)},this.digest=function(){return this.md.finalize().toString(J.enc.Hex)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}if(-1!=":sha256:".indexOf(a)&&"sjcl"==b){try{this.md=new sjcl.hash.sha256}catch(d){throw"setAlgAndProvider hash alg set fail alg="+a+"/"+d}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var b=sjcl.codec.hex.toBits(a);this.md.update(b)},this.digest=function(){var a=this.md.finalize();return sjcl.codec.hex.fromBits(a)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}},this.updateString=function(a){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(a){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(a){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==a&& void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov&&(this.provName=aB.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},aB.crypto.MessageDigest.getCanonicalAlgName=function(a){return"string"==typeof a&&(a=(a=a.toLowerCase()).replace(/-/,"")),a},aB.crypto.MessageDigest.getHashLength=function(a){var b=aB.crypto.MessageDigest,c=b.getCanonicalAlgName(a);if(void 0===b.HASHLENGTH[c])throw"not supported algorithm: "+a;return b.HASHLENGTH[c]},aB.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},aB.crypto.Mac=function(a){this.setAlgAndProvider=function(a,b){if(null==(a=a.toLowerCase())&&(a="hmacsha1"),"hmac"!=(a=a.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+a;void 0===b&&(b=aB.crypto.Util.DEFAULTPROVIDER[a]),this.algProv=a+"/"+b;var c=a.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(c)&&"cryptojs"==b){try{var d=aB.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[c];this.mac=J.algo.HMAC.create(d,this.pass)}catch(e){throw"setAlgAndProvider hash alg set fail hashAlg="+c+"/"+e}this.updateString=function(a){this.mac.update(a)},this.updateHex=function(a){var b=J.enc.Hex.parse(a);this.mac.update(b)},this.doFinal=function(){return this.mac.finalize().toString(J.enc.Hex)},this.doFinalString=function(a){return this.updateString(a),this.doFinal()},this.doFinalHex=function(a){return this.updateHex(a),this.doFinal()}}},this.updateString=function(a){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(a){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(a){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(a){if("string"==typeof a){var b=a;return a.length%2!=1&&a.match(/^[0-9A-Fa-f]+$/)||(b=aQ(a)),void(this.pass=J.enc.Hex.parse(b))}if("object"!=(void 0===a?"undefined":G(a)))throw"KJUR.crypto.Mac unsupported password type: "+a;if(b=null,void 0!==a.hex){if(a.hex.length%2!=0||!a.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+a.hex;b=a.hex}if(void 0!==a.utf8&&(b=aN(a.utf8)),void 0!==a.rstr&&(b=aQ(a.rstr)),void 0!==a.b64&&(b=N(a.b64)),void 0!==a.b64u&&(b=aM(a.b64u)),null==b)throw"KJUR.crypto.Mac unsupported password type: "+a;this.pass=J.enc.Hex.parse(b)},void 0!==a&&(void 0!==a.pass&&this.setPassword(a.pass),void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov&&(this.provName=aB.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},aB.crypto.Signature=function(a){var b=null;if(this._setAlgNames=function(){var a=this.algName.match(/^(.+)with(.+)$/);a&&(this.mdAlgName=a[1].toLowerCase(),this.pubkeyAlgName=a[2].toLowerCase(),"rsaandmgf1"==this.pubkeyAlgName&&"sha"==this.mdAlgName&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(a,b){for(var c="",d=b/4-a.length,e=0;e<d;e++)c+="0";return c+a},this.setAlgAndProvider=function(a,b){if(this._setAlgNames(),"cryptojs/jsrsa"!=b)throw Error("provider not supported: "+b);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new aB.crypto.MessageDigest({alg:this.mdAlgName})}catch(c){throw Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+c)}this.init=function(a,b){var c=null;try{c=void 0===b?a7.getKey(a):a7.getKey(a,b)}catch(d){throw"init failed:"+d}if(!0===c.isPrivate)this.prvKey=c,this.state="SIGN";else{if(!0!==c.isPublic)throw"init failed.:"+c;this.pubKey=c,this.state="VERIFY"}},this.updateString=function(a){this.md.updateString(a)},this.updateHex=function(a){this.md.updateHex(a)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0===this.prvKey&& void 0!==this.ecprvhex&& void 0!==this.eccurvename&& void 0!==aB.crypto.ECDSA&&(this.prvKey=new aB.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof as&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof as&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof aB.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof aB.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(a){return this.updateString(a),this.sign()},this.signHex=function(a){return this.updateHex(a),this.sign()},this.verify=function(a){if(this.sHashHex=this.md.digest(),void 0===this.pubKey&& void 0!==this.ecpubhex&& void 0!==this.eccurvename&& void 0!==aB.crypto.ECDSA&&(this.pubKey=new aB.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof as&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,a,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof as&&"rsa"===this.pubkeyAlgName|| void 0!==aB.crypto.ECDSA&&this.pubKey instanceof aB.crypto.ECDSA|| void 0!==aB.crypto.DSA&&this.pubKey instanceof aB.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(a,b){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(a){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(a){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(a){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(a){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=a,void 0!==a&&(void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov?this.provName=aB.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=a.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==a.psssaltlen&&(this.pssSaltLen=a.psssaltlen),void 0!==a.prvkeypem)){if(void 0!==a.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{b=a7.getKey(a.prvkeypem),this.init(b)}catch(c){throw"fatal error to load pem private key: "+c}}},aB.crypto.Cipher=function(a){},aB.crypto.Cipher.encrypt=function(a,b,c){if(b instanceof as&&b.isPublic){var d=aB.crypto.Cipher.getAlgByKeyAndName(b,c);if("RSA"===d)return b.encrypt(a);if("RSAOAEP"===d)return b.encryptOAEP(a,"sha1");var e=d.match(/^RSAOAEP(\d+)$/);if(null!==e)return b.encryptOAEP(a,"sha"+e[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+c}throw"Cipher.encrypt: unsupported key or algorithm"},aB.crypto.Cipher.decrypt=function(a,b,c){if(b instanceof as&&b.isPrivate){var d=aB.crypto.Cipher.getAlgByKeyAndName(b,c);if("RSA"===d)return b.decrypt(a);if("RSAOAEP"===d)return b.decryptOAEP(a,"sha1");var e=d.match(/^RSAOAEP(\d+)$/);if(null!==e)return b.decryptOAEP(a,"sha"+e[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+c}throw"Cipher.decrypt: unsupported key or algorithm"},aB.crypto.Cipher.getAlgByKeyAndName=function(a,b){if(a instanceof as){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(b))return b;if(null==b)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+b}throw"getAlgByKeyAndName: not supported algorithm name: "+b},aB.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},void 0!==aB&&aB||(b.KJUR=aB={}),void 0!==aB.crypto&&aB.crypto||(aB.crypto={}),aB.crypto.ECDSA=function(a){var b=Error,c=P,d=au,e=aB.crypto.ECDSA,f=aB.crypto.ECParameterDB,g=e.getName,h=aE,i=h.getVbyListEx,j=h.isASN1HEX,k=new ap;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(a){return new c(a.bitLength(),k).mod(a.subtract(c.ONE)).add(c.ONE)},this.setNamedCurve=function(a){this.ecparams=f.getByName(a),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=a},this.setPrivateKeyHex=function(a){this.isPrivate=!0,this.prvKeyHex=a},this.setPublicKeyHex=function(a){this.isPublic=!0,this.pubKeyHex=a},this.getPublicKeyXYHex=function(){var a=this.pubKeyHex;if("04"!==a.substr(0,2))throw"this method supports uncompressed format(04) only";var b=this.ecparams.keylen/4;if(a.length!==2+2*b)throw"malformed public key hex length";var c={};return c.x=a.substr(2,b),c.y=a.substr(2+b),c},this.getShortNISTPCurveName=function(){var a=this.curveName;return"secp256r1"===a||"NIST P-256"===a||"P-256"===a||"prime256v1"===a?"P-256":"secp384r1"===a||"NIST P-384"===a||"P-384"===a?"P-384":null},this.generateKeyPairHex=function(){var a=this.ecparams.n,b=this.getBigRandom(a),c=this.ecparams.G.multiply(b),d=c.getX().toBigInteger(),e=c.getY().toBigInteger(),f=this.ecparams.keylen/4,g=("0000000000"+b.toString(16)).slice(-f),h="04"+("0000000000"+d.toString(16)).slice(-f)+("0000000000"+e.toString(16)).slice(-f);return this.setPrivateKeyHex(g),this.setPublicKeyHex(h),{ecprvhex:g,ecpubhex:h}},this.signWithMessageHash=function(a){return this.signHex(a,this.prvKeyHex)},this.signHex=function(a,b){var d=new c(b,16),f=this.ecparams.n,g=new c(a.substring(0,this.ecparams.keylen/4),16);do var h=this.getBigRandom(f),i=this.ecparams.G.multiply(h).getX().toBigInteger().mod(f);while(0>=i.compareTo(c.ZERO));var j=h.modInverse(f).multiply(g.add(d.multiply(i))).mod(f);return e.biRSSigToASN1Sig(i,j)},this.sign=function(a,b){var d=b,e=this.ecparams.n,f=c.fromByteArrayUnsigned(a);do var g=this.getBigRandom(e),h=this.ecparams.G.multiply(g).getX().toBigInteger().mod(e);while(0>=h.compareTo(P.ZERO));var i=g.modInverse(e).multiply(f.add(d.multiply(h))).mod(e);return this.serializeSig(h,i)},this.verifyWithMessageHash=function(a,b){return this.verifyHex(a,b,this.pubKeyHex)},this.verifyHex=function(a,b,f){try{var g,h,i=e.parseSigHex(b);g=i.r,h=i.s;var j=d.decodeFromHex(this.ecparams.curve,f),k=new c(a.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(k,g,h,j)}catch(l){return!1}},this.verify=function(a,b,e){if(Bitcoin.Util.isArray(b)){var f,g,h,i=this.parseSig(b);f=i.r,g=i.s}else{if("object"!==(void 0===b?"undefined":G(b))||!b.r||!b.s)throw"Invalid value for signature";f=b.r,g=b.s}if(e instanceof au)h=e;else{if(!Bitcoin.Util.isArray(e))throw"Invalid format for pubkey value, must be byte array or ECPointFp";h=d.decodeFrom(this.ecparams.curve,e)}var j=c.fromByteArrayUnsigned(a);return this.verifyRaw(j,f,g,h)},this.verifyRaw=function(a,b,d,e){var f=this.ecparams.n,g=this.ecparams.G;if(0>b.compareTo(c.ONE)||b.compareTo(f)>=0||0>d.compareTo(c.ONE)||d.compareTo(f)>=0)return!1;var h=d.modInverse(f),i=a.multiply(h).mod(f),j=b.multiply(h).mod(f);return g.multiply(i).add(e.multiply(j)).getX().toBigInteger().mod(f).equals(b)},this.serializeSig=function(a,b){var c=a.toByteArraySigned(),d=b.toByteArraySigned(),e=[];return e.push(2),e.push(c.length),(e=e.concat(c)).push(2),e.push(d.length),(e=e.concat(d)).unshift(e.length),e.unshift(48),e},this.parseSig=function(a){if(48!=a[0])throw Error("Signature not a valid DERSequence");if(2!=a[b=2])throw Error("First element in signature must be a DERInteger");var b,d=a.slice(b+2,b+2+a[b+1]);if(2!=a[b+=2+a[b+1]])throw Error("Second element in signature must be a DERInteger");var e=a.slice(b+2,b+2+a[b+1]);return b+=2+a[b+1],{r:c.fromByteArrayUnsigned(d),s:c.fromByteArrayUnsigned(e)}},this.parseSigCompact=function(a){if(65!==a.length)throw"Signature has the wrong length";var b=a[0]-27;if(b<0||b>7)throw"Invalid signature type";var d=this.ecparams.n;return{r:c.fromByteArrayUnsigned(a.slice(1,33)).mod(d),s:c.fromByteArrayUnsigned(a.slice(33,65)).mod(d),i:b}},this.readPKCS5PrvKeyHex=function(a){var b,c,d;if(!1===j(a))throw Error("not ASN.1 hex string");try{b=i(a,0,["[0]",0],"06"),c=i(a,0,[1],"04");try{d=i(a,0,["[1]",0],"03")}catch(e){}}catch(f){throw Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=g(b),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(d),this.setPrivateKeyHex(c),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(a){var c,d,e;if(!1===j(a))throw new b("not ASN.1 hex string");try{i(a,0,[1,0],"06"),c=i(a,0,[1,1],"06"),d=i(a,0,[2,0,1],"04");try{e=i(a,0,[2,0,"[1]",0],"03")}catch(f){}}catch(h){throw new b("malformed PKCS#8 plain ECC private key")}if(this.curveName=g(c),void 0===this.curveName)throw new b("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(e),this.setPrivateKeyHex(d),this.isPublic=!1},this.readPKCS8PubKeyHex=function(a){var c,d;if(!1===j(a))throw new b("not ASN.1 hex string");try{i(a,0,[0,0],"06"),c=i(a,0,[0,1],"06"),d=i(a,0,[1],"03")}catch(e){throw new b("malformed PKCS#8 ECC public key")}if(this.curveName=g(c),null===this.curveName)throw new b("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(d)},this.readCertPubKeyHex=function(a,c){var d,e;if(!1===j(a))throw new b("not ASN.1 hex string");try{d=i(a,0,[0,5,0,1],"06"),e=i(a,0,[0,5,1],"03")}catch(f){throw new b("malformed X.509 certificate ECC public key")}if(this.curveName=g(d),null===this.curveName)throw new b("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(e)},void 0!==a&& void 0!==a.curve&&(this.curveName=a.curve),void 0===this.curveName&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),void 0!==a&&(void 0!==a.prv&&this.setPrivateKeyHex(a.prv),void 0!==a.pub&&this.setPublicKeyHex(a.pub))},aB.crypto.ECDSA.parseSigHex=function(a){var b=aB.crypto.ECDSA.parseSigHexInHexRS(a);return{r:new P(b.r,16),s:new P(b.s,16)}},aB.crypto.ECDSA.parseSigHexInHexRS=function(a){var b=aE,c=b.getChildIdx,d=b.getV;if(b.checkStrictDER(a,0),"30"!=a.substr(0,2))throw Error("signature is not a ASN.1 sequence");var e=c(a,0);if(2!=e.length)throw Error("signature shall have two elements");var f=e[0],g=e[1];if("02"!=a.substr(f,2))throw Error("1st item not ASN.1 integer");if("02"!=a.substr(g,2))throw Error("2nd item not ASN.1 integer");return{r:d(a,f),s:d(a,g)}},aB.crypto.ECDSA.asn1SigToConcatSig=function(a){var b=aB.crypto.ECDSA.parseSigHexInHexRS(a),c=b.r,d=b.s;if("00"==c.substr(0,2)&&c.length%32==2&&(c=c.substr(2)),"00"==d.substr(0,2)&&d.length%32==2&&(d=d.substr(2)),c.length%32==30&&(c="00"+c),d.length%32==30&&(d="00"+d),c.length%32!=0)throw"unknown ECDSA sig r length error";if(d.length%32!=0)throw"unknown ECDSA sig s length error";return c+d},aB.crypto.ECDSA.concatSigToASN1Sig=function(a){if(a.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var b=a.substr(0,a.length/2),c=a.substr(a.length/2);return aB.crypto.ECDSA.hexRSSigToASN1Sig(b,c)},aB.crypto.ECDSA.hexRSSigToASN1Sig=function(a,b){var c=new P(a,16),d=new P(b,16);return aB.crypto.ECDSA.biRSSigToASN1Sig(c,d)},aB.crypto.ECDSA.biRSSigToASN1Sig=function(a,b){var c=aB.asn1,d=new c.DERInteger({bigint:a}),e=new c.DERInteger({bigint:b});return new c.DERSequence({array:[d,e]}).getEncodedHex()},aB.crypto.ECDSA.getName=function(a){return"2b8104001f"===a?"secp192k1":"2a8648ce3d030107"===a?"secp256r1":"2b8104000a"===a?"secp256k1":"2b81040021"===a?"secp224r1":"2b81040022"===a?"secp384r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(a)?"secp256r1":-1!=="|secp256k1|".indexOf(a)?"secp256k1":-1!=="|secp224r1|NIST P-224|P-224|".indexOf(a)?"secp224r1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(a)?"secp384r1":null},void 0!==aB&&aB||(b.KJUR=aB={}),void 0!==aB.crypto&&aB.crypto||(aB.crypto={}),aB.crypto.ECParameterDB=new function(){var a={},b={};function c(a){return new P(a,16)}this.getByName=function(c){var d=c;if(void 0!==b[d]&&(d=b[c]),void 0!==a[d])return a[d];throw"unregistered EC curve name: "+d},this.regist=function(d,e,f,g,h,i,j,k,l,m,n,o){a[d]={};var p=c(f),q=c(g),r=c(h),s=c(i),t=c(j),u=new av(p,q,r),v=u.decodePointHex("04"+k+l);a[d].name=d,a[d].keylen=e,a[d].curve=u,a[d].G=v,a[d].n=s,a[d].h=t,a[d].oid=n,a[d].info=o;for(var w=0;w<m.length;w++)b[m[w]]=d}},aB.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),aB.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),aB.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),aB.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),aB.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),aB.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),aB.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),aB.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),aB.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),aB.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var a7=(c=function(a,b,c){return d(J.AES,a,b,c)},d=function(a,b,c,d){var e=J.enc.Hex.parse(b),f=J.enc.Hex.parse(c),g=J.enc.Hex.parse(d),h={};h.key=f,h.iv=g,h.ciphertext=e;var i=a.decrypt(h,f,{iv:g});return J.enc.Hex.stringify(i)},e=function(a,b,c){return f(J.AES,a,b,c)},f=function(a,b,c,d){var e=J.enc.Hex.parse(b),f=J.enc.Hex.parse(c),g=J.enc.Hex.parse(d),h=a.encrypt(e,f,{iv:g}),i=J.enc.Hex.parse(h.toString());return J.enc.Base64.stringify(i)},g={"AES-256-CBC":{proc:c,eproc:e,keylen:32,ivlen:16},"AES-192-CBC":{proc:c,eproc:e,keylen:24,ivlen:16},"AES-128-CBC":{proc:c,eproc:e,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(a,b,c){return d(J.TripleDES,a,b,c)},eproc:function(a,b,c){return f(J.TripleDES,a,b,c)},keylen:24,ivlen:8},"DES-CBC":{proc:function(a,b,c){return d(J.DES,a,b,c)},eproc:function(a,b,c){return f(J.DES,a,b,c)},keylen:8,ivlen:8}},h=function(a){var b={},c=a.match(RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));c&&(b.cipher=c[1],b.ivsalt=c[2]);var d=a.match(RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));d&&(b.type=d[1]);var e=-1,f=0;-1!=a.indexOf("\r\n\r\n")&&(e=a.indexOf("\r\n\r\n"),f=2),-1!=a.indexOf("\n\n")&&(e=a.indexOf("\n\n"),f=1);var g=a.indexOf("-----END");if(-1!=e&& -1!=g){var h=a.substring(e+2*f,g-f);h=h.replace(/\s+/g,""),b.data=h}return b},i=function(a,b,c){for(var d=c.substring(0,16),e=J.enc.Hex.parse(d),f=J.enc.Utf8.parse(b),h=g[a].keylen+g[a].ivlen,i="",j=null;;){var k=J.algo.MD5.create();if(null!=j&&k.update(j),k.update(f),k.update(e),j=k.finalize(),(i+=J.enc.Hex.stringify(j)).length>=2*h)break}var l={};return l.keyhex=i.substr(0,2*g[a].keylen),l.ivhex=i.substr(2*g[a].keylen,2*g[a].ivlen),l},j=function(a,b,c,d){var e=J.enc.Base64.parse(a),f=J.enc.Hex.stringify(e);return(0,g[b].proc)(f,c,d)},{version:"1.0.0",parsePKCS5PEM:function(a){return h(a)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(a,b,c){return i(a,b,c)},decryptKeyB64:function(a,b,c,d){return j(a,b,c,d)},getDecryptedKeyHex:function(a,b){var c=h(a),d=(c.type,c.cipher),e=c.ivsalt,f=c.data,g=i(d,b,e).keyhex;return j(f,d,g,e)},getEncryptedPKCS5PEMFromPrvKeyHex:function(a,b,c,d,e){var f,h,j,k,l,m,n="";if(void 0!==d&&null!=d||(d="AES-256-CBC"),void 0===g[d])throw Error("KEYUTIL unsupported algorithm: "+d);void 0!==e&&null!=e||(e=(f=g[d].ivlen,h=J.lib.WordArray.random(f),J.enc.Hex.stringify(h)).toUpperCase());var o=(j=b,k=d,l=i(d,c,e).keyhex,m=e,(0,g[k].eproc)(j,l,m));return n="-----BEGIN "+a+" PRIVATE KEY-----\r\n",n+="Proc-Type: 4,ENCRYPTED\r\n",n+="DEK-Info: "+d+","+e+"\r\n",n+="\r\n",n+=o.replace(/(.{64})/g,"$1\r\n"),n+="\r\n-----END "+a+" PRIVATE KEY-----\r\n"},parseHexOfEncryptedPKCS8:function(a){var b=aE,c=b.getChildIdx,d=b.getV,e={},f=c(a,0);if(2!=f.length)throw Error("malformed format: SEQUENCE(0).items != 2: "+f.length);e.ciphertext=d(a,f[1]);var g=c(a,f[0]);if(2!=g.length)throw Error("malformed format: SEQUENCE(0.0).items != 2: "+g.length);if("2a864886f70d01050d"!=d(a,g[0]))throw Error("this only supports pkcs5PBES2");var h=c(a,g[1]);if(2!=g.length)throw Error("malformed format: SEQUENCE(0.0.1).items != 2: "+h.length);var i=c(a,h[1]);if(2!=i.length)throw Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+i.length);if("2a864886f70d0307"!=d(a,i[0]))throw"this only supports TripleDES";e.encryptionSchemeAlg="TripleDES",e.encryptionSchemeIV=d(a,i[1]);var j=c(a,h[0]);if(2!=j.length)throw Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+j.length);if("2a864886f70d01050c"!=d(a,j[0]))throw Error("this only supports pkcs5PBKDF2");var k=c(a,j[1]);if(k.length<2)throw Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+k.length);e.pbkdf2Salt=d(a,k[0]);var l=d(a,k[1]);try{e.pbkdf2Iter=parseInt(l,16)}catch(m){throw Error("malformed format pbkdf2Iter: "+l)}return e},getPBKDF2KeyHexFromParam:function(a,b){var c=J.enc.Hex.parse(a.pbkdf2Salt),d=a.pbkdf2Iter,e=J.PBKDF2(b,c,{keySize:6,iterations:d});return J.enc.Hex.stringify(e)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(a,b){var c=aV(a,"ENCRYPTED PRIVATE KEY"),d=this.parseHexOfEncryptedPKCS8(c),e=a7.getPBKDF2KeyHexFromParam(d,b),f={};f.ciphertext=J.enc.Hex.parse(d.ciphertext);var g=J.enc.Hex.parse(e),h=J.enc.Hex.parse(d.encryptionSchemeIV),i=J.TripleDES.decrypt(f,g,{iv:h});return J.enc.Hex.stringify(i)},getKeyFromEncryptedPKCS8PEM:function(a,b){var c=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(a,b);return this.getKeyFromPlainPrivatePKCS8Hex(c)},parsePlainPrivatePKCS8Hex:function(a){var b=aE,c=b.getChildIdx,d=b.getV,e={algparam:null};if("30"!=a.substr(0,2))throw Error("malformed plain PKCS8 private key(code:001)");var f=c(a,0);if(f.length<3)throw Error("malformed plain PKCS8 private key(code:002)");if("30"!=a.substr(f[1],2))throw Error("malformed PKCS8 private key(code:003)");var g=c(a,f[1]);if(2!=g.length)throw Error("malformed PKCS8 private key(code:004)");if("06"!=a.substr(g[0],2))throw Error("malformed PKCS8 private key(code:005)");if(e.algoid=d(a,g[0]),"06"==a.substr(g[1],2)&&(e.algparam=d(a,g[1])),"04"!=a.substr(f[2],2))throw Error("malformed PKCS8 private key(code:006)");return e.keyidx=b.getVidx(a,f[2]),e},getKeyFromPlainPrivatePKCS8PEM:function(a){var b=aV(a,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(b)},getKeyFromPlainPrivatePKCS8Hex:function(a){var b,c=this.parsePlainPrivatePKCS8Hex(a);if("2a864886f70d010101"==c.algoid)b=new as;else if("2a8648ce380401"==c.algoid)b=new aB.crypto.DSA;else{if("2a8648ce3d0201"!=c.algoid)throw Error("unsupported private key algorithm");b=new aB.crypto.ECDSA}return b.readPKCS8PrvKeyHex(a),b},_getKeyFromPublicPKCS8Hex:function(a){var b,c=aE.getVbyList(a,0,[0,0],"06");if("2a864886f70d010101"===c)b=new as;else if("2a8648ce380401"===c)b=new aB.crypto.DSA;else{if("2a8648ce3d0201"!==c)throw Error("unsupported PKCS#8 public key hex");b=new aB.crypto.ECDSA}return b.readPKCS8PubKeyHex(a),b},parsePublicRawRSAKeyHex:function(a){var b=aE,c=b.getChildIdx,d=b.getV,e={};if("30"!=a.substr(0,2))throw Error("malformed RSA key(code:001)");var f=c(a,0);if(2!=f.length)throw Error("malformed RSA key(code:002)");if("02"!=a.substr(f[0],2))throw Error("malformed RSA key(code:003)");if(e.n=d(a,f[0]),"02"!=a.substr(f[1],2))throw Error("malformed RSA key(code:004)");return e.e=d(a,f[1]),e},parsePublicPKCS8Hex:function(a){var b=aE,c=b.getChildIdx,d=b.getV,e={algparam:null},f=c(a,0);if(2!=f.length)throw Error("outer DERSequence shall have 2 elements: "+f.length);var g=f[0];if("30"!=a.substr(g,2))throw Error("malformed PKCS8 public key(code:001)");var h=c(a,g);if(2!=h.length)throw Error("malformed PKCS8 public key(code:002)");if("06"!=a.substr(h[0],2))throw Error("malformed PKCS8 public key(code:003)");if(e.algoid=d(a,h[0]),"06"==a.substr(h[1],2)?e.algparam=d(a,h[1]):"30"==a.substr(h[1],2)&&(e.algparam={},e.algparam.p=b.getVbyList(a,h[1],[0],"02"),e.algparam.q=b.getVbyList(a,h[1],[1],"02"),e.algparam.g=b.getVbyList(a,h[1],[2],"02")),"03"!=a.substr(f[1],2))throw Error("malformed PKCS8 public key(code:004)");return e.key=d(a,f[1]).substr(2),e}});function a8(a,b){for(var c="",d=b/4-a.length,e=0;e<d;e++)c+="0";return c+a}function a9(a,b,c){for(var d="",e=0;d.length<b;)d+=aP(c(aQ(a+String.fromCharCode.apply(String,[(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e])))),e+=1;return d}function ba(a){for(var b in aB.crypto.Util.DIGESTINFOHEAD){var c=aB.crypto.Util.DIGESTINFOHEAD[b],d=c.length;if(a.substring(0,d)==c)return[b,a.substring(d)]}return[]}function bb(a){var b,c=aE,d=c.getChildIdx,e=c.getV,f=c.getTLV,g=c.getVbyList,h=c.getVbyListEx,i=c.getTLVbyList,j=c.getTLVbyListEx,k=c.getIdxbyList,l=c.getIdxbyListEx,m=c.getVidx,n=c.getInt,o=c.oidname,p=c.hextooidstr,q=aV;try{b=aB.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch(r){}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(null===this.hex||0!==this.version)return this.version;var a=i(this.hex,0,[0,0]);if("a0"==a.substr(0,2)){var b=i(a,0,[0]),c=n(b,0);if(c<0||2<c)throw Error("malformed version field");return this.version=c+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return h(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var a=j(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(a)},this.getAlgorithmIdentifierName=function(a){for(var c in b)if(a===b[c])return c;return o(h(a,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return i(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return i(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var a=g(this.hex,0,[0,4+this.foffset,0]);return decodeURIComponent(a=a.replace(/(..)/g,"%$1"))},this.getNotAfter=function(){var a=g(this.hex,0,[0,4+this.foffset,1]);return decodeURIComponent(a=a.replace(/(..)/g,"%$1"))},this.getPublicKeyHex=function(){return c.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return k(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var a=this.getPublicKeyIdx();return k(this.hex,a,[1,0],"30")},this.getPublicKey=function(){return a7.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var a=i(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(a)},this.getSignatureValueHex=function(){return g(this.hex,0,[2],"03",!0)},this.verifySignature=function(a){var b=this.getSignatureAlgorithmField(),c=this.getSignatureValueHex(),d=i(this.hex,0,[0],"30"),e=new aB.crypto.Signature({alg:b});return e.init(a),e.updateHex(d),e.verify(c)},this.parseExt=function(a){var b,f,h;if(void 0===a){if(h=this.hex,3!==this.version)return -1;b=k(h,0,[0,7,0],"30"),f=d(h,b)}else{h=aV(a);var i=k(h,0,[0,3,0,0],"06");if("2a864886f70d01090e"!=e(h,i))return void(this.aExtInfo=[]);b=k(h,0,[0,3,0,1,0],"30"),f=d(h,b),this.hex=h}this.aExtInfo=[];for(var j=0;j<f.length;j++){var l={critical:!1},n=0;3===d(h,f[j]).length&&(l.critical=!0,n=1),l.oid=c.hextooidstr(g(h,f[j],[0],"06"));var o=k(h,f[j],[1+n]);l.vidx=m(h,o),this.aExtInfo.push(l)}},this.getExtInfo=function(a){var b=this.aExtInfo,c=a;if(a.match(/^[0-9.]+$/)||(c=aB.asn1.x509.OID.name2oid(a)),""!==c){for(var d=0;d<b.length;d++)if(b[d].oid===c)return b[d]}},this.getExtBasicConstraints=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("basicConstraints");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var d={extname:"basicConstraints"};if(b&&(d.critical=!0),"3000"===a)return d;if("30030101ff"===a)return d.cA=!0,d;if("30060101ff02"===a.substr(0,12)){var g=e(a,10),h=parseInt(g,16);return d.cA=!0,d.pathLen=h,d}throw Error("hExtV parse error: "+a)},this.getExtKeyUsage=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("keyUsage");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var d={extname:"keyUsage"};return b&&(d.critical=!0),d.names=this.getExtKeyUsageString(a).split(","),d},this.getExtKeyUsageBin=function(a){if(void 0===a){var b=this.getExtInfo("keyUsage");if(void 0===b)return"";a=f(this.hex,b.vidx)}if(8!=a.length&&10!=a.length)throw Error("malformed key usage value: "+a);var c="000000000000000"+parseInt(a.substr(6),16).toString(2);return 8==a.length&&(c=c.slice(-8)),10==a.length&&(c=c.slice(-16)),""==(c=c.replace(/0+$/,""))&&(c="0"),c},this.getExtKeyUsageString=function(a){for(var b=this.getExtKeyUsageBin(a),c=[],d=0;d<b.length;d++)"1"==b.substr(d,1)&&c.push(bb.KEYUSAGE_NAME[d]);return c.join(",")},this.getExtSubjectKeyIdentifier=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("subjectKeyIdentifier");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var d={extname:"subjectKeyIdentifier"};b&&(d.critical=!0);var g=e(a,0);return d.kid={hex:g},d},this.getExtAuthorityKeyIdentifier=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("authorityKeyIdentifier");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var g={extname:"authorityKeyIdentifier"};b&&(g.critical=!0);for(var h=d(a,0),i=0;i<h.length;i++){var j=a.substr(h[i],2);if("80"===j&&(g.kid={hex:e(a,h[i])}),"a1"===j){var k=f(a,h[i]),l=this.getGeneralNames(k);g.issuer=l[0].dn}"82"===j&&(g.sn={hex:e(a,h[i])})}return g},this.getExtExtKeyUsage=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("extKeyUsage");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var g={extname:"extKeyUsage",array:[]};b&&(g.critical=!0);for(var h=d(a,0),i=0;i<h.length;i++)g.array.push(o(e(a,h[i])));return g},this.getExtExtKeyUsageName=function(){var a=this.getExtInfo("extKeyUsage");if(void 0===a)return a;var b=[],c=f(this.hex,a.vidx);if(""===c)return b;for(var g=d(c,0),h=0;h<g.length;h++)b.push(o(e(c,g[h])));return b},this.getExtSubjectAltName=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("subjectAltName");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var d={extname:"subjectAltName",array:[]};return b&&(d.critical=!0),d.array=this.getGeneralNames(a),d},this.getExtIssuerAltName=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("issuerAltName");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var d={extname:"issuerAltName",array:[]};return b&&(d.critical=!0),d.array=this.getGeneralNames(a),d},this.getGeneralNames=function(a){for(var b=d(a,0),c=[],e=0;e<b.length;e++){var g=this.getGeneralName(f(a,b[e]));void 0!==g&&c.push(g)}return c},this.getGeneralName=function(a){var b=a.substr(0,2),c=e(a,0),d=aP(c);return"81"==b?{rfc822:d}:"82"==b?{dns:d}:"86"==b?{uri:d}:"87"==b?{ip:a0(c)}:"a4"==b?{dn:this.getX500Name(c)}:void 0},this.getExtSubjectAltName2=function(){var a,b,c,g=this.getExtInfo("subjectAltName");if(void 0===g)return g;for(var h=[],i=f(this.hex,g.vidx),j=d(i,0),k=0;k<j.length;k++)c=i.substr(j[k],2),a=e(i,j[k]),"81"===c&&h.push(["MAIL",b=aO(a)]),"82"===c&&h.push(["DNS",b=aO(a)]),"84"===c&&h.push(["DN",b=bb.hex2dn(a,0)]),"86"===c&&h.push(["URI",b=aO(a)]),"87"===c&&h.push(["IP",b=a0(a)]);return h},this.getExtCRLDistributionPoints=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("cRLDistributionPoints");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var e={extname:"cRLDistributionPoints",array:[]};b&&(e.critical=!0);for(var g=d(a,0),h=0;h<g.length;h++){var i=f(a,g[h]);e.array.push(this.getDistributionPoint(i))}return e},this.getDistributionPoint=function(a){for(var b={},c=d(a,0),e=0;e<c.length;e++){var g=a.substr(c[e],2),h=f(a,c[e]);"a0"==g&&(b.dpname=this.getDistributionPointName(h))}return b},this.getDistributionPointName=function(a){for(var b={},c=d(a,0),e=0;e<c.length;e++){var g=a.substr(c[e],2),h=f(a,c[e]);"a0"==g&&(b.full=this.getGeneralNames(h))}return b},this.getExtCRLDistributionPointsURI=function(){var a=this.getExtInfo("cRLDistributionPoints");if(void 0===a)return a;for(var b=[],c=d(this.hex,a.vidx),e=0;e<c.length;e++)try{var f=aO(g(this.hex,c[e],[0,0,0],"86"));b.push(f)}catch(h){}return b},this.getExtAIAInfo=function(){var a=this.getExtInfo("authorityInfoAccess");if(void 0===a)return a;for(var b={ocsp:[],caissuer:[]},c=d(this.hex,a.vidx),e=0;e<c.length;e++){var f=g(this.hex,c[e],[0],"06"),h=g(this.hex,c[e],[1],"86");"2b06010505073001"===f&&b.ocsp.push(aO(h)),"2b06010505073002"===f&&b.caissuer.push(aO(h))}return b},this.getExtAuthorityInfoAccess=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("authorityInfoAccess");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var e={extname:"authorityInfoAccess",array:[]};b&&(e.critical=!0);for(var i=d(a,0),j=0;j<i.length;j++){var k=h(a,i[j],[0],"06"),l=aO(g(a,i[j],[1],"86"));if("2b06010505073001"==k)e.array.push({ocsp:l});else{if("2b06010505073002"!=k)throw Error("unknown method: "+k);e.array.push({caissuer:l})}}return e},this.getExtCertificatePolicies=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("certificatePolicies");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var e={extname:"certificatePolicies",array:[]};b&&(e.critical=!0);for(var g=d(a,0),h=0;h<g.length;h++){var i=f(a,g[h]),j=this.getPolicyInformation(i);e.array.push(j)}return e},this.getPolicyInformation=function(a){var b={},c=g(a,0,[0],"06");b.policyoid=o(c);var e=l(a,0,[1],"30");if(-1!=e){b.array=[];for(var h=d(a,e),i=0;i<h.length;i++){var j=f(a,h[i]),k=this.getPolicyQualifierInfo(j);b.array.push(k)}}return b},this.getPolicyQualifierInfo=function(a){var b={},c=g(a,0,[0],"06");if("2b06010505070201"===c){var d=h(a,0,[1],"16");b.cps=aP(d)}else if("2b06010505070202"===c){var e=i(a,0,[1],"30");b.unotice=this.getUserNotice(e)}return b},this.getUserNotice=function(a){for(var b={},c=d(a,0),e=0;e<c.length;e++){var g=f(a,c[e]);"30"!=g.substr(0,2)&&(b.exptext=this.getDisplayText(g))}return b},this.getDisplayText=function(a){var b={};return b.type=({"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"})[a.substr(0,2)],b.str=aP(e(a,0)),b},this.getExtCRLNumber=function(a,b){var c={extname:"cRLNumber"};if(b&&(c.critical=!0),"02"==a.substr(0,2))return c.num={hex:e(a,0)},c;throw Error("hExtV parse error: "+a)},this.getExtCRLReason=function(a,b){var c={extname:"cRLReason"};if(b&&(c.critical=!0),"0a"==a.substr(0,2))return c.code=parseInt(e(a,0),16),c;throw Error("hExtV parse error: "+a)},this.getExtOcspNonce=function(a,b){var c={extname:"ocspNonce"};b&&(c.critical=!0);var d=e(a,0);return c.hex=d,c},this.getExtOcspNoCheck=function(a,b){var c={extname:"ocspNoCheck"};return b&&(c.critical=!0),c},this.getExtAdobeTimeStamp=function(a,b){if(void 0===a&& void 0===b){var c=this.getExtInfo("adobeTimeStamp");if(void 0===c)return;a=f(this.hex,c.vidx),b=c.critical}var e={extname:"adobeTimeStamp"};b&&(e.critical=!0);var g=d(a,0);if(g.length>1){var h=f(a,g[1]),i=this.getGeneralName(h);null!=i.uri&&(e.uri=i.uri)}if(g.length>2){var j=f(a,g[2]);"0101ff"==j&&(e.reqauth=!0),"010100"==j&&(e.reqauth=!1)}return e},this.getX500NameRule=function(a){for(var b=null,c=[],d=0;d<a.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(e[f]);for(d=0;d<c.length;d++){var g=c[d],h=g.ds,i=g.value,j=g.type;if("prn"!=h&&"utf8"!=h&&"ia5"!=h)return"mixed";if("ia5"==h){if("CN"!=j)return"mixed";if(aB.lang.String.isMail(i))continue;return"mixed"}if("C"==j){if("prn"==h)continue;return"mixed"}if(null==b)b=h;else if(b!==h)return"mixed"}return null==b?"prn":b},this.getX500Name=function(a){var b=this.getX500NameArray(a);return{array:b,str:this.dnarraytostr(b)}},this.getX500NameArray=function(a){for(var b=[],c=d(a,0),e=0;e<c.length;e++)b.push(this.getRDN(f(a,c[e])));return b},this.getRDN=function(a){for(var b=[],c=d(a,0),e=0;e<c.length;e++)b.push(this.getAttrTypeAndValue(f(a,c[e])));return b},this.getAttrTypeAndValue=function(a){var b={type:null,value:null,ds:null},c=d(a,0),e=g(a,c[0],[],"06"),f=g(a,c[1],[]),h=aB.asn1.ASN1Util.oidHexToInt(e);return b.type=aB.asn1.x509.OID.oid2atype(h),b.ds=this.HEX2STAG[a.substr(c[1],2)],"bmp"!=b.ds?b.value=aO(f):b.value=a1(f),b},this.readCertPEM=function(a){this.readCertHex(q(a))},this.readCertHex=function(a){this.hex=a,this.getVersion();try{k(this.hex,0,[0,7],"a3"),this.parseExt()}catch(b){}},this.getParam=function(){var a={};return a.version=this.getVersion(),a.serial={hex:this.getSerialNumberHex()},a.sigalg=this.getSignatureAlgorithmField(),a.issuer=this.getIssuer(),a.notbefore=this.getNotBefore(),a.notafter=this.getNotAfter(),a.subject=this.getSubject(),a.sbjpubkey=aU(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(a.ext=this.getExtParamArray()),a.sighex=this.getSignatureValueHex(),a},this.getExtParamArray=function(a){null==a&& -1!=l(this.hex,0,[0,"[3]"])&&(a=j(this.hex,0,[0,"[3]",0],"30"));for(var b=[],c=d(a,0),e=0;e<c.length;e++){var g=f(a,c[e]),h=this.getExtParam(g);null!=h&&b.push(h)}return b},this.getExtParam=function(a){var b=d(a,0).length;if(2!=b&&3!=b)throw Error("wrong number elements in Extension: "+b+" "+a);var c=p(g(a,0,[0],"06")),e=!1;3==b&&"0101ff"==i(a,0,[1])&&(e=!0);var f=i(a,0,[b-1,0]),h=void 0;if("2.5.29.14"==c?h=this.getExtSubjectKeyIdentifier(f,e):"2.5.29.15"==c?h=this.getExtKeyUsage(f,e):"2.5.29.17"==c?h=this.getExtSubjectAltName(f,e):"2.5.29.18"==c?h=this.getExtIssuerAltName(f,e):"2.5.29.19"==c?h=this.getExtBasicConstraints(f,e):"2.5.29.31"==c?h=this.getExtCRLDistributionPoints(f,e):"2.5.29.32"==c?h=this.getExtCertificatePolicies(f,e):"2.5.29.35"==c?h=this.getExtAuthorityKeyIdentifier(f,e):"2.5.29.37"==c?h=this.getExtExtKeyUsage(f,e):"1.3.6.1.5.5.7.1.1"==c?h=this.getExtAuthorityInfoAccess(f,e):"2.5.29.20"==c?h=this.getExtCRLNumber(f,e):"2.5.29.21"==c?h=this.getExtCRLReason(f,e):"1.3.6.1.5.5.7.48.1.2"==c?h=this.getExtOcspNonce(f,e):"1.3.6.1.5.5.7.48.1.5"==c?h=this.getExtOcspNoCheck(f,e):"1.2.840.113583.1.1.9.1"==c&&(h=this.getExtAdobeTimeStamp(f,e)),null!=h)return h;var j={extname:c,extn:f};return e&&(j.critical=!0),j},this.findExt=function(a,b){for(var c=0;c<a.length;c++)if(a[c].extname==b)return a[c];return null},this.updateExtCDPFullURI=function(a,b){var c=this.findExt(a,"cRLDistributionPoints");if(null!=c&&null!=c.array){for(var d=c.array,e=0;e<d.length;e++)if(null!=d[e].dpname&&null!=d[e].dpname.full)for(var f=d[e].dpname.full,g=0;g<f.length;g++){var h=f[e];null!=h.uri&&(h.uri=b)}}},this.updateExtAIAOCSP=function(a,b){var c=this.findExt(a,"authorityInfoAccess");if(null!=c&&null!=c.array)for(var d=c.array,e=0;e<d.length;e++)null!=d[e].ocsp&&(d[e].ocsp=b)},this.updateExtAIACAIssuer=function(a,b){var c=this.findExt(a,"authorityInfoAccess");if(null!=c&&null!=c.array)for(var d=c.array,e=0;e<d.length;e++)null!=d[e].caissuer&&(d[e].caissuer=b)},this.dnarraytostr=function(a){return"/"+a.map(function(a){var b;return(b=a).map(function(a){var b;return((b=a).type+"="+b.value).replace(/\+/,"\\+")}).join("+").replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var a,b,c;if(a="Basic Fields\n",a+="  serial number: "+this.getSerialNumberHex()+"\n",a+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n",a+="  issuer: "+this.getIssuerString()+"\n",a+="  notBefore: "+this.getNotBefore()+"\n",a+="  notAfter: "+this.getNotAfter()+"\n",a+="  subject: "+this.getSubjectString()+"\n",a+="  subject public key info: \n",a+="    key algorithm: "+(b=this.getPublicKey()).type+"\n","RSA"===b.type&&(a+="    n="+a4(b.n.toString(16)).substr(0,16)+"...\n",a+="    e="+a4(b.e.toString(16))+"\n"),null!=(c=this.aExtInfo)){a+="X509v3 Extensions:\n";for(var d=0;d<c.length;d++){var e,f=c[d],g=aB.asn1.x509.OID.oid2name(f.oid);""===g&&(g=f.oid);var h="";if(!0===f.critical&&(h="CRITICAL"),a+="  "+g+" "+h+":\n","basicConstraints"===g){var i=this.getExtBasicConstraints();void 0===i.cA?a+="    {}\n":(a+="    cA=true",void 0!==i.pathLen&&(a+=", pathLen="+i.pathLen),a+="\n")}else if("keyUsage"===g)a+="    "+this.getExtKeyUsageString()+"\n";else if("subjectKeyIdentifier"===g)a+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n";else if("authorityKeyIdentifier"===g){var j=this.getExtAuthorityKeyIdentifier();void 0!==j.kid&&(a+="    kid="+j.kid.hex+"\n")}else"extKeyUsage"===g?a+="    "+this.getExtExtKeyUsage().array.join(", ")+"\n":"subjectAltName"===g?a+="    "+JSON.stringify((e=this.getExtSubjectAltName()).array).replace(/[\[\]\{\}\"]/g,"")+"\n":"cRLDistributionPoints"===g?a+=function(a){for(var b="",c=a.array,d=0;d<c.length;d++){var e=c[d];try{void 0!==e.dpname.full[0].uri&&(b+="    "+e.dpname.full[0].uri+"\n")}catch(f){}try{void 0!==e.dname.full[0].dn.hex&&(b+="    "+bb.hex2dn(e.dpname.full[0].dn.hex)+"\n")}catch(g){}}return b}(this.getExtCRLDistributionPoints()):"authorityInfoAccess"===g?a+=function(a){for(var b="",c=a.array,d=0;d<c.length;d++){var e=c[d];void 0!==e.caissuer&&(b+="    caissuer: "+e.caissuer+"\n"),void 0!==e.ocsp&&(b+="    ocsp: "+e.ocsp+"\n")}return b}(this.getExtAuthorityInfoAccess()):"certificatePolicies"===g&&(a+=function(a){for(var b="",c=a.array,d=0;d<c.length;d++){var e=c[d];if(b+="    policy oid: "+e.policyoid+"\n",void 0!==e.array)for(var f=0;f<e.array.length;f++){var g=e.array[f];void 0!==g.cps&&(b+="    cps: "+g.cps+"\n")}}return b}(this.getExtCertificatePolicies()))}}return a+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n",a+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"},"string"==typeof a&&(-1!=a.indexOf("-----BEGIN")?this.readCertPEM(a):aB.lang.String.isHex(a)&&this.readCertHex(a))}a7.getKey=function(a,b,c){var d,e=(r=aE).getChildIdx,f=(r.getV,r.getVbyList),g=aB.crypto,h=g.ECDSA,i=g.DSA,j=as,k=aV,l=a7;if(void 0!==j&&a instanceof j|| void 0!==h&&a instanceof h|| void 0!==i&&a instanceof i)return a;if(void 0!==a.curve&& void 0!==a.xy&& void 0===a.d)return new h({pub:a.xy,curve:a.curve});if(void 0!==a.curve&& void 0!==a.d)return new h({prv:a.d,curve:a.curve});if(void 0===a.kty&& void 0!==a.n&& void 0!==a.e&& void 0===a.d)return(C=new j).setPublic(a.n,a.e),C;if(void 0===a.kty&& void 0!==a.n&& void 0!==a.e&& void 0!==a.d&& void 0!==a.p&& void 0!==a.q&& void 0!==a.dp&& void 0!==a.dq&& void 0!==a.co&& void 0===a.qi)return(C=new j).setPrivateEx(a.n,a.e,a.d,a.p,a.q,a.dp,a.dq,a.co),C;if(void 0===a.kty&& void 0!==a.n&& void 0!==a.e&& void 0!==a.d&& void 0===a.p)return(C=new j).setPrivate(a.n,a.e,a.d),C;if(void 0!==a.p&& void 0!==a.q&& void 0!==a.g&& void 0!==a.y&& void 0===a.x)return(C=new i).setPublic(a.p,a.q,a.g,a.y),C;if(void 0!==a.p&& void 0!==a.q&& void 0!==a.g&& void 0!==a.y&& void 0!==a.x)return(C=new i).setPrivate(a.p,a.q,a.g,a.y,a.x),C;if("RSA"===a.kty&& void 0!==a.n&& void 0!==a.e&& void 0===a.d)return(C=new j).setPublic(aM(a.n),aM(a.e)),C;if("RSA"===a.kty&& void 0!==a.n&& void 0!==a.e&& void 0!==a.d&& void 0!==a.p&& void 0!==a.q&& void 0!==a.dp&& void 0!==a.dq&& void 0!==a.qi)return(C=new j).setPrivateEx(aM(a.n),aM(a.e),aM(a.d),aM(a.p),aM(a.q),aM(a.dp),aM(a.dq),aM(a.qi)),C;if("RSA"===a.kty&& void 0!==a.n&& void 0!==a.e&& void 0!==a.d)return(C=new j).setPrivate(aM(a.n),aM(a.e),aM(a.d)),C;if("EC"===a.kty&& void 0!==a.crv&& void 0!==a.x&& void 0!==a.y&& void 0===a.d){var m=(B=new h({curve:a.crv})).ecparams.keylen/4,n="04"+("0000000000"+aM(a.x)).slice(-m)+("0000000000"+aM(a.y)).slice(-m);return B.setPublicKeyHex(n),B}if("EC"===a.kty&& void 0!==a.crv&& void 0!==a.x&& void 0!==a.y&& void 0!==a.d){m=(B=new h({curve:a.crv})).ecparams.keylen/4,n="04"+("0000000000"+aM(a.x)).slice(-m)+("0000000000"+aM(a.y)).slice(-m);var o=("0000000000"+aM(a.d)).slice(-m);return B.setPublicKeyHex(n),B.setPrivateKeyHex(o),B}if("pkcs5prv"===c){var p,q=a,r=aE;if(9===(p=e(q,0)).length)(C=new j).readPKCS5PrvKeyHex(q);else if(6===p.length)(C=new i).readPKCS5PrvKeyHex(q);else{if(!(p.length>2&&"04"===q.substr(p[1],2)))throw Error("unsupported PKCS#1/5 hexadecimal key");(C=new h).readPKCS5PrvKeyHex(q)}return C}if("pkcs8prv"===c)return l.getKeyFromPlainPrivatePKCS8Hex(a);if("pkcs8pub"===c)return l._getKeyFromPublicPKCS8Hex(a);if("x509pub"===c)return bb.getPublicKeyFromCertHex(a);if(-1!=a.indexOf("-END CERTIFICATE-",0)|| -1!=a.indexOf("-END X509 CERTIFICATE-",0)|| -1!=a.indexOf("-END TRUSTED CERTIFICATE-",0))return bb.getPublicKeyFromCertPEM(a);if(-1!=a.indexOf("-END PUBLIC KEY-")){var s=aV(a,"PUBLIC KEY");return l._getKeyFromPublicPKCS8Hex(s)}if(-1!=a.indexOf("-END RSA PRIVATE KEY-")&& -1==a.indexOf("4,ENCRYPTED")){var t=k(a,"RSA PRIVATE KEY");return l.getKey(t,null,"pkcs5prv")}if(-1!=a.indexOf("-END DSA PRIVATE KEY-")&& -1==a.indexOf("4,ENCRYPTED")){var u=f(d=k(a,"DSA PRIVATE KEY"),0,[1],"02"),v=f(d,0,[2],"02"),w=f(d,0,[3],"02"),x=f(d,0,[4],"02"),y=f(d,0,[5],"02");return(C=new i).setPrivate(new P(u,16),new P(v,16),new P(w,16),new P(x,16),new P(y,16)),C}if(-1!=a.indexOf("-END EC PRIVATE KEY-")&& -1==a.indexOf("4,ENCRYPTED"))return t=k(a,"EC PRIVATE KEY"),l.getKey(t,null,"pkcs5prv");if(-1!=a.indexOf("-END PRIVATE KEY-"))return l.getKeyFromPlainPrivatePKCS8PEM(a);if(-1!=a.indexOf("-END RSA PRIVATE KEY-")&& -1!=a.indexOf("4,ENCRYPTED")){var z=l.getDecryptedKeyHex(a,b),A=new as;return A.readPKCS5PrvKeyHex(z),A}if(-1!=a.indexOf("-END EC PRIVATE KEY-")&& -1!=a.indexOf("4,ENCRYPTED")){var B,C=f(d=l.getDecryptedKeyHex(a,b),0,[1],"04"),D=f(d,0,[2,0],"06"),E=f(d,0,[3,0],"03").substr(2);if(void 0===aB.crypto.OID.oidhex2name[D])throw Error("undefined OID(hex) in KJUR.crypto.OID: "+D);return(B=new h({curve:aB.crypto.OID.oidhex2name[D]})).setPublicKeyHex(E),B.setPrivateKeyHex(C),B.isPublic=!1,B}if(-1!=a.indexOf("-END DSA PRIVATE KEY-")&& -1!=a.indexOf("4,ENCRYPTED"))return u=f(d=l.getDecryptedKeyHex(a,b),0,[1],"02"),v=f(d,0,[2],"02"),w=f(d,0,[3],"02"),x=f(d,0,[4],"02"),y=f(d,0,[5],"02"),(C=new i).setPrivate(new P(u,16),new P(v,16),new P(w,16),new P(x,16),new P(y,16)),C;if(-1!=a.indexOf("-END ENCRYPTED PRIVATE KEY-"))return l.getKeyFromEncryptedPKCS8PEM(a,b);throw Error("not supported argument")},a7.generateKeypair=function(a,b){if("RSA"==a){var c=b;(g=new as).generate(c,"10001"),g.isPrivate=!0,g.isPublic=!0;var d=new as,e=g.n.toString(16),f=g.e.toString(16);return d.setPublic(e,f),d.isPrivate=!1,d.isPublic=!0,(h={}).prvKeyObj=g,h.pubKeyObj=d,h}if("EC"==a){var g,h,i=b,j=new aB.crypto.ECDSA({curve:i}).generateKeyPairHex();return(g=new aB.crypto.ECDSA({curve:i})).setPublicKeyHex(j.ecpubhex),g.setPrivateKeyHex(j.ecprvhex),g.isPrivate=!0,g.isPublic=!1,(d=new aB.crypto.ECDSA({curve:i})).setPublicKeyHex(j.ecpubhex),d.isPrivate=!1,d.isPublic=!0,(h={}).prvKeyObj=g,h.pubKeyObj=d,h}throw Error("unknown algorithm: "+a)},a7.getPEM=function(a,b,c,d,e,f){var g=aB,h=g.asn1,i=h.DERObjectIdentifier,j=h.DERInteger,k=h.ASN1Util.newObject,l=h.x509.SubjectPublicKeyInfo,m=g.crypto,n=m.DSA,o=m.ECDSA,p=as;function q(a){return k({seq:[{int:0},{int:{bigint:a.n}},{int:a.e},{int:{bigint:a.d}},{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.dmp1}},{int:{bigint:a.dmq1}},{int:{bigint:a.coeff}}]})}function r(a){return k({seq:[{int:1},{octstr:{hex:a.prvKeyHex}},{tag:["a0",!0,{oid:{name:a.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]}]})}function s(a){return k({seq:[{int:0},{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.g}},{int:{bigint:a.y}},{int:{bigint:a.x}}]})}if((void 0!==p&&a instanceof p|| void 0!==n&&a instanceof n|| void 0!==o&&a instanceof o)&&1==a.isPublic&&(void 0===b||"PKCS8PUB"==b))return aU(w=new l(a).getEncodedHex(),"PUBLIC KEY");if("PKCS1PRV"==b&& void 0!==p&&a instanceof p&&(void 0===c||null==c)&&1==a.isPrivate)return aU(w=q(a).getEncodedHex(),"RSA PRIVATE KEY");if("PKCS1PRV"==b&& void 0!==o&&a instanceof o&&(void 0===c||null==c)&&1==a.isPrivate){var t=new i({name:a.curveName}).getEncodedHex(),u=r(a).getEncodedHex(),v="";return v+=aU(t,"EC PARAMETERS"),v+=aU(u,"EC PRIVATE KEY")}if("PKCS1PRV"==b&& void 0!==n&&a instanceof n&&(void 0===c||null==c)&&1==a.isPrivate)return aU(w=s(a).getEncodedHex(),"DSA PRIVATE KEY");if("PKCS5PRV"==b&& void 0!==p&&a instanceof p&& void 0!==c&&null!=c&&1==a.isPrivate){var w=q(a).getEncodedHex();return void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",w,c,d,f)}if("PKCS5PRV"==b&& void 0!==o&&a instanceof o&& void 0!==c&&null!=c&&1==a.isPrivate)return w=r(a).getEncodedHex(),void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",w,c,d,f);if("PKCS5PRV"==b&& void 0!==n&&a instanceof n&& void 0!==c&&null!=c&&1==a.isPrivate)return w=s(a).getEncodedHex(),void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",w,c,d,f);var x=function(a,b){var c=y(a,b);return new k({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:c.pbkdf2Salt}},{int:c.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:c.encryptionSchemeIV}}]}]}]},{octstr:{hex:c.ciphertext}}]}).getEncodedHex()},y=function(a,b){var c=J.lib.WordArray.random(8),d=J.lib.WordArray.random(8),e=J.PBKDF2(b,c,{keySize:6,iterations:100}),f=J.enc.Hex.parse(a),g=J.TripleDES.encrypt(f,e,{iv:d})+"",h={};return h.ciphertext=g,h.pbkdf2Salt=J.enc.Hex.stringify(c),h.pbkdf2Iter=100,h.encryptionSchemeAlg="DES-EDE3-CBC",h.encryptionSchemeIV=J.enc.Hex.stringify(d),h};if("PKCS8PRV"==b&&null!=p&&a instanceof p&&1==a.isPrivate){var z=q(a).getEncodedHex();return w=k({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:z}}]}).getEncodedHex(),void 0===c||null==c?aU(w,"PRIVATE KEY"):aU(u=x(w,c),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==b&& void 0!==o&&a instanceof o&&1==a.isPrivate)return z=new k({seq:[{int:1},{octstr:{hex:a.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]}]}).getEncodedHex(),w=k({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:a.curveName}}]},{octstr:{hex:z}}]}).getEncodedHex(),void 0===c||null==c?aU(w,"PRIVATE KEY"):aU(u=x(w,c),"ENCRYPTED PRIVATE KEY");if("PKCS8PRV"==b&& void 0!==n&&a instanceof n&&1==a.isPrivate)return z=new j({bigint:a.x}).getEncodedHex(),w=k({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.g}}]}]},{octstr:{hex:z}}]}).getEncodedHex(),void 0===c||null==c?aU(w,"PRIVATE KEY"):aU(u=x(w,c),"ENCRYPTED PRIVATE KEY");throw Error("unsupported object nor format")},a7.getKeyFromCSRPEM=function(a){var b=aV(a,"CERTIFICATE REQUEST");return a7.getKeyFromCSRHex(b)},a7.getKeyFromCSRHex=function(a){var b=a7.parseCSRHex(a);return a7.getKey(b.p8pubkeyhex,null,"pkcs8pub")},a7.parseCSRHex=function(a){var b=aE,c=b.getChildIdx,d=b.getTLV,e={},f=a;if("30"!=f.substr(0,2))throw Error("malformed CSR(code:001)");var g=c(f,0);if(g.length<1)throw Error("malformed CSR(code:002)");if("30"!=f.substr(g[0],2))throw Error("malformed CSR(code:003)");var h=c(f,g[0]);if(h.length<3)throw Error("malformed CSR(code:004)");return e.p8pubkeyhex=d(f,h[2]),e},a7.getKeyID=function(a){var b=a7,c=aE;"string"==typeof a&& -1!=a.indexOf("BEGIN ")&&(a=b.getKey(a));var d=aV(b.getPEM(a)),e=c.getIdxbyList(d,0,[1]),f=c.getV(d,e).substring(2);return aB.crypto.Util.hashHex(f,"sha1")},a7.getJWKFromKey=function(a){var b,c={};if(a instanceof as&&a.isPrivate)return c.kty="RSA",c.n=aL(a.n.toString(16)),c.e=aL(a.e.toString(16)),c.d=aL(a.d.toString(16)),c.p=aL(a.p.toString(16)),c.q=aL(a.q.toString(16)),c.dp=aL(a.dmp1.toString(16)),c.dq=aL(a.dmq1.toString(16)),c.qi=aL(a.coeff.toString(16)),c;if(a instanceof as&&a.isPublic)return c.kty="RSA",c.n=aL(a.n.toString(16)),c.e=aL(a.e.toString(16)),c;if(a instanceof aB.crypto.ECDSA&&a.isPrivate){if("P-256"!==(b=a.getShortNISTPCurveName())&&"P-384"!==b)throw Error("unsupported curve name for JWT: "+b);var d=a.getPublicKeyXYHex();return c.kty="EC",c.crv=b,c.x=aL(d.x),c.y=aL(d.y),c.d=aL(a.prvKeyHex),c}if(a instanceof aB.crypto.ECDSA&&a.isPublic){if("P-256"!==(b=a.getShortNISTPCurveName())&&"P-384"!==b)throw Error("unsupported curve name for JWT: "+b);return d=a.getPublicKeyXYHex(),c.kty="EC",c.crv=b,c.x=aL(d.x),c.y=aL(d.y),c}throw Error("not supported key object")},as.getPosArrayOfChildrenFromHex=function(a){return aE.getChildIdx(a,0)},as.getHexValueArrayOfChildrenFromHex=function(a){var b,c=aE.getV,d=c(a,(b=as.getPosArrayOfChildrenFromHex(a))[0]),e=c(a,b[1]),f=c(a,b[2]),g=c(a,b[3]),h=c(a,b[4]),i=c(a,b[5]),j=c(a,b[6]),k=c(a,b[7]),l=c(a,b[8]);return(b=[]).push(d,e,f,g,h,i,j,k,l),b},as.prototype.readPrivateKeyFromPEMString=function(a){var b=aV(a),c=as.getHexValueArrayOfChildrenFromHex(b);this.setPrivateEx(c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8])},as.prototype.readPKCS5PrvKeyHex=function(a){var b=as.getHexValueArrayOfChildrenFromHex(a);this.setPrivateEx(b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8])},as.prototype.readPKCS8PrvKeyHex=function(a){var b,c,d,e,f,g,h,i,j=aE,k=j.getVbyListEx;if(!1===j.isASN1HEX(a))throw Error("not ASN.1 hex string");try{b=k(a,0,[2,0,1],"02"),c=k(a,0,[2,0,2],"02"),d=k(a,0,[2,0,3],"02"),e=k(a,0,[2,0,4],"02"),f=k(a,0,[2,0,5],"02"),g=k(a,0,[2,0,6],"02"),h=k(a,0,[2,0,7],"02"),i=k(a,0,[2,0,8],"02")}catch(l){throw Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(b,c,d,e,f,g,h,i)},as.prototype.readPKCS5PubKeyHex=function(a){var b=aE,c=b.getV;if(!1===b.isASN1HEX(a))throw Error("keyHex is not ASN.1 hex string");var d=b.getChildIdx(a,0);if(2!==d.length||"02"!==a.substr(d[0],2)||"02"!==a.substr(d[1],2))throw Error("wrong hex for PKCS#5 public key");var e=c(a,d[0]),f=c(a,d[1]);this.setPublic(e,f)},as.prototype.readPKCS8PubKeyHex=function(a){var b=aE;if(!1===b.isASN1HEX(a))throw Error("not ASN.1 hex string");if("06092a864886f70d010101"!==b.getTLVbyListEx(a,0,[0,0]))throw Error("not PKCS8 RSA public key");var c=b.getTLVbyListEx(a,0,[1,0]);this.readPKCS5PubKeyHex(c)},as.prototype.readCertPubKeyHex=function(a,b){var c,d;(c=new bb).readCertHex(a),d=c.getPublicKeyHex(),this.readPKCS8PubKeyHex(d)},RegExp("[^0-9a-f]","gi"),as.prototype.sign=function(a,b){var c,d=(c=a,aB.crypto.Util.hashString(c,b));return this.signWithMessageHash(d,b)},as.prototype.signWithMessageHash=function(a,b){var c=aq(aB.crypto.Util.getPaddedDigestInfoHex(a,b,this.n.bitLength()),16);return a8(this.doPrivate(c).toString(16),this.n.bitLength())},as.prototype.signPSS=function(a,b,c){var d,e=(d=aQ(a),aB.crypto.Util.hashHex(d,b));return void 0===c&&(c=-1),this.signWithMessageHashPSS(e,b,c)},as.prototype.signWithMessageHashPSS=function(a,b,c){var d,e=aP(a),f=e.length,g=this.n.bitLength()-1,h=Math.ceil(g/8),i=function(a){return aB.crypto.Util.hashHex(a,b)};if(-1===c|| void 0===c)c=f;else if(-2===c)c=h-f-2;else if(c< -2)throw Error("invalid salt length");if(h<f+c+2)throw Error("data too long");var j="";c>0&&(j=Array(c),(new ap).nextBytes(j),j=String.fromCharCode.apply(String,j));var k=aP(i(aQ("\0\0\0\0\0\0\0\0"+e+j))),l=[];for(d=0;d<h-c-f-2;d+=1)l[d]=0;var m=String.fromCharCode.apply(String,l)+"\x01"+j,n=a9(k,m.length,i),o=[];for(d=0;d<m.length;d+=1)o[d]=m.charCodeAt(d)^n.charCodeAt(d);var p=65280>>8*h-g&255;for(o[0]&=~p,d=0;d<f;d++)o.push(k.charCodeAt(d));return o.push(188),a8(this.doPrivate(new P(o)).toString(16),this.n.bitLength())},as.prototype.verify=function(a,b){if(null==(b=b.toLowerCase()).match(/^[0-9a-f]+$/))return!1;var c=aq(b,16),d=this.n.bitLength();if(c.bitLength()>d)return!1;var e=this.doPublic(c).toString(16);if(e.length+3!=d/4)return!1;var f=ba(e.replace(/^1f+00/,""));if(0==f.length)return!1;var g,h=f[0];return f[1]==(g=a,aB.crypto.Util.hashString(g,h))},as.prototype.verifyWithMessageHash=function(a,b){if(b.length!=Math.ceil(this.n.bitLength()/4))return!1;var c=aq(b,16);if(c.bitLength()>this.n.bitLength())return 0;var d=ba(this.doPublic(c).toString(16).replace(/^1f+00/,""));return 0!=d.length&&(d[0],d[1]==a)},as.prototype.verifyPSS=function(a,b,c,d){var e,f=(e=aQ(a),aB.crypto.Util.hashHex(e,c));return void 0===d&&(d=-1),this.verifyWithMessageHashPSS(f,b,c,d)},as.prototype.verifyWithMessageHashPSS=function(a,b,c,d){if(b.length!=Math.ceil(this.n.bitLength()/4))return!1;var e,f=new P(b,16),g=function(a){return aB.crypto.Util.hashHex(a,c)},h=aP(a),i=h.length,j=this.n.bitLength()-1,k=Math.ceil(j/8);if(-1===d|| void 0===d)d=i;else if(-2===d)d=k-i-2;else if(d< -2)throw Error("invalid salt length");if(k<i+d+2)throw Error("data too long");var l=this.doPublic(f).toByteArray();for(e=0;e<l.length;e+=1)l[e]&=255;for(;l.length<k;)l.unshift(0);if(188!==l[k-1])throw Error("encoded message does not end in 0xbc");var m=(l=String.fromCharCode.apply(String,l)).substr(0,k-i-1),n=l.substr(m.length,i),o=65280>>8*k-j&255;if(0!=(m.charCodeAt(0)&o))throw Error("bits beyond keysize not zero");var p=a9(n,m.length,g),q=[];for(e=0;e<m.length;e+=1)q[e]=m.charCodeAt(e)^p.charCodeAt(e);q[0]&=~o;var r=k-i-d-2;for(e=0;e<r;e+=1)if(0!==q[e])throw Error("leftmost octets not zero");if(1!==q[r])throw Error("0x01 marker not found");return n===aP(g(aQ("\0\0\0\0\0\0\0\0"+h+String.fromCharCode.apply(String,q.slice(-d)))))},as.SALT_LEN_HLEN=-1,as.SALT_LEN_MAX=-2,as.SALT_LEN_RECOVER=-2,bb.hex2dn=function(a,b){void 0===b&&(b=0);var c=new bb;return aE.getTLV(a,b),c.getX500Name(a).str},bb.hex2rdn=function(a,b){if(void 0===b&&(b=0),"31"!==a.substr(b,2))throw Error("malformed RDN");for(var c=[],d=aE.getChildIdx(a,b),e=0;e<d.length;e++)c.push(bb.hex2attrTypeValue(a,d[e]));return(c=c.map(function(a){return a.replace("+","\\+")})).join("+")},bb.hex2attrTypeValue=function(a,b){var c=aE,d=c.getV;if(void 0===b&&(b=0),"30"!==a.substr(b,2))throw Error("malformed attribute type and value");var e=c.getChildIdx(a,b);2!==e.length||a.substr(e[0],2);var f=d(a,e[0]),g=aB.asn1.ASN1Util.oidHexToInt(f);return aB.asn1.x509.OID.oid2atype(g)+"="+aP(d(a,e[1]))},bb.getPublicKeyFromCertHex=function(a){var b=new bb;return b.readCertHex(a),b.getPublicKey()},bb.getPublicKeyFromCertPEM=function(a){var b=new bb;return b.readCertPEM(a),b.getPublicKey()},bb.getPublicKeyInfoPropOfCertPEM=function(a){var b,c,d=aE.getVbyList,e={};return e.algparam=null,(b=new bb).readCertPEM(a),c=b.getPublicKeyHex(),e.keyhex=d(c,0,[1],"03").substr(2),e.algoid=d(c,0,[0,0],"06"),"2a8648ce3d0201"===e.algoid&&(e.algparam=d(c,0,[0,1],"06")),e},bb.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],void 0!==aB&&aB||(b.KJUR=aB={}),void 0!==aB.jws&&aB.jws||(aB.jws={}),aB.jws.JWS=function(){var a=aB.jws.JWS.isSafeJSONString;this.parseJWS=function(b,c){if(void 0===this.parsedJWS|| !c&& void 0===this.parsedJWS.sigvalH){var d=b.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==d)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var e=d[1],f=d[2],g=d[3],h=e+"."+f;if(this.parsedJWS={},this.parsedJWS.headB64U=e,this.parsedJWS.payloadB64U=f,this.parsedJWS.sigvalB64U=g,this.parsedJWS.si=h,!c){var i=aM(g),j=aq(i,16);this.parsedJWS.sigvalH=i,this.parsedJWS.sigvalBI=j}var k=aD(e),l=aD(f);if(this.parsedJWS.headS=k,this.parsedJWS.payloadS=l,!a(k,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+k}}},aB.jws.JWS.sign=function(a,b,c,d,e){var f,g,h,i,j=aB,k=j.jws.JWS,l=k.readSafeJSONString,m=k.isSafeJSONString,n=j.crypto,o=(n.ECDSA,n.Mac),p=n.Signature,q=JSON;if("string"!=typeof b&&"object"!=(void 0===b?"undefined":G(b)))throw"spHeader must be JSON string or object: "+b;if("object"==(void 0===b?"undefined":G(b))&&(h=b,g=q.stringify(h)),"string"==typeof b){if(!m(g=b))throw"JWS Head is not safe JSON string: "+g;h=l(g)}if(i=c,"object"==(void 0===c?"undefined":G(c))&&(i=q.stringify(c)),""!=a&&null!=a|| void 0===h.alg||(a=h.alg),""!=a&&null!=a&& void 0===h.alg&&(h.alg=a,g=q.stringify(h)),a!==h.alg)throw"alg and sHeader.alg doesn't match: "+a+"!="+h.alg;var r=null;if(void 0===k.jwsalg2sigalg[a])throw"unsupported alg name: "+a;r=k.jwsalg2sigalg[a];var s=aC(g)+"."+aC(i),t="";if("Hmac"==r.substr(0,4)){if(void 0===d)throw"mac key shall be specified for HS* alg";var u=new o({alg:r,prov:"cryptojs",pass:d});u.updateString(s),t=u.doFinal()}else if(-1!=r.indexOf("withECDSA")){(f=new p({alg:r})).init(d,e),f.updateString(s);var v=f.sign();t=aB.crypto.ECDSA.asn1SigToConcatSig(v)}else"none"!=r&&((f=new p({alg:r})).init(d,e),f.updateString(s),t=f.sign());return s+"."+aL(t)},aB.jws.JWS.verify=function(a,b,c){var d,e=aB,f=e.jws.JWS,g=f.readSafeJSONString,h=e.crypto,i=h.ECDSA,j=h.Mac,k=h.Signature;void 0!==G(as)&&(d=as);var l=a.split(".");if(3!==l.length)return!1;var m=l[0]+"."+l[1],n=aM(l[2]),o=g(aD(l[0])),p=null,q=null;if(void 0===o.alg)throw"algorithm not specified in header";if(q=(p=o.alg).substr(0,2),null!=c&&"[object Array]"===Object.prototype.toString.call(c)&&c.length>0&& -1==(":"+c.join(":")+":").indexOf(":"+p+":"))throw"algorithm '"+p+"' not accepted in the list";if("none"!=p&&null===b)throw"key shall be specified to verify.";if("string"==typeof b&& -1!=b.indexOf("-----BEGIN ")&&(b=a7.getKey(b)),!("RS"!=q&&"PS"!=q||b instanceof d))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==q&&!(b instanceof i))throw"key shall be a ECDSA obj for ES* algs";var r=null;if(void 0===f.jwsalg2sigalg[o.alg])throw"unsupported alg name: "+p;if("none"==(r=f.jwsalg2sigalg[p]))throw"not supported";if("Hmac"==r.substr(0,4)){if(void 0===b)throw"hexadecimal key shall be specified for HMAC";var s=new j({alg:r,pass:b});return s.updateString(m),n==s.doFinal()}if(-1!=r.indexOf("withECDSA")){var t,u=null;try{u=i.concatSigToASN1Sig(n)}catch(v){return!1}return(t=new k({alg:r})).init(b),t.updateString(m),t.verify(u)}return(t=new k({alg:r})).init(b),t.updateString(m),t.verify(n)},aB.jws.JWS.parse=function(a){var b,c,d,e=a.split("."),f={};if(2!=e.length&&3!=e.length)throw"malformed sJWS: wrong number of '.' splitted elements";return b=e[0],c=e[1],3==e.length&&(d=e[2]),f.headerObj=aB.jws.JWS.readSafeJSONString(aD(b)),f.payloadObj=aB.jws.JWS.readSafeJSONString(aD(c)),f.headerPP=JSON.stringify(f.headerObj,null,"  "),null==f.payloadObj?f.payloadPP=aD(c):f.payloadPP=JSON.stringify(f.payloadObj,null,"  "),void 0!==d&&(f.sigHex=aM(d)),f},aB.jws.JWS.verifyJWT=function(a,b,c){var d=aB.jws,e=d.JWS,f=e.readSafeJSONString,g=e.inArray,h=e.includedArray,i=a.split("."),j=i[0],k=i[1],l=(aM(i[2]),f(aD(j))),m=f(aD(k));if(void 0===l.alg)return!1;if(void 0===c.alg)throw"acceptField.alg shall be specified";if(!g(l.alg,c.alg)|| void 0!==m.iss&&"object"===G(c.iss)&&!g(m.iss,c.iss)|| void 0!==m.sub&&"object"===G(c.sub)&&!g(m.sub,c.sub))return!1;if(void 0!==m.aud&&"object"===G(c.aud)){if("string"==typeof m.aud){if(!g(m.aud,c.aud))return!1}else if("object"==G(m.aud)&&!h(m.aud,c.aud))return!1}var n=d.IntDate.getNow();return void 0!==c.verifyAt&&"number"==typeof c.verifyAt&&(n=c.verifyAt),void 0!==c.gracePeriod&&"number"==typeof c.gracePeriod||(c.gracePeriod=0),!(void 0!==m.exp&&"number"==typeof m.exp&&m.exp+c.gracePeriod<n)&& !(void 0!==m.nbf&&"number"==typeof m.nbf&&n<m.nbf-c.gracePeriod)&&!(void 0!==m.iat&&"number"==typeof m.iat&&n<m.iat-c.gracePeriod)&&(void 0===m.jti|| void 0===c.jti||m.jti===c.jti)&&!!e.verify(a,b,c.alg)},aB.jws.JWS.includedArray=function(a,b){var c=aB.jws.JWS.inArray;if(null===a||"object"!==(void 0===a?"undefined":G(a))||"number"!=typeof a.length)return!1;for(var d=0;d<a.length;d++)if(!c(a[d],b))return!1;return!0},aB.jws.JWS.inArray=function(a,b){if(null===b||"object"!==(void 0===b?"undefined":G(b))||"number"!=typeof b.length)return!1;for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1},aB.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},aB.jws.JWS.isSafeJSONString=function(a,b,c){var d=null;try{return"object"!=(void 0===(d=aw(a))?"undefined":G(d))||d.constructor===Array?0:(b&&(b[c]=d),1)}catch(e){return 0}},aB.jws.JWS.readSafeJSONString=function(a){var b=null;try{return"object"!=(void 0===(b=aw(a))?"undefined":G(b))||b.constructor===Array?null:b}catch(c){return null}},aB.jws.JWS.getEncodedSignatureValueFromJWS=function(a){var b=a.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==b)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return b[1]},aB.jws.JWS.getJWKthumbprint=function(a){if("RSA"!==a.kty&&"EC"!==a.kty&&"oct"!==a.kty)throw"unsupported algorithm for JWK Thumprint";var b="{";if("RSA"===a.kty){if("string"!=typeof a.n||"string"!=typeof a.e)throw"wrong n and e value for RSA key";b+='"e":"'+a.e+'",',b+='"kty":"'+a.kty+'",',b+='"n":"'+a.n+'"}'}else if("EC"===a.kty){if("string"!=typeof a.crv||"string"!=typeof a.x||"string"!=typeof a.y)throw"wrong crv, x and y value for EC key";b+='"crv":"'+a.crv+'",',b+='"kty":"'+a.kty+'",',b+='"x":"'+a.x+'",',b+='"y":"'+a.y+'"}'}else if("oct"===a.kty){if("string"!=typeof a.k)throw"wrong k value for oct(symmetric) key";b+='"kty":"'+a.kty+'",',b+='"k":"'+a.k+'"}'}var c=aQ(b);return aL(aB.crypto.Util.hashHex(c,"sha256"))},aB.jws.IntDate={},aB.jws.IntDate.get=function(a){var b=aB.jws.IntDate,c=b.getNow,d=b.getZulu;if("now"==a)return c();if("now + 1hour"==a)return c()+3600;if("now + 1day"==a)return c()+86400;if("now + 1month"==a)return c()+2592e3;if("now + 1year"==a)return c()+31536e3;if(a.match(/Z$/))return d(a);if(a.match(/^[0-9]+$/))return parseInt(a);throw"unsupported format: "+a},aB.jws.IntDate.getZulu=function(a){return aX(a)},aB.jws.IntDate.getNow=function(){return~~(new Date/1e3)},aB.jws.IntDate.intDate2UTCString=function(a){return new Date(1e3*a).toUTCString()},aB.jws.IntDate.intDate2Zulu=function(a){var b=new Date(1e3*a);return("0000"+b.getUTCFullYear()).slice(-4)+("00"+(b.getUTCMonth()+1)).slice(-2)+("00"+b.getUTCDate()).slice(-2)+("00"+b.getUTCHours()).slice(-2)+("00"+b.getUTCMinutes()).slice(-2)+("00"+b.getUTCSeconds()).slice(-2)+"Z"},b.SecureRandom=ap,b.rng_seed_time=ak,b.BigInteger=P,b.RSAKey=as;var bc=aB.crypto.EDSA;b.EDSA=bc;var bd=aB.crypto.DSA;b.DSA=bd;var be=aB.crypto.Signature;b.Signature=be;var bf=aB.crypto.MessageDigest;b.MessageDigest=bf;var bg=aB.crypto.Mac;b.Mac=bg;var bh=aB.crypto.Cipher;b.Cipher=bh,b.KEYUTIL=a7,b.ASN1HEX=aE,b.X509=bb,b.CryptoJS=J,b.b64tohex=N,b.b64toBA=O,b.stoBA=aF,b.BAtos=aG,b.BAtohex=aH,b.stohex=aI,b.stob64=function(a){return M(aI(a))},b.stob64u=function(a){return aJ(M(aI(a)))},b.b64utos=function(a){return aG(O(aK(a)))},b.b64tob64u=aJ,b.b64utob64=aK,b.hex2b64=M,b.hextob64u=aL,b.b64utohex=aM,b.utf8tob64u=aC,b.b64utoutf8=aD,b.utf8tob64=function(a){return M(aY(a2(a)))},b.b64toutf8=function(a){return decodeURIComponent(aZ(N(a)))},b.utf8tohex=aN,b.hextoutf8=aO,b.hextorstr=aP,b.rstrtohex=aQ,b.hextob64=aR,b.hextob64nl=aS,b.b64nltohex=aT,b.hextopem=aU,b.pemtohex=aV,b.hextoArrayBuffer=function(a){if(a.length%2!=0)throw"input is not even length";if(null==a.match(/^[0-9A-Fa-f]+$/))throw"input is not hexadecimal";for(var b=new ArrayBuffer(a.length/2),c=new DataView(b),d=0;d<a.length/2;d++)c.setUint8(d,parseInt(a.substr(2*d,2),16));return b},b.ArrayBuffertohex=function(a){for(var b="",c=new DataView(a),d=0;d<a.byteLength;d++)b+=("00"+c.getUint8(d).toString(16)).slice(-2);return b},b.zulutomsec=aW,b.zulutosec=aX,b.zulutodate=function(a){return new Date(aW(a))},b.datetozulu=function(a,b,c){var d,e=a.getUTCFullYear();if(b){if(e<1950||2049<e)throw"not proper year for UTCTime: "+e;d=(""+e).slice(-2)}else d=("000"+e).slice(-4);if(d+=("0"+(a.getUTCMonth()+1)).slice(-2),d+=("0"+a.getUTCDate()).slice(-2),d+=("0"+a.getUTCHours()).slice(-2),d+=("0"+a.getUTCMinutes()).slice(-2),d+=("0"+a.getUTCSeconds()).slice(-2),c){var f=a.getUTCMilliseconds();0!==f&&(d+="."+(f=(f=("00"+f).slice(-3)).replace(/0+$/g,"")))}return d+"Z"},b.uricmptohex=aY,b.hextouricmp=aZ,b.ipv6tohex=a$,b.hextoipv6=a_,b.hextoip=a0,b.iptohex=function(a){var b="malformed IP address";if(!(a=a.toLowerCase(a)).match(/^[0-9.]+$/)){if(a.match(/^[0-9a-f:]+$/)&& -1!==a.indexOf(":"))return a$(a);throw b}var c=a.split(".");if(4!==c.length)throw b;var d="";try{for(var e=0;e<4;e++)d+=("0"+parseInt(c[e]).toString(16)).slice(-2);return d}catch(f){throw b}},b.encodeURIComponentAll=a2,b.newline_toUnix=function(a){return a=a.replace(/\r\n/gm,"\n")},b.newline_toDos=function(a){return a=(a=a.replace(/\r\n/gm,"\n")).replace(/\n/gm,"\r\n")},b.hextoposhex=a4,b.intarystrtohex=function(a){a=(a=(a=a.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return a.split(/,/).map(function(a,b,c){var d=parseInt(a);if(d<0||255<d)throw"integer not in range 0-255";return("00"+d.toString(16)).slice(-2)}).join("")}catch(b){throw"malformed integer array string: "+b}},b.strdiffidx=function(a,b){var c=a.length;a.length>b.length&&(c=b.length);for(var d=0;d<c;d++)if(a.charCodeAt(d)!=b.charCodeAt(d))return d;return a.length!=b.length?c:-1},b.KJUR=aB;var bi=aB.crypto;b.crypto=bi;var bj=aB.asn1;b.asn1=bj;var bk=aB.jws;b.jws=bk;var bl=aB.lang;b.lang=bl}).call(this,c(28).Buffer)},function(a,b,c){"use strict";(function(a){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */ var d=c(30),e=c(31),f=c(32);function g(){return i.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function h(a,b){if(g()<b)throw RangeError("Invalid typed array length");return i.TYPED_ARRAY_SUPPORT?(a=new Uint8Array(b)).__proto__=i.prototype:(null===a&&(a=new i(b)),a.length=b),a}function i(a,b,c){if(!(i.TYPED_ARRAY_SUPPORT||this instanceof i))return new i(a,b,c);if("number"==typeof a){if("string"==typeof b)throw Error("If encoding is specified then the first argument must be a string");return l(this,a)}return j(this,a,b,c)}function j(a,b,c,d){if("number"==typeof b)throw TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&b instanceof ArrayBuffer?function(a,b,c,d){if(b.byteLength,c<0||b.byteLength<c)throw RangeError("'offset' is out of bounds");if(b.byteLength<c+(d||0))throw RangeError("'length' is out of bounds");return b=void 0===c&& void 0===d?new Uint8Array(b):void 0===d?new Uint8Array(b,c):new Uint8Array(b,c,d),i.TYPED_ARRAY_SUPPORT?(a=b).__proto__=i.prototype:a=m(a,b),a}(a,b,c,d):"string"==typeof b?function(a,b,c){if("string"==typeof c&&""!==c||(c="utf8"),!i.isEncoding(c))throw TypeError('"encoding" must be a valid string encoding');var d=0|o(b,c),e=(a=h(a,d)).write(b,c);return e!==d&&(a=a.slice(0,e)),a}(a,b,c):function(a,b){if(i.isBuffer(b)){var c,d=0|n(b.length);return 0===(a=h(a,d)).length||b.copy(a,0,0,d),a}if(b){if("undefined"!=typeof ArrayBuffer&&b.buffer instanceof ArrayBuffer||"length"in b)return"number"!=typeof b.length||(c=b.length)!=c?h(a,0):m(a,b);if("Buffer"===b.type&&f(b.data))return m(a,b.data)}throw TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(a,b)}function k(a){if("number"!=typeof a)throw TypeError('"size" argument must be a number');if(a<0)throw RangeError('"size" argument must not be negative')}function l(a,b){if(k(b),a=h(a,b<0?0:0|n(b)),!i.TYPED_ARRAY_SUPPORT)for(var c=0;c<b;++c)a[c]=0;return a}function m(a,b){var c=b.length<0?0:0|n(b.length);a=h(a,c);for(var d=0;d<c;d+=1)a[d]=255&b[d];return a}function n(a){if(a>=g())throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+g().toString(16)+" bytes");return 0|a}function o(a,b){if(i.isBuffer(a))return a.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(a)||a instanceof ArrayBuffer))return a.byteLength;"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":case void 0:return O(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return P(a).length;default:if(d)return O(a).length;b=(""+b).toLowerCase(),d=!0}}function p(a,b,c){var d=!1;if((void 0===b||b<0)&&(b=0),b>this.length||((void 0===c||c>this.length)&&(c=this.length),c<=0)||(c>>>=0)<=(b>>>=0))return"";for(a||(a="utf8");;)switch(a){case"hex":return D(this,b,c);case"utf8":case"utf-8":return z(this,b,c);case"ascii":return B(this,b,c);case"latin1":case"binary":return C(this,b,c);case"base64":return y(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,b,c);default:if(d)throw TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function q(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function r(a,b,c,d,e){if(0===a.length)return -1;if("string"==typeof c?(d=c,c=0):c>2147483647?c=2147483647:c< -2147483648&&(c=-2147483648),isNaN(c=+c)&&(c=e?0:a.length-1),c<0&&(c=a.length+c),c>=a.length){if(e)return -1;c=a.length-1}else if(c<0){if(!e)return -1;c=0}if("string"==typeof b&&(b=i.from(b,d)),i.isBuffer(b))return 0===b.length?-1:s(a,b,c,d,e);if("number"==typeof b)return b&=255,i.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?e?Uint8Array.prototype.indexOf.call(a,b,c):Uint8Array.prototype.lastIndexOf.call(a,b,c):s(a,[b],c,d,e);throw TypeError("val must be string, number or Buffer")}function s(a,b,c,d,e){var f,g=1,h=a.length,i=b.length;if(void 0!==d&&("ucs2"===(d=String(d).toLowerCase())||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(a.length<2||b.length<2)return -1;g=2,h/=2,i/=2,c/=2}function j(a,b){return 1===g?a[b]:a.readUInt16BE(b*g)}if(e){var k=-1;for(f=c;f<h;f++)if(j(a,f)===j(b,-1===k?0:f-k)){if(-1===k&&(k=f),f-k+1===i)return k*g}else -1!==k&&(f-=f-k),k=-1}else for(c+i>h&&(c=h-i),f=c;f>=0;f--){for(var l=!0,m=0;m<i;m++)if(j(a,f+m)!==j(b,m)){l=!1;break}if(l)return f}return -1}function t(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d))>e&&(d=e):d=e;var f=b.length;if(f%2!=0)throw TypeError("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;g<d;++g){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))break;a[c+g]=h}return g}function u(a,b,c,d){return Q(O(b,a.length-c),a,c,d)}function v(a,b,c,d){return Q(function(a){for(var b=[],c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));return b}(b),a,c,d)}function w(a,b,c,d){return Q(P(b),a,c,d)}function x(a,b,c,d){return Q(function(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);++g)d=(c=a.charCodeAt(g))>>8,e=c%256,f.push(e),f.push(d);return f}(b,a.length-c),a,c,d)}function y(a,b,c){return 0===b&&c===a.length?d.fromByteArray(a):d.fromByteArray(a.slice(b,c))}function z(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;e<c;){var f,g,h,i,j=a[e],k=null,l=j>239?4:j>223?3:j>191?2:1;if(e+l<=c)switch(l){case 1:j<128&&(k=j);break;case 2:128==(192&(f=a[e+1]))&&(i=(31&j)<<6|63&f)>127&&(k=i);break;case 3:f=a[e+1],g=a[e+2],128==(192&f)&&128==(192&g)&&(i=(15&j)<<12|(63&f)<<6|63&g)>2047&&(i<55296||i>57343)&&(k=i);break;case 4:f=a[e+1],g=a[e+2],h=a[e+3],128==(192&f)&&128==(192&g)&&128==(192&h)&&(i=(15&j)<<18|(63&f)<<12|(63&g)<<6|63&h)>65535&&i<1114112&&(k=i)}null===k?(k=65533,l=1):k>65535&&(k-=65536,d.push(k>>>10&1023|55296),k=56320|1023&k),d.push(k),e+=l}return function(a){var b=a.length;if(b<=A)return String.fromCharCode.apply(String,a);for(var c="",d=0;d<b;)c+=String.fromCharCode.apply(String,a.slice(d,d+=A));return c}(d)}b.Buffer=i,b.SlowBuffer=function(a){return+a!=a&&(a=0),i.alloc(+a)},b.INSPECT_MAX_BYTES=50,i.TYPED_ARRAY_SUPPORT=void 0!==a.TYPED_ARRAY_SUPPORT?a.TYPED_ARRAY_SUPPORT:function(){try{var a=new Uint8Array(1);return a.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===a.foo()&&"function"==typeof a.subarray&&0===a.subarray(1,1).byteLength}catch(b){return!1}}(),b.kMaxLength=g(),i.poolSize=8192,i._augment=function(a){return a.__proto__=i.prototype,a},i.from=function(a,b,c){return j(null,a,b,c)},i.TYPED_ARRAY_SUPPORT&&(i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0})),i.alloc=function(a,b,c){var d,e,f,g;return d=null,e=a,f=b,g=c,k(e),e<=0?h(d,e):void 0!==f?"string"==typeof g?h(d,e).fill(f,g):h(d,e).fill(f):h(d,e)},i.allocUnsafe=function(a){return l(null,a)},i.allocUnsafeSlow=function(a){return l(null,a)},i.isBuffer=function(a){return!(null==a||!a._isBuffer)},i.compare=function(a,b){if(!i.isBuffer(a)||!i.isBuffer(b))throw TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,f=Math.min(c,d);e<f;++e)if(a[e]!==b[e]){c=a[e],d=b[e];break}return c<d?-1:d<c?1:0},i.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(a,b){if(!f(a))throw TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return i.alloc(0);if(void 0===b)for(b=0,c=0;c<a.length;++c)b+=a[c].length;var c,d=i.allocUnsafe(b),e=0;for(c=0;c<a.length;++c){var g=a[c];if(!i.isBuffer(g))throw TypeError('"list" argument must be an Array of Buffers');g.copy(d,e),e+=g.length}return d},i.byteLength=o,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var a=this.length;if(a%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var b=0;b<a;b+=2)q(this,b,b+1);return this},i.prototype.swap32=function(){var a=this.length;if(a%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;b<a;b+=4)q(this,b,b+3),q(this,b+1,b+2);return this},i.prototype.swap64=function(){var a=this.length;if(a%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;b<a;b+=8)q(this,b,b+7),q(this,b+1,b+6),q(this,b+2,b+5),q(this,b+3,b+4);return this},i.prototype.toString=function(){var a=0|this.length;return 0===a?"":0===arguments.length?z(this,0,a):p.apply(this,arguments)},i.prototype.equals=function(a){if(!i.isBuffer(a))throw TypeError("Argument must be a Buffer");return this===a||0===i.compare(this,a)},i.prototype.inspect=function(){var a="",c=b.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,c).match(/.{2}/g).join(" "),this.length>c&&(a+=" ... ")),"<Buffer "+a+">"},i.prototype.compare=function(a,b,c,d,e){if(!i.isBuffer(a))throw TypeError("Argument must be a Buffer");if(void 0===b&&(b=0),void 0===c&&(c=a?a.length:0),void 0===d&&(d=0),void 0===e&&(e=this.length),b<0||c>a.length||d<0||e>this.length)throw RangeError("out of range index");if(d>=e&&b>=c)return 0;if(d>=e)return -1;if(b>=c)return 1;if(this===a)return 0;for(var f=(e>>>=0)-(d>>>=0),g=(c>>>=0)-(b>>>=0),h=Math.min(f,g),j=this.slice(d,e),k=a.slice(b,c),l=0;l<h;++l)if(j[l]!==k[l]){f=j[l],g=k[l];break}return f<g?-1:g<f?1:0},i.prototype.includes=function(a,b,c){return -1!==this.indexOf(a,b,c)},i.prototype.indexOf=function(a,b,c){return r(this,a,b,c,!0)},i.prototype.lastIndexOf=function(a,b,c){return r(this,a,b,c,!1)},i.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else{if(!isFinite(b))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");b|=0,isFinite(c)?(c|=0,void 0===d&&(d="utf8")):(d=c,c=void 0)}var e,f,g,h,i=this.length-b;if((void 0===c||c>i)&&(c=i),a.length>0&&(c<0||b<0)||b>this.length)throw RangeError("Attempt to write outside buffer bounds");d||(d="utf8");for(var j=!1;;)switch(d){case"hex":return t(this,a,b,c);case"utf8":case"utf-8":return u(this,a,b,c);case"ascii":return v(this,a,b,c);case"latin1":case"binary":return e=this,f=a,g=b,v(e,f,g,h=c);case"base64":return w(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,a,b,c);default:if(j)throw TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),j=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function B(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(127&a[e]);return d}function C(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(a[e]);return d}function D(a,b,c){var d=a.length;(!b||b<0)&&(b=0),(!c||c<0||c>d)&&(c=d);for(var e="",f=b;f<c;++f)e+=N(a[f]);return e}function E(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function F(a,b,c){if(a%1!=0||a<0)throw RangeError("offset is not uint");if(a+b>c)throw RangeError("Trying to access beyond buffer length")}function G(a,b,c,d,e,f){if(!i.isBuffer(a))throw TypeError('"buffer" argument must be a Buffer instance');if(b>e||b<f)throw RangeError('"value" argument is out of bounds');if(c+d>a.length)throw RangeError("Index out of range")}function H(a,b,c,d){b<0&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);e<f;++e)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function I(a,b,c,d){b<0&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);e<f;++e)a[c+e]=b>>>8*(d?e:3-e)&255}function J(a,b,c,d,e,f){if(c+d>a.length||c<0)throw RangeError("Index out of range")}function K(a,b,c,d,f){return f||J(a,0,c,4),e.write(a,b,c,d,23,4),c+4}function L(a,b,c,d,f){return f||J(a,0,c,8),e.write(a,b,c,d,52,8),c+8}i.prototype.slice=function(a,b){var c,d=this.length;if((a=~~a)<0?(a+=d)<0&&(a=0):a>d&&(a=d),(b=void 0===b?d:~~b)<0?(b+=d)<0&&(b=0):b>d&&(b=d),b<a&&(b=a),i.TYPED_ARRAY_SUPPORT)(c=this.subarray(a,b)).__proto__=i.prototype;else{var e=b-a;c=new i(e,void 0);for(var f=0;f<e;++f)c[f]=this[f+a]}return c},i.prototype.readUIntLE=function(a,b,c){a|=0,b|=0,c||F(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},i.prototype.readUIntBE=function(a,b,c){a|=0,b|=0,c||F(a,b,this.length);for(var d=this[a+ --b],e=1;b>0&&(e*=256);)d+=this[a+ --b]*e;return d},i.prototype.readUInt8=function(a,b){return b||F(a,1,this.length),this[a]},i.prototype.readUInt16LE=function(a,b){return b||F(a,2,this.length),this[a]|this[a+1]<<8},i.prototype.readUInt16BE=function(a,b){return b||F(a,2,this.length),this[a]<<8|this[a+1]},i.prototype.readUInt32LE=function(a,b){return b||F(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},i.prototype.readUInt32BE=function(a,b){return b||F(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},i.prototype.readIntLE=function(a,b,c){a|=0,b|=0,c||F(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d>=(e*=128)&&(d-=Math.pow(2,8*b)),d},i.prototype.readIntBE=function(a,b,c){a|=0,b|=0,c||F(a,b,this.length);for(var d=b,e=1,f=this[a+ --d];d>0&&(e*=256);)f+=this[a+ --d]*e;return f>=(e*=128)&&(f-=Math.pow(2,8*b)),f},i.prototype.readInt8=function(a,b){return b||F(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},i.prototype.readInt16LE=function(a,b){b||F(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},i.prototype.readInt16BE=function(a,b){b||F(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},i.prototype.readInt32LE=function(a,b){return b||F(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},i.prototype.readInt32BE=function(a,b){return b||F(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},i.prototype.readFloatLE=function(a,b){return b||F(a,4,this.length),e.read(this,a,!0,23,4)},i.prototype.readFloatBE=function(a,b){return b||F(a,4,this.length),e.read(this,a,!1,23,4)},i.prototype.readDoubleLE=function(a,b){return b||F(a,8,this.length),e.read(this,a,!0,52,8)},i.prototype.readDoubleBE=function(a,b){return b||F(a,8,this.length),e.read(this,a,!1,52,8)},i.prototype.writeUIntLE=function(a,b,c,d){a=+a,b|=0,c|=0,d||G(this,a,b,c,Math.pow(2,8*c)-1,0);var e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c},i.prototype.writeUIntBE=function(a,b,c,d){a=+a,b|=0,c|=0,d||G(this,a,b,c,Math.pow(2,8*c)-1,0);var e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f&255;return b+c},i.prototype.writeUInt8=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,1,255,0),i.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=255&a,b+1},i.prototype.writeUInt16LE=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,2,65535,0),i.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):H(this,a,b,!0),b+2},i.prototype.writeUInt16BE=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,2,65535,0),i.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):H(this,a,b,!1),b+2},i.prototype.writeUInt32LE=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,4,4294967295,0),i.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a):I(this,a,b,!0),b+4},i.prototype.writeUInt32BE=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,4,4294967295,0),i.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):I(this,a,b,!1),b+4},i.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b|=0,!d){var e=Math.pow(2,8*c-1);G(this,a,b,c,e-1,-e)}var f=0,g=1,h=0;for(this[b]=255&a;++f<c&&(g*=256);)a<0&&0===h&&0!==this[b+f-1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},i.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b|=0,!d){var e=Math.pow(2,8*c-1);G(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0;for(this[b+f]=255&a;--f>=0&&(g*=256);)a<0&&0===h&&0!==this[b+f+1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},i.prototype.writeInt8=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,1,127,-128),i.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),a<0&&(a=255+a+1),this[b]=255&a,b+1},i.prototype.writeInt16LE=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,2,32767,-32768),i.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):H(this,a,b,!0),b+2},i.prototype.writeInt16BE=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,2,32767,-32768),i.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):H(this,a,b,!1),b+2},i.prototype.writeInt32LE=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,4,2147483647,-2147483648),i.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):I(this,a,b,!0),b+4},i.prototype.writeInt32BE=function(a,b,c){return a=+a,b|=0,c||G(this,a,b,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),i.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):I(this,a,b,!1),b+4},i.prototype.writeFloatLE=function(a,b,c){return K(this,a,b,!0,c)},i.prototype.writeFloatBE=function(a,b,c){return K(this,a,b,!1,c)},i.prototype.writeDoubleLE=function(a,b,c){return L(this,a,b,!0,c)},i.prototype.writeDoubleBE=function(a,b,c){return L(this,a,b,!1,c)},i.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&d<c&&(d=c),d===c||0===a.length||0===this.length)return 0;if(b<0)throw RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw RangeError("sourceStart out of bounds");if(d<0)throw RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,f=d-c;if(this===a&&c<b&&b<d)for(e=f-1;e>=0;--e)a[e+b]=this[e+c];else if(f<1e3||!i.TYPED_ARRAY_SUPPORT)for(e=0;e<f;++e)a[e+b]=this[e+c];else Uint8Array.prototype.set.call(a,this.subarray(c,c+f),b);return f},i.prototype.fill=function(a,b,c,d){if("string"==typeof a){if("string"==typeof b?(d=b,b=0,c=this.length):"string"==typeof c&&(d=c,c=this.length),1===a.length){var e,f=a.charCodeAt(0);f<256&&(a=f)}if(void 0!==d&&"string"!=typeof d)throw TypeError("encoding must be a string");if("string"==typeof d&&!i.isEncoding(d))throw TypeError("Unknown encoding: "+d)}else"number"==typeof a&&(a&=255);if(b<0||this.length<b||this.length<c)throw RangeError("Out of range index");if(c<=b)return this;if(b>>>=0,c=void 0===c?this.length:c>>>0,a||(a=0),"number"==typeof a)for(e=b;e<c;++e)this[e]=a;else{var g=i.isBuffer(a)?a:O(new i(a,d).toString()),h=g.length;for(e=0;e<c-b;++e)this[e+b]=g[e%h]}return this};var M=/[^+\/0-9A-Za-z-_]/g;function N(a){return a<16?"0"+a.toString(16):a.toString(16)}function O(a,b){var c;b=b||1/0;for(var d=a.length,e=null,f=[],g=0;g<d;++g){if((c=a.charCodeAt(g))>55295&&c<57344){if(!e){if(c>56319||g+1===d){(b-=3)> -1&&f.push(239,191,189);continue}e=c;continue}if(c<56320){(b-=3)> -1&&f.push(239,191,189),e=c;continue}c=65536+(e-55296<<10|c-56320)}else e&&(b-=3)> -1&&f.push(239,191,189);if(e=null,c<128){if((b-=1)<0)break;f.push(c)}else if(c<2048){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(c<65536){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(c<1114112))throw Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function P(a){return d.toByteArray(function(a){var b;if((a=((b=a).trim?b.trim():b.replace(/^\s+|\s+$/g,"")).replace(M,"")).length<2)return"";for(;a.length%4!=0;)a+="=";return a}(a))}function Q(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);++e)b[e+c]=a[e];return e}}).call(this,c(29))},function(a,b){var c;c=function(){return this}();try{c=c||Function("return this")()}catch(d){"object"==typeof window&&(c=window)}a.exports=c},function(a,b,c){"use strict";b.byteLength=function(a){var b=j(a),c=b[0],d=b[1];return 3*(c+d)/4-d},b.toByteArray=function(a){var b,c,d,g,h,i=j(a),k=i[0],l=i[1],m=new f((c=k,3*(c+(d=l))/4-d)),n=0,o=l>0?k-4:k;for(h=0;h<o;h+=4)g=e[a.charCodeAt(h)]<<18|e[a.charCodeAt(h+1)]<<12|e[a.charCodeAt(h+2)]<<6|e[a.charCodeAt(h+3)],m[n++]=g>>16&255,m[n++]=g>>8&255,m[n++]=255&g;return 2===l&&(g=e[a.charCodeAt(h)]<<2|e[a.charCodeAt(h+1)]>>4,m[n++]=255&g),1===l&&(g=e[a.charCodeAt(h)]<<10|e[a.charCodeAt(h+1)]<<4|e[a.charCodeAt(h+2)]>>2,m[n++]=g>>8&255,m[n++]=255&g),m},b.fromByteArray=function(a){for(var b,c=a.length,e=c%3,f=[],g=0,h=c-e;g<h;g+=16383)f.push(k(a,g,g+16383>h?h:g+16383));return 1===e?f.push(d[(b=a[c-1])>>2]+d[b<<4&63]+"=="):2===e&&f.push(d[(b=(a[c-2]<<8)+a[c-1])>>10]+d[b>>4&63]+d[b<<2&63]+"="),f.join("")};for(var d=[],e=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,i=g.length;h<i;++h)d[h]=g[h],e[g.charCodeAt(h)]=h;function j(a){var b=a.length;if(b%4>0)throw Error("Invalid string. Length must be a multiple of 4");var c=a.indexOf("=");return -1===c&&(c=b),[c,c===b?0:4-c%4]}function k(a,b,c){for(var e,f,g=[],h=b;h<c;h+=3)g.push(d[(f=(a[h]<<16&16711680)+(a[h+1]<<8&65280)+(255&a[h+2]))>>18&63]+d[f>>12&63]+d[f>>6&63]+d[63&f]);return g.join("")}e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63},function(a,b){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ b.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<< -k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<< -k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},b.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?5960464477539062e-23:0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(isNaN(b=Math.abs(b))||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),(b+=g+l>=1?m/i:m*Math.pow(2,1-l))*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},function(a,b){var c={}.toString;a.exports=Array.isArray||function(a){return"[object Array]"==c.call(a)}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(a){var b=a.jws,c=a.KeyUtil,e=a.X509,f=a.crypto,g=a.hextob64u,h=a.b64tohex,i=a.AllowedSigningAlgs;return function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a.parseJwt=function(a){d.Log.debug("JoseUtil.parseJwt");try{var c=b.JWS.parse(a);return{header:c.headerObj,payload:c.payloadObj}}catch(e){d.Log.error(e)}},a.validateJwt=function(b,f,g,i,j,k,l){d.Log.debug("JoseUtil.validateJwt");try{if("RSA"===f.kty){if(f.e&&f.n)f=c.getKey(f);else{if(!f.x5c||!f.x5c.length)return d.Log.error("JoseUtil.validateJwt: RSA key missing key material",f),Promise.reject(Error("RSA key missing key material"));var m=h(f.x5c[0]);f=e.getPublicKeyFromCertHex(m)}}else{if("EC"!==f.kty)return d.Log.error("JoseUtil.validateJwt: Unsupported key type",f&&f.kty),Promise.reject(Error(f.kty));if(!(f.crv&&f.x&&f.y))return d.Log.error("JoseUtil.validateJwt: EC key missing key material",f),Promise.reject(Error("EC key missing key material"));f=c.getKey(f)}return a._validateJwt(b,f,g,i,j,k,l)}catch(n){return d.Log.error(n&&n.message||n),Promise.reject("JWT validation failed")}},a.validateJwtAttributes=function(b,c,e,f,g,h){f||(f=0),g||(g=parseInt(Date.now()/1e3));var i=a.parseJwt(b).payload;if(!i.iss)return d.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(Error("issuer was not provided"));if(i.iss!==c)return d.Log.error("JoseUtil._validateJwt: Invalid issuer in token",i.iss),Promise.reject(Error("Invalid issuer in token: "+i.iss));if(!i.aud)return d.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(Error("aud was not provided"));if(!(i.aud===e||Array.isArray(i.aud)&&i.aud.indexOf(e)>=0))return d.Log.error("JoseUtil._validateJwt: Invalid audience in token",i.aud),Promise.reject(Error("Invalid audience in token: "+i.aud));if(i.azp&&i.azp!==e)return d.Log.error("JoseUtil._validateJwt: Invalid azp in token",i.azp),Promise.reject(Error("Invalid azp in token: "+i.azp));if(!h){var j=g+f,k=g-f;if(!i.iat)return d.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(Error("iat was not provided"));if(j<i.iat)return d.Log.error("JoseUtil._validateJwt: iat is in the future",i.iat),Promise.reject(Error("iat is in the future: "+i.iat));if(i.nbf&&j<i.nbf)return d.Log.error("JoseUtil._validateJwt: nbf is in the future",i.nbf),Promise.reject(Error("nbf is in the future: "+i.nbf));if(!i.exp)return d.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(Error("exp was not provided"));if(i.exp<k)return d.Log.error("JoseUtil._validateJwt: exp is in the past",i.exp),Promise.reject(Error("exp is in the past:"+i.exp))}return Promise.resolve(i)},a._validateJwt=function(c,e,f,g,h,j,k){return a.validateJwtAttributes(c,f,g,h,j,k).then(function(a){try{return b.JWS.verify(c,e,i)?a:(d.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(Error("signature validation failed")))}catch(f){return d.Log.error(f&&f.message||f),Promise.reject(Error("signature validation failed"))}})},a.hashString=function(a,b){try{return f.Util.hashString(a,b)}catch(c){d.Log.error(c)}},a.hexToBase64Url=function(a){try{return g(a)}catch(b){d.Log.error(b)}},a}()};var d=c(0);a.exports=b.default},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SigninResponse=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(3);b.SigninResponse=function(){function a(b){var c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:"#";!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a);var d=e.UrlUtility.parseUrlFragment(b,c);this.error=d.error,this.error_description=d.error_description,this.error_uri=d.error_uri,this.code=d.code,this.state=d.state,this.id_token=d.id_token,this.session_state=d.session_state,this.access_token=d.access_token,this.token_type=d.token_type,this.scope=d.scope,this.profile=void 0,this.expires_in=d.expires_in}return d(a,[{key:"expires_in",get:function(){if(this.expires_at){var a=parseInt(Date.now()/1e3);return this.expires_at-a}},set:function(a){var b=parseInt(a);if("number"==typeof b&&b>0){var c=parseInt(Date.now()/1e3);this.expires_at=c+b}}},{key:"expired",get:function(){var a=this.expires_in;if(void 0!==a)return a<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SignoutRequest=void 0;var d=c(0),e=c(3),f=c(9);b.SignoutRequest=function a(b){var c=b.url,g=b.id_token_hint,h=b.post_logout_redirect_uri,i=b.data,j=b.extraQueryParams,k=b.request_type;if(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),!c)throw d.Log.error("SignoutRequest.ctor: No url passed"),Error("url");for(var l in g&&(c=e.UrlUtility.addQueryParam(c,"id_token_hint",g)),h&&(c=e.UrlUtility.addQueryParam(c,"post_logout_redirect_uri",h),i&&(this.state=new f.State({data:i,request_type:k}),c=e.UrlUtility.addQueryParam(c,"state",this.state.id))),j)c=e.UrlUtility.addQueryParam(c,l,j[l]);this.url=c}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SignoutResponse=void 0;var d=c(3);b.SignoutResponse=function a(b){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a);var c=d.UrlUtility.parseUrlFragment(b,"?");this.error=c.error,this.error_description=c.error_description,this.error_uri=c.error_uri,this.state=c.state}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.InMemoryWebStorage=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0);b.InMemoryWebStorage=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),this._data={}}return a.prototype.getItem=function(a){return e.Log.debug("InMemoryWebStorage.getItem",a),this._data[a]},a.prototype.setItem=function(a,b){e.Log.debug("InMemoryWebStorage.setItem",a),this._data[a]=b},a.prototype.removeItem=function(a){e.Log.debug("InMemoryWebStorage.removeItem",a),delete this._data[a]},a.prototype.key=function(a){return Object.getOwnPropertyNames(this._data)[a]},d(a,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.UserManager=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0),f=c(10),g=c(39),h=c(15),i=c(45),j=c(47),k=c(18),l=c(8),m=c(20),n=c(11),o=c(4);b.UserManager=function(a){function b(){var c=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&& void 0!==arguments[1]?arguments[1]:j.SilentRenewService,f=arguments.length>2&& void 0!==arguments[2]?arguments[2]:k.SessionMonitor,h=arguments.length>3&& void 0!==arguments[3]?arguments[3]:m.TokenRevocationClient,l=arguments.length>4&& void 0!==arguments[4]?arguments[4]:n.TokenClient,p=arguments.length>5&& void 0!==arguments[5]?arguments[5]:o.JoseUtil;(function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")})(this,b),c instanceof g.UserManagerSettings||(c=new g.UserManagerSettings(c));var q=function(a,b){if(!a)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}(this,a.call(this,c));return q._events=new i.UserManagerEvents(c),q._silentRenewService=new d(q),q.settings.automaticSilentRenew&&(e.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),q.startSilentRenew()),q.settings.monitorSession&&(e.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),q._sessionMonitor=new f(q)),q._tokenRevocationClient=new h(q._settings),q._tokenClient=new l(q._settings),q._joseUtil=p,q}return function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(b,a),b.prototype.getUser=function(){var a=this;return this._loadUser().then(function(b){return b?(e.Log.info("UserManager.getUser: user loaded"),a._events.load(b,!1),b):(e.Log.info("UserManager.getUser: user not found in storage"),null)})},b.prototype.removeUser=function(){var a=this;return this.storeUser(null).then(function(){e.Log.info("UserManager.removeUser: user removed from storage"),a._events.unload()})},b.prototype.signinRedirect=function(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};(a=Object.assign({},a)).request_type="si:r";var b={useReplaceToNavigate:a.useReplaceToNavigate};return this._signinStart(a,this._redirectNavigator,b).then(function(){e.Log.info("UserManager.signinRedirect: successful")})},b.prototype.signinRedirectCallback=function(a){return this._signinEnd(a||this._redirectNavigator.url).then(function(a){return a.profile&&a.profile.sub?e.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",a.profile.sub):e.Log.info("UserManager.signinRedirectCallback: no sub"),a})},b.prototype.signinPopup=function(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};(a=Object.assign({},a)).request_type="si:p";var b=a.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return b?(a.redirect_uri=b,a.display="popup",this._signin(a,this._popupNavigator,{startUrl:b,popupWindowFeatures:a.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:a.popupWindowTarget||this.settings.popupWindowTarget}).then(function(a){return a&&(a.profile&&a.profile.sub?e.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",a.profile.sub):e.Log.info("UserManager.signinPopup: no sub")),a})):(e.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(Error("No popup_redirect_uri or redirect_uri configured")))},b.prototype.signinPopupCallback=function(a){return this._signinCallback(a,this._popupNavigator).then(function(a){return a&&(a.profile&&a.profile.sub?e.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",a.profile.sub):e.Log.info("UserManager.signinPopupCallback: no sub")),a}).catch(function(a){e.Log.error(a.message)})},b.prototype.signinSilent=function(){var a=this,b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};return b=Object.assign({},b),this._loadUser().then(function(c){return c&&c.refresh_token?(b.refresh_token=c.refresh_token,a._useRefreshToken(b)):(b.request_type="si:s",b.id_token_hint=b.id_token_hint||a.settings.includeIdTokenInSilentRenew&&c&&c.id_token,c&&a._settings.validateSubOnSilentRenew&&(e.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",c.profile.sub),b.current_sub=c.profile.sub),a._signinSilentIframe(b))})},b.prototype._useRefreshToken=function(){var a=this,b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(b).then(function(b){return b?b.access_token?a._loadUser().then(function(c){if(c){var d=Promise.resolve();return b.id_token&&(d=a._validateIdTokenFromTokenRefreshToken(c.profile,b.id_token)),d.then(function(){return e.Log.debug("UserManager._useRefreshToken: refresh token response success"),c.id_token=b.id_token||c.id_token,c.access_token=b.access_token,c.refresh_token=b.refresh_token||c.refresh_token,c.expires_in=b.expires_in,a.storeUser(c).then(function(){return a._events.load(c),c})})}return null}):(e.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(e.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},b.prototype._validateIdTokenFromTokenRefreshToken=function(a,b){var c=this;return this._metadataService.getIssuer().then(function(d){return c.settings.getEpochTime().then(function(f){return c._joseUtil.validateJwtAttributes(b,d,c._settings.client_id,c._settings.clockSkew,f).then(function(b){return b?b.sub!==a.sub?(e.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(Error("sub in id_token does not match current sub"))):b.auth_time&&b.auth_time!==a.auth_time?(e.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(Error("auth_time in id_token does not match original auth_time"))):b.azp&&b.azp!==a.azp?(e.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(Error("azp in id_token does not match original azp"))):!b.azp&&a.azp?(e.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(Error("azp not in id_token, but present in original id_token"))):void 0:(e.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(Error("Failed to validate id_token")))})})})},b.prototype._signinSilentIframe=function(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},b=a.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return b?(a.redirect_uri=b,a.prompt=a.prompt||"none",this._signin(a,this._iframeNavigator,{startUrl:b,silentRequestTimeout:a.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(a){return a&&(a.profile&&a.profile.sub?e.Log.info("UserManager.signinSilent: successful, signed in sub: ",a.profile.sub):e.Log.info("UserManager.signinSilent: no sub")),a})):(e.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(Error("No silent_redirect_uri configured")))},b.prototype.signinSilentCallback=function(a){return this._signinCallback(a,this._iframeNavigator).then(function(a){return a&&(a.profile&&a.profile.sub?e.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",a.profile.sub):e.Log.info("UserManager.signinSilentCallback: no sub")),a})},b.prototype.signinCallback=function(a){var b=this;return this.readSigninResponseState(a).then(function(c){var d=c.state;return c.response,"si:r"===d.request_type?b.signinRedirectCallback(a):"si:p"===d.request_type?b.signinPopupCallback(a):"si:s"===d.request_type?b.signinSilentCallback(a):Promise.reject(Error("invalid response_type in state"))})},b.prototype.signoutCallback=function(a,b){var c=this;return this.readSignoutResponseState(a).then(function(d){var e=d.state,f=d.response;return e?"so:r"===e.request_type?c.signoutRedirectCallback(a):"so:p"===e.request_type?c.signoutPopupCallback(a,b):Promise.reject(Error("invalid response_type in state")):f})},b.prototype.querySessionStatus=function(){var a=this,b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};(b=Object.assign({},b)).request_type="si:s";var c=b.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return c?(b.redirect_uri=c,b.prompt="none",b.response_type=b.response_type||this.settings.query_status_response_type,b.scope=b.scope||"openid",b.skipUserInfo=!0,this._signinStart(b,this._iframeNavigator,{startUrl:c,silentRequestTimeout:b.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(b){return a.processSigninResponse(b.url).then(function(a){if(e.Log.debug("UserManager.querySessionStatus: got signin response"),a.session_state&&a.profile.sub)return e.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",a.profile.sub),{session_state:a.session_state,sub:a.profile.sub,sid:a.profile.sid};e.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(b){if(b.session_state&&a.settings.monitorAnonymousSession&&("login_required"==b.message||"consent_required"==b.message||"interaction_required"==b.message||"account_selection_required"==b.message))return e.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:b.session_state};throw b})})):(e.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(Error("No silent_redirect_uri configured")))},b.prototype._signin=function(a,b){var c=this,d=arguments.length>2&& void 0!==arguments[2]?arguments[2]:{};return this._signinStart(a,b,d).then(function(b){return c._signinEnd(b.url,a)})},b.prototype._signinStart=function(a,b){var c=this,d=arguments.length>2&& void 0!==arguments[2]?arguments[2]:{};return b.prepare(d).then(function(b){return e.Log.debug("UserManager._signinStart: got navigator window handle"),c.createSigninRequest(a).then(function(a){return e.Log.debug("UserManager._signinStart: got signin request"),d.url=a.url,d.id=a.state.id,b.navigate(d)}).catch(function(a){throw b.close&&(e.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),b.close()),a})})},b.prototype._signinEnd=function(a){var b=this,c=arguments.length>1&& void 0!==arguments[1]?arguments[1]:{};return this.processSigninResponse(a).then(function(a){e.Log.debug("UserManager._signinEnd: got signin response");var d=new h.User(a);if(c.current_sub){if(c.current_sub!==d.profile.sub)return e.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",d.profile.sub),Promise.reject(Error("login_required"));e.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return b.storeUser(d).then(function(){return e.Log.debug("UserManager._signinEnd: user stored"),b._events.load(d),d})})},b.prototype._signinCallback=function(a,b){e.Log.debug("UserManager._signinCallback");var c="query"===this._settings.response_mode|| !this._settings.response_mode&&l.SigninRequest.isCode(this._settings.response_type)?"?":"#";return b.callback(a,void 0,c)},b.prototype.signoutRedirect=function(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};(a=Object.assign({},a)).request_type="so:r";var b=a.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;b&&(a.post_logout_redirect_uri=b);var c={useReplaceToNavigate:a.useReplaceToNavigate};return this._signoutStart(a,this._redirectNavigator,c).then(function(){e.Log.info("UserManager.signoutRedirect: successful")})},b.prototype.signoutRedirectCallback=function(a){return this._signoutEnd(a||this._redirectNavigator.url).then(function(a){return e.Log.info("UserManager.signoutRedirectCallback: successful"),a})},b.prototype.signoutPopup=function(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{};(a=Object.assign({},a)).request_type="so:p";var b=a.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return a.post_logout_redirect_uri=b,a.display="popup",a.post_logout_redirect_uri&&(a.state=a.state||{}),this._signout(a,this._popupNavigator,{startUrl:b,popupWindowFeatures:a.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:a.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){e.Log.info("UserManager.signoutPopup: successful")})},b.prototype.signoutPopupCallback=function(a,b){return void 0===b&&"boolean"==typeof a&&(b=a,a=null),this._popupNavigator.callback(a,b,"?").then(function(){e.Log.info("UserManager.signoutPopupCallback: successful")})},b.prototype._signout=function(a,b){var c=this,d=arguments.length>2&& void 0!==arguments[2]?arguments[2]:{};return this._signoutStart(a,b,d).then(function(a){return c._signoutEnd(a.url)})},b.prototype._signoutStart=function(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},b=this,c=arguments[1],d=arguments.length>2&& void 0!==arguments[2]?arguments[2]:{};return c.prepare(d).then(function(c){return e.Log.debug("UserManager._signoutStart: got navigator window handle"),b._loadUser().then(function(f){return e.Log.debug("UserManager._signoutStart: loaded current user from storage"),(b._settings.revokeAccessTokenOnSignout?b._revokeInternal(f):Promise.resolve()).then(function(){var g=a.id_token_hint||f&&f.id_token;return g&&(e.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),a.id_token_hint=g),b.removeUser().then(function(){return e.Log.debug("UserManager._signoutStart: user removed, creating signout request"),b.createSignoutRequest(a).then(function(a){return e.Log.debug("UserManager._signoutStart: got signout request"),d.url=a.url,a.state&&(d.id=a.state.id),c.navigate(d)})})})}).catch(function(a){throw c.close&&(e.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),c.close()),a})})},b.prototype._signoutEnd=function(a){return this.processSignoutResponse(a).then(function(a){return e.Log.debug("UserManager._signoutEnd: got signout response"),a})},b.prototype.revokeAccessToken=function(){var a=this;return this._loadUser().then(function(b){return a._revokeInternal(b,!0).then(function(c){if(c)return e.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),b.access_token=null,b.refresh_token=null,b.expires_at=null,b.token_type=null,a.storeUser(b).then(function(){e.Log.debug("UserManager.revokeAccessToken: user stored"),a._events.load(b)})})}).then(function(){e.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},b.prototype._revokeInternal=function(a,b){var c=this;if(a){var d=a.access_token,f=a.refresh_token;return this._revokeAccessTokenInternal(d,b).then(function(a){return c._revokeRefreshTokenInternal(f,b).then(function(b){return a||b||e.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),a||b})})}return Promise.resolve(!1)},b.prototype._revokeAccessTokenInternal=function(a,b){return!a||a.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(a,b).then(function(){return!0})},b.prototype._revokeRefreshTokenInternal=function(a,b){return a?this._tokenRevocationClient.revoke(a,b,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},b.prototype.startSilentRenew=function(){this._silentRenewService.start()},b.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},b.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(a){return a?(e.Log.debug("UserManager._loadUser: user storageString loaded"),h.User.fromStorageString(a)):(e.Log.debug("UserManager._loadUser: no user storageString"),null)})},b.prototype.storeUser=function(a){if(a){e.Log.debug("UserManager.storeUser: storing user");var b=a.toStorageString();return this._userStore.set(this._userStoreKey,b)}return e.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},d(b,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),b}(f.OidcClient)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.UserManagerSettings=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=(c(0),c(5)),f=c(40),g=c(41),h=c(43),i=c(6),j=c(1),k=c(8);b.UserManagerSettings=function(a){function b(){var c=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},d=c.popup_redirect_uri,e=c.popup_post_logout_redirect_uri,l=c.popupWindowFeatures,m=c.popupWindowTarget,n=c.silent_redirect_uri,o=c.silentRequestTimeout,p=c.automaticSilentRenew,q=c.validateSubOnSilentRenew,r=c.includeIdTokenInSilentRenew,s=c.monitorSession,t=c.monitorAnonymousSession,u=c.checkSessionInterval,v=c.stopCheckSessionOnError,w=c.query_status_response_type,x=c.revokeAccessTokenOnSignout,y=c.accessTokenExpiringNotificationTime,z=c.redirectNavigator,A=void 0===z?new f.RedirectNavigator:z,B=c.popupNavigator,C=void 0===B?new g.PopupNavigator:B,D=c.iframeNavigator,E=void 0===D?new h.IFrameNavigator:D,F=c.userStore,G=void 0===F?new i.WebStorageStateStore({store:j.Global.sessionStorage}):F;!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,b);var H=function(a,b){if(!a)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}(this,a.call(this,arguments[0]));return H._popup_redirect_uri=d,H._popup_post_logout_redirect_uri=e,H._popupWindowFeatures=l,H._popupWindowTarget=m,H._silent_redirect_uri=n,H._silentRequestTimeout=o,H._automaticSilentRenew=void 0!==p&&p,H._validateSubOnSilentRenew=void 0!==q&&q,H._includeIdTokenInSilentRenew=void 0===r||r,H._accessTokenExpiringNotificationTime=void 0===y?60:y,H._monitorSession=void 0===s||s,H._monitorAnonymousSession=void 0!==t&&t,H._checkSessionInterval=void 0===u?2e3:u,H._stopCheckSessionOnError=void 0===v||v,w?H._query_status_response_type=w:arguments[0]&&arguments[0].response_type?H._query_status_response_type=k.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":H._query_status_response_type="id_token",H._revokeAccessTokenOnSignout=void 0!==x&&x,H._redirectNavigator=A,H._popupNavigator=C,H._iframeNavigator=E,H._userStore=G,H}return function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(b,a),d(b,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),b}(e.OidcClientSettings)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.RedirectNavigator=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0);b.RedirectNavigator=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a.prototype.prepare=function(){return Promise.resolve(this)},a.prototype.navigate=function(a){return a&&a.url?(a.useReplaceToNavigate?window.location.replace(a.url):window.location=a.url,Promise.resolve()):(e.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(Error("No url provided")))},d(a,[{key:"url",get:function(){return window.location.href}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.PopupNavigator=void 0;var d=c(0),e=c(42);b.PopupNavigator=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a.prototype.prepare=function(a){return Promise.resolve(new e.PopupWindow(a))},a.prototype.callback=function(a,b,c){d.Log.debug("PopupNavigator.callback");try{return e.PopupWindow.notifyOpener(a,b,c),Promise.resolve()}catch(f){return Promise.reject(f)}},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.PopupWindow=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0),f=c(3);b.PopupWindow=function(){function a(b){var c=this;!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),this._promise=new Promise(function(a,b){c._resolve=a,c._reject=b});var d=b.popupWindowTarget||"_blank",f=b.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",d,f),this._popup&&(e.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return a.prototype.navigate=function(a){return this._popup?a&&a.url?(e.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=a.id,this._id&&(window["popupCallback_"+a.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=a.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},a.prototype._success=function(a){e.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(a)},a.prototype._error=function(a){e.Log.error("PopupWindow.error: ",a),this._cleanup(),this._reject(Error(a))},a.prototype.close=function(){this._cleanup(!1)},a.prototype._cleanup=function(a){e.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!a&&this._popup.close(),this._popup=null},a.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},a.prototype._callback=function(a,b){this._cleanup(b),a?(e.Log.debug("PopupWindow.callback success"),this._success({url:a})):(e.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},a.notifyOpener=function(a,b,c){if(window.opener){if(a=a||window.location.href){var d=f.UrlUtility.parseUrlFragment(a,c);if(d.state){var g="popupCallback_"+d.state,h=window.opener[g];h?(e.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),h(a,b)):e.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else e.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else e.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},d(a,[{key:"promise",get:function(){return this._promise}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.IFrameNavigator=void 0;var d=c(0),e=c(44);b.IFrameNavigator=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a.prototype.prepare=function(a){return Promise.resolve(new e.IFrameWindow(a))},a.prototype.callback=function(a){d.Log.debug("IFrameNavigator.callback");try{return e.IFrameWindow.notifyParent(a),Promise.resolve()}catch(b){return Promise.reject(b)}},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.IFrameWindow=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0);b.IFrameWindow=function(){function a(b){var c=this;!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),this._promise=new Promise(function(a,b){c._resolve=a,c._reject=b}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return a.prototype.navigate=function(a){if(a&&a.url){var b=a.silentRequestTimeout||1e4;e.Log.debug("IFrameWindow.navigate: Using timeout of:",b),this._timer=window.setTimeout(this._timeout.bind(this),b),this._frame.src=a.url}else this._error("No url provided");return this.promise},a.prototype._success=function(a){this._cleanup(),e.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(a)},a.prototype._error=function(a){this._cleanup(),e.Log.error(a),this._reject(Error(a))},a.prototype.close=function(){this._cleanup()},a.prototype._cleanup=function(){this._frame&&(e.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},a.prototype._timeout=function(){e.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},a.prototype._message=function(a){if(e.Log.debug("IFrameWindow.message"),this._timer&&a.origin===this._origin&&a.source===this._frame.contentWindow&&"string"==typeof a.data&&(a.data.startsWith("http://")||a.data.startsWith("https://"))){var b=a.data;b?this._success({url:b}):this._error("Invalid response from frame")}},a.notifyParent=function(a){e.Log.debug("IFrameWindow.notifyParent"),(a=a||window.location.href)&&(e.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(a,location.protocol+"//"+location.host))},d(a,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.UserManagerEvents=void 0;var d=c(0),e=c(16),f=c(17);b.UserManagerEvents=function(a){function b(c){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,b);var d=function(a,b){if(!a)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}(this,a.call(this,c));return d._userLoaded=new f.Event("User loaded"),d._userUnloaded=new f.Event("User unloaded"),d._silentRenewError=new f.Event("Silent renew error"),d._userSignedIn=new f.Event("User signed in"),d._userSignedOut=new f.Event("User signed out"),d._userSessionChanged=new f.Event("User session changed"),d}return function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(b,a),b.prototype.load=function(b){var c=!(arguments.length>1&& void 0!==arguments[1])||arguments[1];d.Log.debug("UserManagerEvents.load"),a.prototype.load.call(this,b),c&&this._userLoaded.raise(b)},b.prototype.unload=function(){d.Log.debug("UserManagerEvents.unload"),a.prototype.unload.call(this),this._userUnloaded.raise()},b.prototype.addUserLoaded=function(a){this._userLoaded.addHandler(a)},b.prototype.removeUserLoaded=function(a){this._userLoaded.removeHandler(a)},b.prototype.addUserUnloaded=function(a){this._userUnloaded.addHandler(a)},b.prototype.removeUserUnloaded=function(a){this._userUnloaded.removeHandler(a)},b.prototype.addSilentRenewError=function(a){this._silentRenewError.addHandler(a)},b.prototype.removeSilentRenewError=function(a){this._silentRenewError.removeHandler(a)},b.prototype._raiseSilentRenewError=function(a){d.Log.debug("UserManagerEvents._raiseSilentRenewError",a.message),this._silentRenewError.raise(a)},b.prototype.addUserSignedIn=function(a){this._userSignedIn.addHandler(a)},b.prototype.removeUserSignedIn=function(a){this._userSignedIn.removeHandler(a)},b.prototype._raiseUserSignedIn=function(){d.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},b.prototype.addUserSignedOut=function(a){this._userSignedOut.addHandler(a)},b.prototype.removeUserSignedOut=function(a){this._userSignedOut.removeHandler(a)},b.prototype._raiseUserSignedOut=function(){d.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},b.prototype.addUserSessionChanged=function(a){this._userSessionChanged.addHandler(a)},b.prototype.removeUserSessionChanged=function(a){this._userSessionChanged.removeHandler(a)},b.prototype._raiseUserSessionChanged=function(){d.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},b}(e.AccessTokenEvents)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Timer=void 0;var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=c(0),f=c(1),g=c(17);b.Timer=function(a){function b(c){var d=arguments.length>1&& void 0!==arguments[1]?arguments[1]:f.Global.timer,e=arguments.length>2&& void 0!==arguments[2]?arguments[2]:void 0;!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,b);var g=function(a,b){if(!a)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}(this,a.call(this,c));return g._timer=d,g._nowFunc=e||function(){return Date.now()/1e3},g}return function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(b,a),b.prototype.init=function(a){a<=0&&(a=1),a=parseInt(a);var b=this.now+a;if(this.expiration===b&&this._timerHandle)e.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),e.Log.debug("Timer.init timer "+this._name+" for duration:",a),this._expiration=b;var c=5;a<c&&(c=a),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*c)}},b.prototype.cancel=function(){this._timerHandle&&(e.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},b.prototype._callback=function(){var b=this._expiration-this.now;e.Log.debug("Timer.callback; "+this._name+" timer expires in:",b),this._expiration<=this.now&&(this.cancel(),a.prototype.raise.call(this))},d(b,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),b}(g.Event)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SilentRenewService=void 0;var d=c(0);b.SilentRenewService=function(){function a(b){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),this._userManager=b}return a.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(a){}).catch(function(a){d.Log.error("SilentRenewService.start: Error from getUser:",a.message)}))},a.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},a.prototype._tokenExpiring=function(){var a=this;this._userManager.signinSilent().then(function(a){d.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(b){d.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",b.message),a._userManager.events._raiseSilentRenewError(b)})},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.CordovaPopupNavigator=void 0;var d=c(21);b.CordovaPopupNavigator=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a.prototype.prepare=function(a){return Promise.resolve(new d.CordovaPopupWindow(a))},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.CordovaIFrameNavigator=void 0;var d=c(21);b.CordovaIFrameNavigator=function(){function a(){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a)}return a.prototype.prepare=function(a){return a.popupWindowFeatures="hidden=yes",Promise.resolve(new d.CordovaPopupWindow(a))},a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Version="1.11.6"}])})}}])